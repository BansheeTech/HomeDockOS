import{M as Ie,bQ as De,aU as k,q as w,aD as Ce,as as Te,bE as Me,u as d,aL as c,v as i,I as b,bL as Ee,t as _,au as r,bk as a,bT as g,bA as Be,F as D,aX as G,bb as f,bS as Fe,G as Re,aw as He,s as Q,bU as Le,H as Ue,bO as Oe,bJ as je}from"./hdos_N6k7CkqqJkxM3DtIMMNjd.js";import{a as W}from"./hdos_BbS_vWe5DNlDDYAPlKxdN.js";import{i as ze,u as Pe,a as Ve,G as Ze,Y as Ge,g as Qe,b as B,W as F,Z as We,I as te,N as R,L as oe,T as ae,U as se,V as C,$ as Ke,a0 as qe,a1 as le,l as Xe,a2 as Je}from"./hdos_B6WjtKSCTclXwsyyh8Wzc.js";import{_ as Ne}from"./hdos_C5UvusplRIJqPLwHcnnc-.js";import{d as ne}from"./hdos_itWSuQ2oYLgMGq-Z_V6WL.js";import{d as Ye}from"./hdos_D4VENToS-RM0shQaDqhsL.js";import{d as et}from"./hdos_C5l3yA4rfWsQeonAlErEl.js";import{d as tt}from"./hdos_Dk8ORdgBuQt10zGqyIF6s.js";import{K as re}from"./hdos_Dr8juiojyo3ZWzocg_48-.js";import{d as ot}from"./hdos_DzD_9-ae9bJuHOkfQ9Haz.js";import{L as T}from"./hdos_Cjz6YYSqZAih8mJfOyW_O.js";import"./hdos_Dz3aTMQqM4LnOlKzV3COc.js";import"./hdos_DCQvziD-0BGtLQC-jPv6N.js";import"./hdos_CJoaCRc7PMIr83ndc1bSY.js";import"./hdos_bYZH7nGO57tVZsPtqqQuS.js";const K={width:24,height:24,body:'<path fill="currentColor" d="M12 13a5 5 0 0 1-5-5h2a3 3 0 0 0 3 3a3 3 0 0 0 3-3h2a5 5 0 0 1-5 5m0-10a3 3 0 0 1 3 3H9a3 3 0 0 1 3-3m7 3h-2a5 5 0 0 0-5-5a5 5 0 0 0-5 5H5c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2Z"/>'},at={class:"flex flex-col h-full overflow-hidden"},st={class:"relative flex items-center gap-3"},lt=["onClick"],nt={class:"max-[480px]:hidden"},rt={class:"relative flex-1 overflow-y-auto"},it={key:0,class:"flex flex-col items-center justify-center px-8 py-16 text-center"},ct={key:1,class:"flex flex-col items-center justify-center px-8 py-16 text-center"},dt={key:2,class:"px-4 md:px-4 py-4"},pt={class:"flex flex-col gap-2"},ut=["onClick","onMouseenter"],ft={class:"flex-1 min-w-0 z-[1]"},mt={key:0},vt={class:"flex-shrink-0 z-[1]"},xt=["onClick","title"],ht={class:"space-y-2.5 max-w-sm"},yt={class:"flex items-center gap-2"},Rt=Ie({__name:"AppExplorer",setup(bt){const M=ze(),H=Pe(),L=Ve(),ie=Ze(),{isMobile:ce}=Ge(),{themeClasses:n}=De(),x=k(""),v=k("all"),h=k(0),q=k(null),E=k([]),X=k(!0),u=k({}),U=Qe(),de=w(()=>{const e=(t,o)=>v.value===t?t==="all"&&!x.value.trim()?o:S.value.length:o;return[{id:"all",label:"All",icon:et,count:e("all",P.value)},{id:"apps",label:"Apps",icon:B,count:e("apps",O.value.length+j.value.length)},{id:"files",label:"Files",icon:F,count:e("files",E.value.length)},{id:"available",label:"Available",icon:K,count:e("available",z.value.length)}]}),O=w(()=>We()),j=w(()=>M.mainDockerApps.filter(e=>e.status==="running")),z=w(()=>H.apps.filter(e=>!e.is_installed)),P=w(()=>O.value.length+j.value.length+E.value.length+z.value.length);async function J(){try{const e=await W.get("/api/get_files",{headers:{"X-HomeDock-CSRF-Token":U.value}});E.value=e.data.files||[]}catch(e){console.error("Failed to fetch DropZone files:",e)}}async function pe(){try{X.value=!0,await H.loadApps(U.value)}catch(e){console.error("Failed to load available apps:",e)}finally{X.value=!1}}function V(e,t){if(!e||!t)return 0;const o=e.toLowerCase(),l=t.toLowerCase();if(o===l)return 100;if(o.startsWith(l))return 95;const s=l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(`\\b${s}\\b`,"i").test(o))return 90;if(o.includes(l))return 85;const m=o.split(/[\s-_]+/);for(const A of m){if(A.startsWith(l))return 80;if(A.includes(l))return 75}let y=0,$=0,I=0;for(;y<o.length&&$<l.length;)o[y]===l[$]&&(I++,$++),y++;if($===l.length){const A=I/l.length,Ae=1-(y-I)/o.length;return Math.floor(60*A*Ae)}if(I>0){const A=I/l.length*40;return Math.floor(A)}return 0}const ue=w(()=>{const e=[];return O.value.forEach(t=>{e.push({id:`system-${t.id}`,type:"system",name:t.name,description:t.description,icon:t.icon,category:"System Apps",score:0,action:()=>M.openSystemApp(t.id)})}),j.value.forEach(t=>{e.push({id:`docker-${t.id}`,type:"docker",name:t.display_name||t.name,description:t.image,image_path:t.image_path,category:"Installed Apps",score:0,action:()=>M.openDockerApp(t)})}),E.value.forEach(t=>{const o=t.is_directory===!0;e.push({id:`${o?"folder":"file"}-${t.name}`,type:o?"folder":"file",name:t.name,description:o?"Folder":"Encrypted file",icon:o?te:fe(t.name),category:"Files",size:t.size,modified:t.modified,score:0,action:()=>o?we(t.name):ge(t.name)})}),z.value.forEach(t=>{e.push({id:`available-${t.name}`,type:"available",name:t.display_name||t.name,description:t.category,image_path:t.picture_path||`docker-icons/${t.name}.jpg`,category:"Available in Store",score:0,action:()=>ke(t.name)})}),e}),S=w(()=>{const e=x.value.trim(),t=e.length>0;if(v.value==="all"&&!t)return[];let o=[...ue.value];if(v.value!=="all"){const s={apps:["system","docker"],files:["file","folder"],available:["available"]}[v.value]||[];o=o.filter(p=>s.includes(p.type))}return t?o=o.map(s=>{const p=V(s.name,e),m=s.description?V(s.description,e):0,y=V(s.category,e),$=Math.max(p,m*.8,y*.5);return{...s,score:$}}).filter(s=>s.score>=60).sort((s,p)=>p.score-s.score):o=o.sort((l,s)=>{const p={system:0,folder:1,file:2,docker:3,available:4},m=p[l.type]??999,y=p[s.type]??999;return m!==y?m-y:l.name.localeCompare(s.name)}),o}),N=w(()=>{const e={};S.value.forEach(o=>{e[o.category]||(e[o.category]=[]),e[o.category].push(o)});const t={"System Apps":B,"Installed Apps":B,Files:F,"Available in Store":K};return Object.keys(e).map(o=>({category:o,title:o,icon:t[o]||te,items:e[o]}))});function Y(e,t){let o=0;for(let l=0;l<e;l++)o+=N.value[l].items.length;return o+t}function fe(e){const t=e.split(".").pop()?.toLowerCase();return{png:C,jpg:C,jpeg:C,gif:C,webp:C,mp4:se,mkv:se,mp3:ae,wav:ae,zip:oe,rar:oe,js:R,ts:R,py:R,vue:R}[t||""]||F}function me(e){return e>=1e9?(e/1e9).toFixed(2)+" GB":e>=1e6?(e/1e6).toFixed(2)+" MB":e>=1e3?(e/1e3).toFixed(2)+" KB":e+" B"}function ve(e){if(!e)return"";const t=new Date,o=typeof e=="number"?new Date(e*1e3):new Date(e),l=Math.floor((t.getTime()-o.getTime())/1e3);return l<60?"Just now":l<3600?`${Math.floor(l/60)}m ago`:l<86400?`${Math.floor(l/3600)}h ago`:l<2592e3?`${Math.floor(l/86400)}d ago`:`${Math.floor(l/2592e3)}mo ago`}function xe(e){return{system:"System",docker:"Running",file:"File",folder:"Folder",available:"Available"}[e]||e}function he(e){return{system:n.value.explorerBadgeSystem,docker:n.value.explorerBadgeDocker,file:n.value.explorerBadgeFile,folder:n.value.explorerBadgeFile,available:n.value.explorerBadgeAvailable}[e]||""}function ye(e){return{system:re,docker:Je,file:Xe,folder:tt,available:ot}[e]||re}function be(e){return{system:"Open",docker:"Open",file:"Download",folder:"Open",available:"View in Store"}[e]||"Open"}function Z(e){e.action()}async function ge(e){if(u.value[e]!==void 0&&u.value[e]<100&&u.value[e]>0){T.info(`Download for ${e} is already in progress.`);return}try{u.value[e]=0;const t=await W.get(`/api/download_file?file=${encodeURIComponent(e)}`,{headers:{"X-HomeDock-CSRF-Token":U.value},responseType:"blob",onDownloadProgress:p=>{if(p.total){const m=Math.round(p.loaded*100/p.total);u.value[e]=m}}}),o=window.URL.createObjectURL(new Blob([t.data])),l=document.createElement("a");l.href=o;const s=e.split("/").pop()||e;l.setAttribute("download",s),document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(o),T.success(`Downloaded ${e}`),setTimeout(()=>{delete u.value[e]},1e3)}catch(t){console.error("Failed to download file:",e,t),delete u.value[e],W.isAxiosError(t)?T.error(t.response?.data?.error_message||"Failed to download file. Please try again."):T.error("Failed to download file. Please try again.")}}function we(e){M.openSystemApp("dropzone")}function ke(e){const t=H.apps.find(l=>l.name===e);if(!t){T.error(`App ${e} not found`);return}const o=L.windows.find(l=>l.appId==="installconfig"&&l.data?.app?.name===t.name);if(o){L.focusWindow(o.id),o.isMinimized&&(o.isMinimized=!1);return}L.openWindow("installconfig",{title:`Install ${t.display_name||t.name}`,data:{app:t},allowMultiple:!0})}function _e(){return{all:"No items available",apps:"No apps found",files:"No files in Drop Zone",available:"All apps are already installed"}[v.value]||"No items found"}function Se(){return{all:"Start by installing apps or uploading files",apps:"Install apps from the App Store to get started",files:"Upload files to Drop Zone to see them here",available:"Great! All available apps are installed"}[v.value]||""}function ee(){x.value="",h.value=0}function $e(e){const t=S.value.length-1;switch(e.key){case"ArrowDown":e.preventDefault(),h.value=Math.min(h.value+1,t);break;case"ArrowUp":e.preventDefault(),h.value=Math.max(h.value-1,0);break;case"Enter":e.preventDefault(),S.value[h.value]&&Z(S.value[h.value]);break;case"Escape":e.preventDefault(),ee();break}}return Ce(async()=>{await Promise.all([pe(),J()]),ce.value||Te(()=>{q.value?.focus()})}),Me(()=>ie.currentlyUploading,(e,t)=>{t&&!e&&setTimeout(()=>{J()},500)}),(e,t)=>(c(),d("div",at,[i("div",{class:r(["px-4 md:px-4 py-5 border-b",a(n).explorerHeaderBorder])},[i("div",st,[b(a(g),{icon:a(ne),class:r([a(n).explorerSearchIcon,"absolute left-4 w-5 h-5 pointer-events-none"])},null,8,["icon","class"]),Ee(i("input",{ref_key:"searchInputRef",ref:q,"onUpdate:modelValue":t[0]||(t[0]=o=>x.value=o),type:"text",placeholder:"Search apps, files, and more...",class:r(["flex-1 py-3 pr-4 pl-12 rounded-lg border text-sm outline-none transition-all duration-200",[a(n).explorerSearchInput,a(n).explorerSearchInputText,a(n).explorerSearchInputFocusRing]]),onKeydown:$e},null,34),[[Be,x.value]]),x.value?(c(),d("button",{key:0,onClick:ee,class:r(["absolute right-2 p-2 border-none bg-transparent cursor-pointer rounded transition-all duration-150",[a(n).explorerClearButton,a(n).explorerClearButtonHover]])},[b(a(g),{icon:a(Ke),class:"w-4 h-4"},null,8,["icon"])],2)):_("",!0)])],2),i("div",{class:r(["flex gap-2 px-4 md:px-4 py-4 border-b overflow-x-auto [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",a(n).explorerHeaderBorder])},[(c(!0),d(D,null,G(de.value,o=>(c(),d("button",{key:o.id,onClick:l=>v.value=o.id,class:r(["flex items-center gap-2 md:gap-1.5 px-4 md:px-3 py-2 rounded-lg border-none text-sm md:text-[0.8125rem] font-medium cursor-pointer transition-all duration-150 whitespace-nowrap max-[480px]:min-w-12 max-[480px]:px-2",v.value===o.id?a(n).explorerTabActive:[a(n).explorerTabInactive,a(n).explorerTabHover]])},[b(a(g),{icon:o.icon,class:"w-4 h-4 md:w-4 md:h-4"},null,8,["icon"]),i("span",nt,f(o.label),1),o.count>0?(c(),d("span",{key:0,class:r(["text-xs md:text-[0.6875rem] px-2 md:px-1.5 py-0.5 md:py-0 rounded-full font-semibold",v.value===o.id?a(n).explorerTabCountActive:a(n).explorerTabCountInactive])},f(o.count),3)):_("",!0)],10,lt))),128))],2),i("div",rt,[!x.value.trim()&&v.value==="all"?(c(),d("div",it,[b(Fe,{icons:[a(ne),a(B),a(F),a(K)],iconSize:64,interval:2e3,containerClass:"mb-4",class:r(a(n).explorerEmptyIcon)},null,8,["icons","class"]),i("p",{class:r([a(n).explorerEmptyText,"text-base font-medium mb-2 text-balance"])},"Start typing to search across HomeDock OS",2),i("div",{class:r(["mt-8 text-left max-w-md",a(n).explorerQuickTips])},[...t[1]||(t[1]=[Re('<p class="text-sm font-semibold mb-2">Quick tips:</p><ul class="list-none p-0 text-[0.8125rem] leading-relaxed"><li class="before:content-[&#39;•&#39;] before:mr-2 before:opacity-50">Search for apps, files, or available software</li><li class="before:content-[&#39;•&#39;] before:mr-2 before:opacity-50">Use filters to narrow down results</li><li class="before:content-[&#39;•&#39;] before:mr-2 before:opacity-50">Select a category above to browse items</li></ul>',2)])],2)])):S.value.length===0?(c(),d("div",ct,[b(a(g),{icon:a(Ye),class:r([a(n).explorerEmptyIcon,"w-16 h-16 mb-4"])},null,8,["icon","class"]),x.value?(c(),d(D,{key:0},[i("p",{class:r([a(n).explorerEmptyText,"text-base font-medium mb-2"])},'No results found for "'+f(x.value)+'"',3),i("p",{class:r([a(n).explorerEmptySubtext,"text-sm"])},"Try different keywords or check your spelling",2)],64)):(c(),d(D,{key:1},[i("p",{class:r([a(n).explorerEmptyText,"text-base font-medium mb-2"])},f(_e()),3),i("p",{class:r([a(n).explorerEmptySubtext,"text-sm"])},f(Se()),3)],64))])):(c(),d("div",dt,[(c(!0),d(D,null,G(N.value,(o,l)=>(c(),d("div",{key:o.category,class:"mb-8 last:mb-0"},[i("h3",{class:r(["flex items-center gap-2 text-xs font-semibold uppercase tracking-wider mb-3",a(n).explorerGroupHeader])},[b(a(g),{icon:o.icon,class:"w-4 h-4"},null,8,["icon"]),i("span",null,f(o.title),1),i("span",{class:r(["opacity-50 font-normal",a(n).explorerGroupCount])},"("+f(o.items.length)+")",3)],2),i("div",pt,[(c(!0),d(D,null,G(o.items,(s,p)=>(c(),d("div",{key:s.id,onClick:m=>Z(s),onMouseenter:m=>h.value=Y(l,p),class:r(["relative flex items-center gap-4 px-3 py-3 rounded-lg cursor-pointer transition-all duration-150 overflow-hidden",[a(n).explorerResultItem,a(n).explorerResultItemHover,h.value===Y(l,p)?a(n).explorerResultItemSelected:""]])},[s.type==="file"&&u.value[s.name]!==void 0&&u.value[s.name]<100?(c(),d("div",{key:0,class:"absolute inset-0 bg-blue-500/20 transition-all duration-300 ease-out",style:He({width:`${u.value[s.name]}%`})},null,4)):_("",!0),i("div",{class:r(["flex-shrink-0 w-12 h-12 md:w-10 md:h-10 flex items-center justify-center rounded-lg overflow-hidden z-[1]",s.type==="docker"?"bg-transparent p-0":""])},[s.image_path?(c(),Q(Le,{key:0,src:s.image_path,alt:"",class:"w-full h-full object-cover",draggable:"false"},null,8,["src"])):s.icon?(c(),Q(a(g),{key:1,icon:s.icon,class:r([a(n).explorerItemIcon,"w-8 h-8"])},null,8,["icon","class"])):(c(),Q(a(g),{key:2,icon:a(qe),class:r([a(n).explorerItemIcon,"w-8 h-8"])},null,8,["icon","class"]))],2),i("div",ft,[i("div",{class:r(["text-sm font-medium overflow-hidden text-ellipsis whitespace-nowrap",a(n).explorerItemName])},f(s.name),3),s.description?(c(),d("div",{key:0,class:r(["text-xs mt-0.5 overflow-hidden text-ellipsis whitespace-nowrap",a(n).explorerItemDescription])},f(s.description),3)):_("",!0),s.size?(c(),d("div",{key:1,class:r(["text-xs mt-0.5",a(n).explorerItemMeta])},[Ue(f(me(s.size))+" ",1),s.modified?(c(),d("span",mt," • "+f(ve(s.modified)),1)):_("",!0)],2)):_("",!0),s.type==="file"&&u.value[s.name]!==void 0&&u.value[s.name]<100?(c(),d("div",{key:2,class:r(["text-xs mt-0.5 font-medium",a(n).explorerItemMeta])},"Downloading... "+f(u.value[s.name])+"%",3)):_("",!0)]),i("div",{class:r(["flex-shrink-0 px-2 py-1 rounded text-[0.625rem] font-semibold uppercase z-[1]",he(s.type)])},f(xe(s.type)),3),i("div",vt,[i("button",{onClick:Oe(m=>Z(s),["stop"]),class:r(["p-2 rounded-md border-none cursor-pointer transition-all duration-150",[a(n).explorerActionButton,a(n).explorerActionButtonHover]]),title:be(s.type)},[b(a(g),{icon:ye(s.type),class:"w-4 h-4"},null,8,["icon"])],10,xt)])],42,ut))),128))])]))),128))]))]),b(Ne,{icon:a(le),message:"Explorer",info:`${P.value} ${P.value===1?"item":"items"} available`,showHelp:!0},{help:je(()=>[i("div",ht,[i("div",yt,[b(a(g),{icon:a(le),class:r(["w-5 h-5",a(n).statusBarIcon])},null,8,["icon","class"]),i("h4",{class:r(["text-base font-semibold",a(n).statusBarText])},"Explorer",2)]),i("div",{class:r(["text-[10px] md:text-xs space-y-2 leading-relaxed",a(n).statusBarInfo])},[...t[2]||(t[2]=[i("p",null,"Search across all available content in HomeDock OS including system applications, installed applications, available software from the App Store, and encrypted files stored in Drop Zone. Use filters to narrow results by category or search by name to quickly find what you need.",-1)])],2)])]),_:1},8,["icon","info"])]))}});export{Rt as default};
