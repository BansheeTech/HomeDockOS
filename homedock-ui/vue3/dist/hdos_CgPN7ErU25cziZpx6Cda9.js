import{j as _e,B as Ae,r as _,d as y,v as Ie,n as $e,w as Ce,y as p,A as c,z as i,F as v,I as Me,E as I,H as r,u as o,M as x,W as De,R as $,U as Z,G as u,K as Te,ak as Be,C as z,X as Ee,Y as Re,N as Fe,D as He}from"./hdos_CuoKFWGhtyMD6PE8b4uue.js";import{a as Y}from"./hdos_DaRSEFpqf81ZuDgc4Rzsj.js";import{k as Le,u as Oe,a as Ue,x as je,L as Ne,g as Ve,b as D,J as T,M as Ze,A as ze,B,F as ee,G as te,H as ae,I as C,z as Ge,N as Qe,O as oe,P as We,Q as Ke}from"./hdos_ckH0d3GmSDK-z9F8gX_l-.js";import{_ as Xe}from"./hdos_vkkUrw9q2ozTqNHWlgeXU.js";import{d as se}from"./hdos_itWSuQ2oYLgMGq-Z_V6WL.js";import{d as qe}from"./hdos_C5l3yA4rfWsQeonAlErEl.js";import{e as ne}from"./hdos_DaPixzywKmld_Ur82K_nj.js";import{h as G}from"./hdos_BKPjeHGrzS47kEPOz-apr.js";import"./hdos_Dz3aTMQqM4LnOlKzV3COc.js";import"./hdos_CE1G-McAXm7G2-tH-xmrF.js";import"./hdos_BTjx4GUb_InXPN5k1Yckl.js";import"./hdos_DSogZ-918WAgvhujrpekz.js";import"./hdos_vuT7H-UC-v8aszDwotiDB.js";const Je={width:24,height:24,body:'<path fill="currentColor" d="M13 13h-2V7h2m0 10h-2v-2h2M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/>'},Q={width:24,height:24,body:'<path fill="currentColor" d="M12 13a5 5 0 0 1-5-5h2a3 3 0 0 0 3 3a3 3 0 0 0 3-3h2a5 5 0 0 1-5 5m0-10a3 3 0 0 1 3 3H9a3 3 0 0 1 3-3m7 3h-2a5 5 0 0 0-5-5a5 5 0 0 0-5 5H5c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2Z"/>'},Pe={width:24,height:24,body:'<path fill="currentColor" d="M17 13h-4v4h-2v-4H7v-2h4V7h2v4h4m-5-9A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/>'},Ye={class:"flex flex-col h-full overflow-hidden"},et={class:"relative flex items-center gap-3"},tt=["onClick"],at={class:"max-[480px]:hidden"},ot={class:"relative flex-1 overflow-y-auto"},st={key:0,class:"flex flex-col items-center justify-center px-8 py-16 text-center"},nt={key:1,class:"flex flex-col items-center justify-center px-8 py-16 text-center"},lt={key:2,class:"px-6 md:px-4 py-4"},rt={class:"flex flex-col gap-2"},it=["onClick","onMouseenter"],ct={class:"flex-1 min-w-0"},pt={key:0},ut={class:"flex-shrink-0"},dt=["onClick","title"],ft={class:"space-y-2.5 max-w-sm"},mt={class:"flex items-center gap-2"},Mt=_e({__name:"AppExplorer",setup(ht){const E=Le(),R=Oe(),F=Ue(),le=je(),{isMobile:re}=Ne(),{themeClasses:n}=Ae(),f=_(""),d=_("all"),m=_(0),W=_(null),M=_([]),K=_(!0),H=Ve(),ie=y(()=>{const e=(t,a)=>d.value===t?t==="all"&&!f.value.trim()?a:b.value.length:a;return[{id:"all",label:"All",icon:qe,count:e("all",j.value)},{id:"apps",label:"Apps",icon:D,count:e("apps",L.value.length+O.value.length)},{id:"files",label:"Files",icon:T,count:e("files",M.value.length)},{id:"available",label:"Available",icon:Q,count:e("available",U.value.length)}]}),L=y(()=>Ze().filter(e=>e.showInStartMenu!==!1)),O=y(()=>E.mainDockerApps.filter(e=>e.status==="running")),U=y(()=>R.apps.filter(e=>!e.is_installed)),j=y(()=>L.value.length+O.value.length+M.value.length+U.value.length);async function X(){try{const e=await Y.get("/api/get_files",{headers:{"X-HomeDock-CSRF-Token":H.value}});M.value=e.data.files||[]}catch(e){console.error("Failed to fetch DropZone files:",e)}}async function ce(){try{K.value=!0,await R.loadApps(H.value)}catch(e){console.error("Failed to load available apps:",e)}finally{K.value=!1}}function N(e,t){if(!e||!t)return 0;const a=e.toLowerCase(),s=t.toLowerCase();if(a===s)return 100;if(a.startsWith(s))return 95;const l=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(`\\b${l}\\b`,"i").test(a))return 90;if(a.includes(s))return 85;const g=a.split(/[\s-_]+/);for(const S of g){if(S.startsWith(s))return 80;if(S.includes(s))return 75}let w=0,k=0,A=0;for(;w<a.length&&k<s.length;)a[w]===s[k]&&(A++,k++),w++;if(k===s.length){const S=A/s.length,Se=1-(w-A)/a.length;return Math.floor(60*S*Se)}if(A>0){const S=A/s.length*40;return Math.floor(S)}return 0}const pe=y(()=>{const e=[];return L.value.forEach(t=>{e.push({id:`system-${t.id}`,type:"system",name:t.name,description:t.description,icon:t.icon,category:"System Apps",score:0,action:()=>E.openSystemApp(t.id)})}),O.value.forEach(t=>{e.push({id:`docker-${t.id}`,type:"docker",name:t.name,description:t.image,image_path:t.image_path,category:"Installed Apps",score:0,action:()=>E.openDockerApp(t)})}),M.value.forEach(t=>{e.push({id:`file-${t.name}`,type:"file",name:t.name,description:"Encrypted file",icon:ue(t.name),category:"Files",size:t.size,modified:t.modified,score:0,action:()=>ye(t.name)})}),U.value.forEach(t=>{e.push({id:`available-${t.name}`,type:"available",name:t.name,description:t.category,image_path:`docker-icons/${t.name}.jpg`,category:"Available in Store",score:0,action:()=>be(t.name)})}),e}),b=y(()=>{const e=f.value.trim(),t=e.length>0;if(d.value==="all"&&!t)return[];let a=[...pe.value];if(d.value!=="all"){const l={apps:["system","docker"],files:["file"],available:["available"]}[d.value]||[];a=a.filter(h=>l.includes(h.type))}return t?a=a.map(l=>{const h=N(l.name,e),g=l.description?N(l.description,e):0,w=N(l.category,e),k=Math.max(h,g*.8,w*.5);return{...l,score:k}}).filter(l=>l.score>=60).sort((l,h)=>h.score-l.score):a=a.sort((s,l)=>s.type==="system"&&l.type==="system"?0:s.type==="system"?-1:l.type==="system"?1:s.name.localeCompare(l.name)),a}),q=y(()=>{const e={};b.value.forEach(a=>{e[a.category]||(e[a.category]=[]),e[a.category].push(a)});const t={"System Apps":D,"Installed Apps":D,Files:T,"Available in Store":Q};return Object.keys(e).map(a=>({category:a,title:a,icon:t[a]||ze,items:e[a]}))});function J(e,t){let a=0;for(let s=0;s<e;s++)a+=q.value[s].items.length;return a+t}function ue(e){const t=e.split(".").pop()?.toLowerCase();return{png:C,jpg:C,jpeg:C,gif:C,webp:C,mp4:ae,mkv:ae,mp3:te,wav:te,zip:ee,rar:ee,js:B,ts:B,py:B,vue:B}[t||""]||T}function de(e){return e>=1e9?(e/1e9).toFixed(2)+" GB":e>=1e6?(e/1e6).toFixed(2)+" MB":e>=1e3?(e/1e3).toFixed(2)+" KB":e+" B"}function fe(e){if(!e)return"";const t=new Date,a=typeof e=="number"?new Date(e*1e3):new Date(e),s=Math.floor((t.getTime()-a.getTime())/1e3);return s<60?"Just now":s<3600?`${Math.floor(s/60)}m ago`:s<86400?`${Math.floor(s/3600)}h ago`:s<2592e3?`${Math.floor(s/86400)}d ago`:`${Math.floor(s/2592e3)}mo ago`}function me(e){return{system:"System",docker:"Running",file:"File",available:"Available"}[e]||e}function he(e){return{system:n.value.explorerBadgeSystem,docker:n.value.explorerBadgeDocker,file:n.value.explorerBadgeFile,available:n.value.explorerBadgeAvailable}[e]||""}function ve(e){return{system:ne,docker:Ke,file:We,available:Pe}[e]||ne}function xe(e){return{system:"Open",docker:"Open",file:"Download",available:"View in Store"}[e]||"Open"}function V(e){e.action()}async function ye(e){try{const t=await Y.get(`/api/download_file?file=${encodeURIComponent(e)}`,{headers:{"X-HomeDock-CSRF-Token":H.value},responseType:"blob"}),a=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=a,s.setAttribute("download",e),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(a),G.success(`Downloading ${e}`)}catch{G.error("Failed to download file")}}function be(e){const t=R.apps.find(s=>s.name===e);if(!t){G.error(`App ${e} not found`);return}const a=F.windows.find(s=>s.appId==="installconfig"&&s.data?.app?.name===t.name);if(a){F.focusWindow(a.id),a.isMinimized&&(a.isMinimized=!1);return}F.openWindow("installconfig",{title:`Install ${t.name}`,data:{app:t},allowMultiple:!0})}function ge(){return{all:"No items available",apps:"No apps found",files:"No files in Drop Zone",available:"All apps are already installed"}[d.value]||"No items found"}function we(){return{all:"Start by installing apps or uploading files",apps:"Install apps from the App Store to get started",files:"Upload files to Drop Zone to see them here",available:"Great! All available apps are installed"}[d.value]||""}function P(){f.value="",m.value=0}function ke(e){const t=b.value.length-1;switch(e.key){case"ArrowDown":e.preventDefault(),m.value=Math.min(m.value+1,t);break;case"ArrowUp":e.preventDefault(),m.value=Math.max(m.value-1,0);break;case"Enter":e.preventDefault(),b.value[m.value]&&V(b.value[m.value]);break;case"Escape":e.preventDefault(),P();break}}return Ie(async()=>{await Promise.all([ce(),X()]),re.value||$e(()=>{W.value?.focus()})}),Ce(()=>le.currentlyUploading,(e,t)=>{t&&!e&&setTimeout(()=>{X()},500)}),(e,t)=>(c(),p("div",Ye,[i("div",{class:r(["px-6 md:px-4 py-5 border-b",o(n).explorerHeaderBorder])},[i("div",et,[v(o(x),{icon:o(se),class:r([o(n).explorerSearchIcon,"absolute left-4 w-5 h-5 pointer-events-none"])},null,8,["icon","class"]),Me(i("input",{ref_key:"searchInputRef",ref:W,"onUpdate:modelValue":t[0]||(t[0]=a=>f.value=a),type:"text",placeholder:"Search apps, files, and more...",class:r(["flex-1 py-3 pr-4 pl-12 rounded-lg border text-sm outline-none transition-all duration-200",[o(n).explorerSearchInput,o(n).explorerSearchInputText,o(n).explorerSearchInputFocusRing]]),onKeydown:ke},null,34),[[De,f.value]]),f.value?(c(),p("button",{key:0,onClick:P,class:r(["absolute right-2 p-2 border-none bg-transparent cursor-pointer rounded transition-all duration-150",[o(n).explorerClearButton,o(n).explorerClearButtonHover]])},[v(o(x),{icon:o(Ge),class:"w-4 h-4"},null,8,["icon"])],2)):I("",!0)])],2),i("div",{class:r(["flex gap-2 px-6 md:px-4 py-4 border-b overflow-x-auto [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",o(n).explorerHeaderBorder])},[(c(!0),p($,null,Z(ie.value,a=>(c(),p("button",{key:a.id,onClick:s=>d.value=a.id,class:r(["flex items-center gap-2 md:gap-1.5 px-4 md:px-3 py-2 rounded-lg border-none text-sm md:text-[0.8125rem] font-medium cursor-pointer transition-all duration-150 whitespace-nowrap max-[480px]:min-w-12 max-[480px]:px-2",d.value===a.id?o(n).explorerTabActive:[o(n).explorerTabInactive,o(n).explorerTabHover]])},[v(o(x),{icon:a.icon,class:"w-4 h-4 md:w-4 md:h-4"},null,8,["icon"]),i("span",at,u(a.label),1),a.count>0?(c(),p("span",{key:0,class:r(["text-xs md:text-[0.6875rem] px-2 md:px-1.5 py-0.5 md:py-0 rounded-full font-semibold",d.value===a.id?o(n).explorerTabCountActive:o(n).explorerTabCountInactive])},u(a.count),3)):I("",!0)],10,tt))),128))],2),i("div",ot,[!f.value.trim()&&d.value==="all"?(c(),p("div",st,[v(Te,{icons:[o(se),o(D),o(T),o(Q)],iconSize:64,interval:2e3,containerClass:"mb-4",class:r(o(n).explorerEmptyIcon)},null,8,["icons","class"]),i("p",{class:r([o(n).explorerEmptyText,"text-base font-medium mb-2 text-balance"])},"Start typing to search across HomeDock OS",2),i("div",{class:r(["mt-8 text-left max-w-md",o(n).explorerQuickTips])},[...t[1]||(t[1]=[Be('<p class="text-sm font-semibold mb-2">Quick tips:</p><ul class="list-none p-0 text-[0.8125rem] leading-relaxed"><li class="before:content-[&#39;•&#39;] before:mr-2 before:opacity-50">Search for apps, files, or available software</li><li class="before:content-[&#39;•&#39;] before:mr-2 before:opacity-50">Use filters to narrow down results</li><li class="before:content-[&#39;•&#39;] before:mr-2 before:opacity-50">Select a category above to browse items</li></ul>',2)])],2)])):b.value.length===0?(c(),p("div",nt,[v(o(x),{icon:o(Je),class:r([o(n).explorerEmptyIcon,"w-16 h-16 mb-4"])},null,8,["icon","class"]),f.value?(c(),p($,{key:0},[i("p",{class:r([o(n).explorerEmptyText,"text-base font-medium mb-2"])},'No results found for "'+u(f.value)+'"',3),i("p",{class:r([o(n).explorerEmptySubtext,"text-sm"])},"Try different keywords or check your spelling",2)],64)):(c(),p($,{key:1},[i("p",{class:r([o(n).explorerEmptyText,"text-base font-medium mb-2"])},u(ge()),3),i("p",{class:r([o(n).explorerEmptySubtext,"text-sm"])},u(we()),3)],64))])):(c(),p("div",lt,[(c(!0),p($,null,Z(q.value,(a,s)=>(c(),p("div",{key:a.category,class:"mb-8 last:mb-0"},[i("h3",{class:r(["flex items-center gap-2 text-xs font-semibold uppercase tracking-wider mb-3",o(n).explorerGroupHeader])},[v(o(x),{icon:a.icon,class:"w-4 h-4"},null,8,["icon"]),i("span",null,u(a.title),1),i("span",{class:r(["opacity-50 font-normal",o(n).explorerGroupCount])},"("+u(a.items.length)+")",3)],2),i("div",rt,[(c(!0),p($,null,Z(a.items,(l,h)=>(c(),p("div",{key:l.id,onClick:g=>V(l),onMouseenter:g=>m.value=J(s,h),class:r(["flex items-center gap-4 px-3 py-3 rounded-lg cursor-pointer transition-all duration-150",[o(n).explorerResultItem,o(n).explorerResultItemHover,m.value===J(s,h)?o(n).explorerResultItemSelected:""]])},[i("div",{class:r(["flex-shrink-0 w-12 h-12 md:w-10 md:h-10 flex items-center justify-center rounded-lg overflow-hidden",l.type==="docker"?"bg-transparent p-0":""])},[l.image_path?(c(),z(Ee,{key:0,src:l.image_path,alt:"",class:"w-full h-full object-cover",draggable:"false"},null,8,["src"])):l.icon?(c(),z(o(x),{key:1,icon:l.icon,class:r([o(n).explorerItemIcon,"w-8 h-8"])},null,8,["icon","class"])):(c(),z(o(x),{key:2,icon:o(Qe),class:r([o(n).explorerItemIcon,"w-8 h-8"])},null,8,["icon","class"]))],2),i("div",ct,[i("div",{class:r(["text-sm font-medium overflow-hidden text-ellipsis whitespace-nowrap",o(n).explorerItemName])},u(l.name),3),l.description?(c(),p("div",{key:0,class:r(["text-xs mt-0.5 overflow-hidden text-ellipsis whitespace-nowrap",o(n).explorerItemDescription])},u(l.description),3)):I("",!0),l.size?(c(),p("div",{key:1,class:r(["text-xs mt-0.5",o(n).explorerItemMeta])},[Re(u(de(l.size))+" ",1),l.modified?(c(),p("span",pt," • "+u(fe(l.modified)),1)):I("",!0)],2)):I("",!0)]),i("div",{class:r(["flex-shrink-0 px-2 py-1 rounded text-[0.625rem] font-semibold uppercase",he(l.type)])},u(me(l.type)),3),i("div",ut,[i("button",{onClick:Fe(g=>V(l),["stop"]),class:r(["p-2 rounded-md border-none cursor-pointer transition-all duration-150",[o(n).explorerActionButton,o(n).explorerActionButtonHover]]),title:xe(l.type)},[v(o(x),{icon:ve(l.type),class:"w-4 h-4"},null,8,["icon"])],10,dt)])],42,it))),128))])]))),128))]))]),v(Xe,{icon:o(oe),message:"Explorer",info:`${j.value} ${j.value===1?"item":"items"} available`,showHelp:!0},{help:He(()=>[i("div",ft,[i("div",mt,[v(o(x),{icon:o(oe),class:r(["w-5 h-5",o(n).statusBarIcon])},null,8,["icon","class"]),i("h4",{class:r(["text-base font-semibold",o(n).statusBarText])},"Explorer",2)]),i("div",{class:r(["text-[10px] md:text-xs space-y-2 leading-relaxed",o(n).statusBarInfo])},[...t[2]||(t[2]=[i("p",null,"Search across all available content in HomeDock OS including system applications, installed applications, available software from the App Store, and encrypted files stored in Drop Zone. Use filters to narrow results by category or search by name to quickly find what you need.",-1)])],2)])]),_:1},8,["icon","info"])]))}});export{Mt as default};
