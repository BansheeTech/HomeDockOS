import{I as P,o as y,O as D,B as E,b as g,v as C}from"./hdos_OIxCipLLecMZlhY603d5p.js";import{e as O,V as p,L as b,d as B,o as k}from"./hdos_DrLYHBVTzGKueIqeVa0-U.js";import{a as I}from"./hdos_DZUKIvxDT3Fqh7rzmD7rn.js";import{j}from"./hdos_CwymDqZtnzGXivLYQ6fBS.js";var x={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z"}}]},name:"right",theme:"outlined"};function v(e){for(var s=1;s<arguments.length;s++){var t=arguments[s]!=null?Object(arguments[s]):{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),n.forEach(function(r){N(e,r,t[r])})}return e}function N(e,s,t){return s in e?Object.defineProperty(e,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[s]=t,e}var R=function(s,t){var n=v({},s,t.attrs);return O(P,v({},n,{icon:x}),null)};R.displayName="RightOutlined";R.inheritAttrs=!1;const F=()=>{const e=p(!1);return b(()=>{e.value=!0}),e},L={type:{type:String},actionFn:Function,close:Function,autofocus:Boolean,prefixCls:String,buttonProps:y(),emitEvent:Boolean,quitOnNullishReturnValue:Boolean};function S(e){return!!(e&&e.then)}const z=B({compatConfig:{MODE:3},name:"ActionButton",props:L,setup(e,s){let{slots:t}=s;const n=p(!1),r=p(),c=p(!1);let d;const u=F();k(()=>{e.autofocus&&(d=setTimeout(()=>{var a,o;return(o=(a=D(r.value))===null||a===void 0?void 0:a.focus)===null||o===void 0?void 0:o.call(a)}))}),b(()=>{clearTimeout(d)});const i=function(){for(var a,o=arguments.length,l=new Array(o),f=0;f<o;f++)l[f]=arguments[f];(a=e.close)===null||a===void 0||a.call(e,...l)},m=a=>{S(a)&&(c.value=!0,a.then(function(){u.value||(c.value=!1),i(...arguments),n.value=!1},o=>(u.value||(c.value=!1),n.value=!1,Promise.reject(o))))},A=a=>{const{actionFn:o}=e;if(n.value)return;if(n.value=!0,!o){i();return}let l;if(e.emitEvent){if(l=o(a),e.quitOnNullishReturnValue&&!S(l)){n.value=!1,i(a);return}}else if(o.length)l=o(e.close),n.value=!1;else if(l=o(),!l){i();return}m(l)};return()=>{const{type:a,prefixCls:o,buttonProps:l}=e;return O(E,g(g(g({},C(a)),{},{onClick:A,loading:c.value,prefixCls:o},l),{},{ref:r}),t)}}}),M=j("selectedApps",{state:()=>({selectedApps:[],applications:[],desiredStates:{},errorStates:{}}),actions:{setApplications(e){const s=this.applications;this.applications=e.map(t=>{const n=s.find(u=>u.name===t.name);if(!n)return{...t,isProcessing:!1,checked:this.selectedApps.includes(t.name)};let r=n.isProcessing;const c=this.desiredStates[t.name];return c&&t.status===c&&(r=!1,delete this.desiredStates[t.name]),n.status!==t.status&&(r=!1),{...t,isProcessing:r,checked:this.selectedApps.includes(t.name)}})},setDesiredState(e,s){this.desiredStates[e]=s},clearDesiredState(e){delete this.desiredStates[e]},getDesiredState(e){return this.desiredStates[e]},setErrorState(e,s){this.errorStates[e]=s},clearErrorState(e){delete this.errorStates[e]},saveOrder(){const e="dashboardLocalOrder",s=this.applications.filter(t=>t.HDRole!=="dependency").map(t=>t.name);localStorage.setItem(e,JSON.stringify(s))},updateSelection(e){this.selectedApps=e,this.applications.forEach(s=>{s.checked=e.includes(s.name)})},clearSelection(){this.selectedApps=[],this.applications.forEach(e=>{e.checked=!1})},toggleSelection(e){const s=this.applications.find(t=>t.name===e);s&&(s.checked=!s.checked,s.checked?this.selectedApps.push(s.name):this.selectedApps=this.selectedApps.filter(t=>t!==e))},setProcessing(e,s){const t=this.applications.find(n=>n.name===e);t&&(t.isProcessing=s)}}});let h=null;async function T(e){const s=M();try{const t=await I.get("/api/containers",{headers:{"X-HomeDock-CSRF-Token":e}});if(t.status===200){const n=t.data,r=V(n);return s.setApplications(r),r}return[]}catch(t){throw console.error("Error fetching containers:",t),t}}function V(e){const t=localStorage.getItem("dashboardLocalOrder");if(!t)return e;const n=JSON.parse(t),r=e.filter(i=>i.HDRole!=="dependency"),c=e.filter(i=>i.HDRole==="dependency"),d=n.map(i=>r.find(m=>m.name===i)).filter(Boolean),u=r.filter(i=>!n.includes(i.name));return[...d,...u,...c]}function K(e,s=3e3){_(),h=setInterval(()=>T(e),s)}function _(){h&&(clearInterval(h),h=null)}export{z as A,R,_ as a,T as f,K as s,M as u};
