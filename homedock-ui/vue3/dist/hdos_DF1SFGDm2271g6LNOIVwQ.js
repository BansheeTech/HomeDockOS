import{M as Ee,bQ as Be,aU as S,q as g,aD as Ue,as as He,bE as ce,u,aL as d,v as i,I as b,bL as Le,t as _,au as n,bk as s,bU as w,bA as Oe,F as R,aX as N,bb as m,bT as ze,G as je,aw as Pe,s as q,bV as Ve,H as Ze,bO as Qe,bJ as We}from"./hdos_BnIymrgN3FMaW96NhsgWi.js";import{a as $}from"./hdos_DahYSjy4MuyfOawe4NtU9.js";import{u as Ge,r as Xe,a as Ne,s as qe,t as Ke,c as Je,o as L,v as O,g as Ye,U as et,f as K,q as tt,w as z,x as de,y as pe,z as ue,A as M,B as ot,C as at,D as fe,j as me,E as st}from"./hdos_DMBX8EgZFkFEssZyeFxZ3.js";import{_ as lt}from"./hdos_BcWAxXmlibZ2SSqtP9a_8.js";import{d as ve}from"./hdos_itWSuQ2oYLgMGq-Z_V6WL.js";import{d as rt}from"./hdos_D4VENToS-RM0shQaDqhsL.js";import{d as nt}from"./hdos_C5l3yA4rfWsQeonAlErEl.js";import{d as it}from"./hdos_Dk8ORdgBuQt10zGqyIF6s.js";import{e as J}from"./hdos_B3Gn8FiDAIlVGTwMyO36P.js";import{d as ct}from"./hdos_DzD_9-ae9bJuHOkfQ9Haz.js";import{l as k}from"./hdos_BwFNaVKxrzJr1i43ZL7xh.js";import"./hdos_Dz3aTMQqM4LnOlKzV3COc.js";import"./hdos_DCQvziD-0BGtLQC-jPv6N.js";import"./hdos_CJoaCRc7PMIr83ndc1bSY.js";import"./hdos_CtY2UTrCU7CborQ9sr8jv.js";import"./hdos_Cuccj8xUVyEDTvA_fcq1n.js";import"./hdos_TIm5gfXqLWlO6DtkdAyHA.js";import"./hdos_CDFYpsm_-2sqqpjcHcxLG.js";const Y={width:24,height:24,body:'<path fill="currentColor" d="M12 13a5 5 0 0 1-5-5h2a3 3 0 0 0 3 3a3 3 0 0 0 3-3h2a5 5 0 0 1-5 5m0-10a3 3 0 0 1 3 3H9a3 3 0 0 1 3-3m7 3h-2a5 5 0 0 0-5-5a5 5 0 0 0-5 5H5c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2Z"/>'},dt={class:"flex flex-col h-full overflow-hidden"},pt={class:"relative flex items-center gap-3"},ut=["onClick"],ft={class:"max-[480px]:hidden"},mt={class:"relative flex-1 overflow-y-auto"},vt={key:0,class:"flex flex-col items-center justify-center px-8 py-16 text-center"},yt={key:1,class:"flex flex-col items-center justify-center px-8 py-16 text-center"},ht={key:2,class:"px-4 md:px-4 py-4"},xt={class:"flex flex-col gap-2"},gt=["onClick","onMouseenter"],bt={class:"flex-1 min-w-0 z-[1]"},wt={key:0},kt={class:"flex-shrink-0 z-[1]"},St=["onClick","title"],_t={class:"space-y-2.5 max-w-sm"},$t={class:"flex items-center gap-2"},Qt=Ee({__name:"AppExplorer",setup(At){const E=Ge(),j=Xe(),B=Ne(),ee=qe(),{isMobile:ye}=Ke(),{themeClasses:r}=Be(),h=S(""),y=S("all"),x=S(0),te=S(null),U=S([]),H=S([]),oe=S(!0),f=S({}),A=Je(),he=g(()=>{const e=(t,o)=>y.value===t?t==="all"&&!h.value.trim()?o:D.value.length:o;return[{id:"all",label:"All",icon:nt,count:e("all",W.value)},{id:"apps",label:"Apps",icon:L,count:e("apps",P.value.length+V.value.length+Z.value.length)},{id:"files",label:"Files",icon:O,count:e("files",H.value.length+U.value.length)},{id:"available",label:"Available",icon:Y,count:e("available",Q.value.length)}]}),P=g(()=>Ye()),V=g(()=>et),Z=g(()=>E.mainDockerApps.filter(e=>e.status==="running")),Q=g(()=>j.apps.filter(e=>!e.is_installed)),W=g(()=>P.value.length+V.value.length+Z.value.length+H.value.length+U.value.length+Q.value.length);async function ae(){try{const e=await $.get("/api/dropzone/files",{headers:{"X-HomeDock-CSRF-Token":A.value}});U.value=e.data.files||[]}catch(e){console.error("Failed to fetch DropZone files:",e)}}async function se(){try{const e=[],o=(await $.get("/api/storage/files",{headers:{"X-HomeDock-CSRF-Token":A.value},params:{path:""}})).data.files||[];for(const a of o)if(a.is_directory)try{const c=(await $.get("/api/storage/files",{headers:{"X-HomeDock-CSRF-Token":A.value},params:{path:a.name}})).data.files||[];for(const p of c)if(!p.is_directory){const v=p.name.split("/").pop()||p.name;e.push({...p,fullPath:p.name,displayName:v})}}catch{console.warn(`Could not read folder: ${a.name}`)}else e.push({...a,fullPath:a.name});H.value=e}catch(e){console.error("Failed to fetch Storage files:",e)}}async function xe(){try{oe.value=!0,await j.loadApps(A.value)}catch(e){console.error("Failed to load available apps:",e)}finally{oe.value=!1}}function G(e,t){if(!e||!t)return 0;const o=e.toLowerCase(),a=t.toLowerCase();if(o===a)return 100;if(o.startsWith(a))return 95;const l=a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(`\\b${l}\\b`,"i").test(o))return 90;if(o.includes(a))return 85;const p=o.split(/[\s-_]+/);for(const T of p){if(T.startsWith(a))return 80;if(T.includes(a))return 75}let v=0,C=0,F=0;for(;v<o.length&&C<a.length;)o[v]===a[C]&&(F++,C++),v++;if(C===a.length){const T=F/a.length,Me=1-(v-F)/o.length;return Math.floor(60*T*Me)}if(F>0){const T=F/a.length*40;return Math.floor(T)}return 0}const ge=g(()=>{const e=[];return P.value.forEach(t=>{e.push({id:`system-${t.id}`,type:"system",name:t.name,description:t.description,icon:t.icon,category:"System Apps",score:0,action:()=>E.openSystemApp(t.id)})}),V.value.forEach(t=>{e.push({id:`utility-${t.id}`,type:"utility",name:t.name,description:t.description,icon:t.icon,category:"Utilities",score:0,action:()=>B.openWindow(t.id,{title:t.name,allowMultiple:!0})})}),Z.value.forEach(t=>{e.push({id:`docker-${t.id}`,type:"docker",name:t.display_name||t.name,description:t.image,image_path:t.image_path,category:"Installed Apps",score:0,action:()=>E.openDockerApp(t)})}),H.value.forEach(t=>{const o=t.displayName||t.name.split("/").pop()||t.name;e.push({id:`storage-${t.fullPath}`,type:"storage-file",name:o,description:t.fullPath,icon:ne(o),category:"Storage",size:t.size,modified:t.modified,score:0,action:()=>De(t.fullPath)})}),U.value.forEach(t=>{const o=t.is_directory===!0;e.push({id:`${o?"folder":"file"}-${t.name}`,type:o?"folder":"file",name:t.name,description:o?"Folder":"Encrypted file",icon:o?K:ne(t.name),category:"Drop Zone",size:t.size,modified:t.modified,score:0,action:()=>o?Ie(t.name):Ae(t.name)})}),Q.value.forEach(t=>{e.push({id:`available-${t.name}`,type:"available",name:t.display_name||t.name,description:t.category,image_path:t.picture_path||`docker-icons/${t.name}.jpg`,category:"Available in Store",score:0,action:()=>Ce(t.name)})}),e}),D=g(()=>{const e=h.value.trim(),t=e.length>0;if(y.value==="all"&&!t)return[];let o=[...ge.value];if(y.value!=="all"){const l={apps:["system","utility","docker"],files:["file","folder","storage-file"],available:["available"]}[y.value]||[];o=o.filter(c=>l.includes(c.type))}return t?o=o.map(l=>{const c=G(l.name,e),p=l.description?G(l.description,e):0,v=G(l.category,e),C=Math.max(c,p*.8,v*.5);return{...l,score:C}}).filter(l=>l.score>=60).sort((l,c)=>c.score-l.score):o=o.sort((a,l)=>{const c={system:0,utility:1,"storage-file":2,folder:3,file:4,docker:5,available:6},p=c[a.type]??999,v=c[l.type]??999;return p!==v?p-v:a.name.localeCompare(l.name)}),o}),le=g(()=>{const e={};D.value.forEach(o=>{e[o.category]||(e[o.category]=[]),e[o.category].push(o)});const t={"System Apps":L,Utilities:tt,"Installed Apps":L,Storage:K,"Drop Zone":O,"Available in Store":Y};return Object.keys(e).map(o=>({category:o,title:o,icon:t[o]||K,items:e[o]}))});function re(e,t){let o=0;for(let a=0;a<e;a++)o+=le.value[a].items.length;return o+t}function I(e){const t=e.type==="storage-file"?e.description:e.name;return t?f.value[t]??-1:-1}function ne(e){const t=e.split(".").pop()?.toLowerCase();return{png:M,jpg:M,jpeg:M,gif:M,webp:M,mp4:ue,mkv:ue,mp3:pe,wav:pe,zip:de,rar:de,js:z,ts:z,py:z,vue:z}[t||""]||O}function be(e){return e>=1e9?(e/1e9).toFixed(2)+" GB":e>=1e6?(e/1e6).toFixed(2)+" MB":e>=1e3?(e/1e3).toFixed(2)+" KB":e+" B"}function we(e){if(!e)return"";const t=new Date,o=typeof e=="number"?new Date(e*1e3):new Date(e),a=Math.floor((t.getTime()-o.getTime())/1e3);return a<60?"Just now":a<3600?`${Math.floor(a/60)}m ago`:a<86400?`${Math.floor(a/3600)}h ago`:a<2592e3?`${Math.floor(a/86400)}d ago`:`${Math.floor(a/2592e3)}mo ago`}function ke(e){return{system:"System",utility:"Utility",docker:"Running","storage-file":"File",file:"Encrypted",folder:"Folder",available:"Available"}[e]||e}function Se(e){return{system:r.value.explorerBadgeSystem,utility:r.value.explorerBadgeSystem,docker:r.value.explorerBadgeDocker,"storage-file":r.value.explorerBadgeFile,file:r.value.explorerBadgeFile,folder:r.value.explorerBadgeFile,available:r.value.explorerBadgeAvailable}[e]||""}function _e(e){return{system:J,utility:J,docker:st,"storage-file":me,file:me,folder:it,available:ct}[e]||J}function $e(e){return{system:"Open",utility:"Open",docker:"Open","storage-file":"Download",file:"Download",folder:"Open",available:"View in Store"}[e]||"Open"}function X(e){e.action()}async function Ae(e){if(f.value[e]!==void 0&&f.value[e]<100&&f.value[e]>0){k.info(`Download for ${e} is already in progress.`);return}try{f.value[e]=0;const t=await $.get(`/api/dropzone/download?file=${encodeURIComponent(e)}`,{headers:{"X-HomeDock-CSRF-Token":A.value},responseType:"blob",onDownloadProgress:c=>{if(c.total){const p=Math.round(c.loaded*100/c.total);f.value[e]=p}}}),o=window.URL.createObjectURL(new Blob([t.data])),a=document.createElement("a");a.href=o;const l=e.split("/").pop()||e;a.setAttribute("download",l),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(o),k.success(`Downloaded ${e}`),setTimeout(()=>{delete f.value[e]},1e3)}catch(t){console.error("Failed to download file:",e,t),delete f.value[e],$.isAxiosError(t)?k.error(t.response?.data?.error_message||"Failed to download file. Please try again."):k.error("Failed to download file. Please try again.")}}async function De(e){if(f.value[e]!==void 0&&f.value[e]<100&&f.value[e]>0){k.info(`Download for ${e} is already in progress.`);return}try{f.value[e]=0;const t=await $.get("/api/storage/download",{headers:{"X-HomeDock-CSRF-Token":A.value},params:{file:e},responseType:"blob",onDownloadProgress:c=>{if(c.total){const p=Math.round(c.loaded*100/c.total);f.value[e]=p}}}),o=window.URL.createObjectURL(new Blob([t.data])),a=document.createElement("a");a.href=o;const l=e.split("/").pop()||e;a.setAttribute("download",l),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(o),k.success(`Downloaded ${l}`),setTimeout(()=>{delete f.value[e]},1e3)}catch(t){console.error("Failed to download storage file:",e,t),delete f.value[e],$.isAxiosError(t)?k.error(t.response?.data?.error_message||"Failed to download file. Please try again."):k.error("Failed to download file. Please try again.")}}function Ie(e){E.openSystemApp("fileexplorer")}function Ce(e){const t=j.apps.find(a=>a.name===e);if(!t){k.error(`App ${e} not found`);return}const o=B.windows.find(a=>a.appId==="installconfig"&&a.data?.app?.name===t.name);if(o){B.focusWindow(o.id),o.isMinimized&&(o.isMinimized=!1);return}B.openWindow("installconfig",{title:`Install ${t.display_name||t.name}`,data:{app:t},allowMultiple:!0})}function Te(){return{all:"No items available",apps:"No apps found",files:"No files in Drop Zone",available:"All apps are already installed"}[y.value]||"No items found"}function Fe(){return{all:"Start by installing apps or uploading files",apps:"Install apps from the App Store to get started",files:"Upload files to Drop Zone to see them here",available:"Great! All available apps are installed"}[y.value]||""}function ie(){h.value="",x.value=0}function Re(e){const t=D.value.length-1;switch(e.key){case"ArrowDown":e.preventDefault(),x.value=Math.min(x.value+1,t);break;case"ArrowUp":e.preventDefault(),x.value=Math.max(x.value-1,0);break;case"Enter":e.preventDefault(),D.value[x.value]&&X(D.value[x.value]);break;case"Escape":e.preventDefault(),ie();break}}return Ue(async()=>{await Promise.all([xe(),ae(),se()]),ye.value||He(()=>{te.value?.focus()})}),ce(()=>ee.currentlyUploadingAt("dropzone"),(e,t)=>{t&&t.length>0&&(!e||e.length===0)&&setTimeout(()=>{ae()},500)}),ce(()=>ee.currentlyUploadingAt("storage"),(e,t)=>{t&&t.length>0&&(!e||e.length===0)&&setTimeout(()=>{se()},500)}),(e,t)=>(d(),u("div",dt,[i("div",{class:n(["px-4 md:px-4 py-5 border-b",s(r).explorerHeaderBorder])},[i("div",pt,[b(s(w),{icon:s(ve),class:n([s(r).explorerSearchIcon,"absolute left-4 w-5 h-5 pointer-events-none"])},null,8,["icon","class"]),Le(i("input",{ref_key:"searchInputRef",ref:te,"onUpdate:modelValue":t[0]||(t[0]=o=>h.value=o),type:"text",placeholder:"Search apps, files, and more...",class:n(["flex-1 py-3 pr-4 pl-12 rounded-lg border text-sm outline-none transition-all duration-200",[s(r).explorerSearchInput,s(r).explorerSearchInputText,s(r).explorerSearchInputFocusRing]]),onKeydown:Re},null,34),[[Oe,h.value]]),h.value?(d(),u("button",{key:0,onClick:ie,class:n(["absolute right-2 p-2 border-none bg-transparent cursor-pointer rounded transition-all duration-150",[s(r).explorerClearButton,s(r).explorerClearButtonHover]])},[b(s(w),{icon:s(ot),class:"w-4 h-4"},null,8,["icon"])],2)):_("",!0)])],2),i("div",{class:n(["flex gap-2 px-4 md:px-4 py-4 border-b overflow-x-auto [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",s(r).explorerHeaderBorder])},[(d(!0),u(R,null,N(he.value,o=>(d(),u("button",{key:o.id,onClick:a=>y.value=o.id,class:n(["flex items-center gap-2 md:gap-1.5 px-4 md:px-3 py-2 rounded-lg border-none text-sm md:text-[0.8125rem] font-medium cursor-pointer transition-all duration-150 whitespace-nowrap max-[480px]:min-w-12 max-[480px]:px-2",y.value===o.id?s(r).explorerTabActive:[s(r).explorerTabInactive,s(r).explorerTabHover]])},[b(s(w),{icon:o.icon,class:"w-4 h-4 md:w-4 md:h-4"},null,8,["icon"]),i("span",ft,m(o.label),1),o.count>0?(d(),u("span",{key:0,class:n(["text-xs md:text-[0.6875rem] px-2 md:px-1.5 py-0.5 md:py-0 rounded-full font-semibold",y.value===o.id?s(r).explorerTabCountActive:s(r).explorerTabCountInactive])},m(o.count),3)):_("",!0)],10,ut))),128))],2),i("div",mt,[!h.value.trim()&&y.value==="all"?(d(),u("div",vt,[b(ze,{icons:[s(ve),s(L),s(O),s(Y)],iconSize:64,interval:2e3,containerClass:"mb-4",class:n(s(r).explorerEmptyIcon)},null,8,["icons","class"]),i("p",{class:n([s(r).explorerEmptyText,"text-base font-medium mb-2 text-balance"])},"Start typing to search across HomeDock OS",2),i("div",{class:n(["mt-8 text-left max-w-md",s(r).explorerQuickTips])},[...t[1]||(t[1]=[je('<p class="text-sm font-semibold mb-2">Quick tips:</p><ul class="list-none p-0 text-[0.8125rem] leading-relaxed"><li class="before:content-[&#39;•&#39;] before:mr-2 before:opacity-50">Search for apps, files, or available software</li><li class="before:content-[&#39;•&#39;] before:mr-2 before:opacity-50">Use filters to narrow down results</li><li class="before:content-[&#39;•&#39;] before:mr-2 before:opacity-50">Select a category above to browse items</li></ul>',2)])],2)])):D.value.length===0?(d(),u("div",yt,[b(s(w),{icon:s(rt),class:n([s(r).explorerEmptyIcon,"w-16 h-16 mb-4"])},null,8,["icon","class"]),h.value?(d(),u(R,{key:0},[i("p",{class:n([s(r).explorerEmptyText,"text-base font-medium mb-2"])},'No results found for "'+m(h.value)+'"',3),i("p",{class:n([s(r).explorerEmptySubtext,"text-sm"])},"Try different keywords or check your spelling",2)],64)):(d(),u(R,{key:1},[i("p",{class:n([s(r).explorerEmptyText,"text-base font-medium mb-2"])},m(Te()),3),i("p",{class:n([s(r).explorerEmptySubtext,"text-sm"])},m(Fe()),3)],64))])):(d(),u("div",ht,[(d(!0),u(R,null,N(le.value,(o,a)=>(d(),u("div",{key:o.category,class:"mb-8 last:mb-0"},[i("h3",{class:n(["flex items-center gap-2 text-xs font-semibold uppercase tracking-wider mb-3",s(r).explorerGroupHeader])},[b(s(w),{icon:o.icon,class:"w-4 h-4"},null,8,["icon"]),i("span",null,m(o.title),1),i("span",{class:n(["opacity-50 font-normal",s(r).explorerGroupCount])},"("+m(o.items.length)+")",3)],2),i("div",xt,[(d(!0),u(R,null,N(o.items,(l,c)=>(d(),u("div",{key:l.id,onClick:p=>X(l),onMouseenter:p=>x.value=re(a,c),class:n(["relative flex items-center gap-4 px-3 py-3 rounded-lg cursor-pointer transition-all duration-150 overflow-hidden",[s(r).explorerResultItem,s(r).explorerResultItemHover,x.value===re(a,c)?s(r).explorerResultItemSelected:""]])},[(l.type==="file"||l.type==="storage-file")&&I(l)>=0&&I(l)<100?(d(),u("div",{key:0,class:"absolute inset-0 bg-blue-500/20 transition-all duration-300 ease-out",style:Pe({width:`${I(l)}%`})},null,4)):_("",!0),i("div",{class:n(["flex-shrink-0 w-12 h-12 md:w-10 md:h-10 flex items-center justify-center rounded-lg overflow-hidden z-[1]",l.type==="docker"?"bg-transparent p-0":""])},[l.image_path?(d(),q(Ve,{key:0,src:l.image_path,alt:"",class:"w-full h-full object-cover",draggable:"false"},null,8,["src"])):l.icon?(d(),q(s(w),{key:1,icon:l.icon,class:n([s(r).explorerItemIcon,"w-8 h-8"])},null,8,["icon","class"])):(d(),q(s(w),{key:2,icon:s(at),class:n([s(r).explorerItemIcon,"w-8 h-8"])},null,8,["icon","class"]))],2),i("div",bt,[i("div",{class:n(["text-sm font-medium overflow-hidden text-ellipsis whitespace-nowrap",s(r).explorerItemName])},m(l.name),3),l.description?(d(),u("div",{key:0,class:n(["text-xs mt-0.5 overflow-hidden text-ellipsis whitespace-nowrap",s(r).explorerItemDescription])},m(l.description),3)):_("",!0),l.size?(d(),u("div",{key:1,class:n(["text-xs mt-0.5",s(r).explorerItemMeta])},[Ze(m(be(l.size))+" ",1),l.modified?(d(),u("span",wt," • "+m(we(l.modified)),1)):_("",!0)],2)):_("",!0),(l.type==="file"||l.type==="storage-file")&&I(l)>=0&&I(l)<100?(d(),u("div",{key:2,class:n(["text-xs mt-0.5 font-medium",s(r).explorerItemMeta])},"Downloading... "+m(I(l))+"%",3)):_("",!0)]),i("div",{class:n(["flex-shrink-0 px-2 py-1 rounded text-[0.625rem] font-semibold uppercase z-[1]",Se(l.type)])},m(ke(l.type)),3),i("div",kt,[i("button",{onClick:Qe(p=>X(l),["stop"]),class:n(["p-2 rounded-md border-none cursor-pointer transition-all duration-150",[s(r).explorerActionButton,s(r).explorerActionButtonHover]]),title:$e(l.type)},[b(s(w),{icon:_e(l.type),class:"w-4 h-4"},null,8,["icon"])],10,St)])],42,gt))),128))])]))),128))]))]),b(lt,{icon:s(fe),message:"Explorer",info:`${W.value} ${W.value===1?"item":"items"} available`,showHelp:!0},{help:We(()=>[i("div",_t,[i("div",$t,[b(s(w),{icon:s(fe),class:n(["w-5 h-5",s(r).statusBarIcon])},null,8,["icon","class"]),i("h4",{class:n(["text-base font-semibold",s(r).statusBarText])},"Explorer",2)]),i("div",{class:n(["text-[10px] md:text-xs space-y-2 leading-relaxed",s(r).statusBarInfo])},[...t[2]||(t[2]=[i("p",null,"Search across all available content in HomeDock OS including system applications, installed applications, available software from the App Store, and encrypted files stored in Drop Zone. Use filters to narrow results by category or search by name to quickly find what you need.",-1)])],2)])]),_:1},8,["icon","info"])]))}});export{Qt as default};
