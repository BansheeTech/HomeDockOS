import{M as B,bQ as F,q as f,aU as v,aD as M,u as L,aL as U,v as s,I as r,bL as $,bV as z,au as i,bk as o,bb as k,bA as H,bJ as h,bU as g,bR as V}from"./hdos_BmqLjGp9pD_x_NB4upKEB.js";import{a as u}from"./hdos_BbS_vWe5DNlDDYAPlKxdN.js";import{d as Y}from"./hdos_DPi7gOmHlKdoQ5BrTSdrp.js";import{i as j,g as P,ah as C,E as S,C as p,F as x}from"./hdos_DqTSDfW5RXrfBSeHokfqq.js";import{_ as q}from"./hdos_DMJKnaV5q7bUDHeE3EXKM.js";import{E as w}from"./hdos_Cx719D13aXZ3bO74V-vLR.js";import"./hdos_DFGOaL8R_Qoi240kuyXv6.js";import"./hdos_Dz3aTMQqM4LnOlKzV3COc.js";import"./hdos_itWSuQ2oYLgMGq-Z_V6WL.js";import"./hdos_DCQvziD-0BGtLQC-jPv6N.js";import"./hdos_CJoaCRc7PMIr83ndc1bSY.js";import"./hdos_XbOREJUSviAjufpgUyOxR.js";const J={width:24,height:24,body:'<path fill="currentColor" d="M10.5 3H18v4h-7.5C8.57 7 7 8.57 7 10.5S8.57 14 10.5 14H13v-4l7 6l-7 6v-4h-2.5C6.36 18 3 14.64 3 10.5S6.36 3 10.5 3Z"/>'},Q={class:"app-edit flex flex-col h-full overflow-hidden"},W={class:"flex-1 overflow-hidden p-4 flex flex-col"},X={class:"app-details flex items-center space-x-4 mb-4"},Z={class:"flex flex-col justify-center"},G={class:"space-x-2 mt-3 flex"},K={class:"space-y-2.5 max-w-sm"},O={class:"flex items-center gap-2"},ee="docker-icons/notfound.jpg",ae=B({__name:"AppEdit",props:{appName:{},data:{}},setup(R){const y=R,{themeClasses:e}=F(),b=j(),c=f(()=>y.appName||y.data?.appName||"Unknown"),_=f(()=>b.mainDockerApps.find(a=>a.name===c.value)?.display_name||c.value),l=v(""),m=v(!1),n=v("Save and Recreate"),d=P(),A=f(()=>b.mainDockerApps.find(a=>a.name===c.value)?.image_path||ee),N=async()=>{try{const t=await u.get("/api/get-compose-info",{headers:{"X-HomeDock-CSRF-Token":d.value},params:{containerName:c.value}});t.data?.data?.ymlContent&&t.data.data.ymlContent.trim()!==""?l.value=t.data.data.ymlContent:l.value="No content found for this application."}catch{l.value="Failed to fetch application information."}},T=async()=>{try{(await u.post("/api/update-yml-config",{containerName:c.value,ymlContent:l.value,homedock_csrf_token:d.value})).data.success?S("Configuration saved successfully!",void 0,e.value.scopeSelector):p("Failed to save the configuration. Please check the YML format.",e.value.scopeSelector)}catch(t){t.response?x(t,e.value.scopeSelector):p("Unknown error occurred while saving configuration",e.value.scopeSelector)}},E=()=>{n.value==="Click again to confirm"?I():(n.value="Click again to confirm",setTimeout(()=>{n.value==="Click again to confirm"&&(n.value="Save and Recreate")},3e3))},I=async()=>{m.value=!0;try{if((await u.post("/api/update-yml-config",{containerName:c.value,ymlContent:l.value,homedock_csrf_token:d.value})).data.success){n.value="Recreating...";try{(await u.post("/api/recreate-container",{container_name:c.value,yml_content:l.value,homedock_csrf_token:d.value})).data.message?(S("Application recreated successfully!",void 0,e.value.scopeSelector),n.value="Save and Recreate"):(p("Failed to recreate the application.",e.value.scopeSelector),n.value="Save and Recreate")}catch(a){a.response?.status===400&&a.response?.data?.message?p(a.response.data.message,e.value.scopeSelector,10):a.response?x(a,e.value.scopeSelector):p("Failed to recreate the application.",e.value.scopeSelector),n.value="Save and Recreate"}}else p("Failed to update the configuration file.",e.value.scopeSelector),n.value="Save and Recreate"}catch(t){t.response?x(t,e.value.scopeSelector):p("An error occurred. Please check the logs.",e.value.scopeSelector),n.value="Save and Recreate"}finally{m.value=!1}};return M(()=>{N()}),(t,a)=>(U(),L("div",Q,[s("div",W,[s("div",X,[r(z,{draggable:"false",src:A.value,alt:"App Icon",class:"app-icon w-12 h-12 min-w-12 min-h-12 rounded-xl drop-shadow-md ring-[1px] ring-gray-500/10"},null,8,["src"]),s("div",Z,[s("p",{class:i([[o(e).hubCardTextAppName],"app-name font-bold text-sm"])},k(_.value)+" config",3),s("p",{class:i([[o(e).hubCardTextRepo],"app-docker-image text-xs"])},"Docker Compose configuration",2)])]),s("hr",{class:i([[o(e).hubSeparator],"border-0 h-px mb-4"])},null,2),$(s("textarea",{class:i([[o(e).hubTextArea],"flex-1 rounded-lg w-full font-mono text-xs resize-none p-3"]),"onUpdate:modelValue":a[0]||(a[0]=D=>l.value=D),placeholder:"Loading configuration..."},null,2),[[H,l.value]]),s("div",G,[r(o(w),{onClick:T,type:"primary",size:"small",class:"bg-blue-600 hover:!bg-blue-800 py-1 px-4 flex items-center"},{default:h(()=>[r(o(g),{icon:o(Y),class:"mb-0.5 mr-1 h-3 w-3 min-w-3 min-h-3"},null,8,["icon"]),a[1]||(a[1]=s("span",null,"Save",-1))]),_:1}),r(o(w),{onClick:E,disabled:m.value,type:"primary",size:"small",class:"bg-indigo-600 hover:!bg-indigo-800 py-1 px-4 flex items-center"},{default:h(()=>[r(o(g),{icon:o(J),class:"mb-0.5 mr-1 h-3 w-3 min-w-3 min-h-3"},null,8,["icon"]),s("span",null,k(n.value),1)]),_:1},8,["disabled"])])]),r(q,{icon:o(C),message:"Edit Config",info:`Editing ${_.value}`,showHelp:!0},{help:h(()=>[s("div",K,[s("div",O,[r(o(g),{icon:o(C),class:i(["w-5 h-5",o(e).statusBarIcon])},null,8,["icon","class"]),s("h4",{class:i(["text-base font-semibold",o(e).statusBarText])},"Edit Config",2)]),s("div",{class:i(["text-[10px] md:text-xs space-y-2 leading-relaxed",o(e).statusBarInfo])},[...a[2]||(a[2]=[s("p",null,"Modify your application's configuration directly. You can save changes to update the configuration file, or use Save and Recreate to apply changes immediately by stopping and recreating the container with the new settings. All changes are validated before being applied to ensure proper YAML formatting.",-1)])],2)])]),_:1},8,["icon","info"])]))}}),fe=V(ae,[["__scopeId","data-v-7095d1d9"]]);export{fe as default};
