import{I as P,Q as y,d as g,x as D,B as E,o as C}from"./hdos_Bcoy0t8m2roJz4NDgj-hv.js";import{e as O,S as p,K as b,d as B,o as k}from"./hdos_CoDNShsS-lCB4NlaMkpGR.js";import{a as I}from"./hdos_COAQqH6lKP34bBHUg8dJ6.js";import{h as j}from"./hdos_1rkZlHica8T3hzfqAaSIX.js";var x={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z"}}]},name:"right",theme:"outlined"};function v(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?Object(arguments[n]):{},s=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),s.forEach(function(r){N(e,r,t[r])})}return e}function N(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var R=function(n,t){var s=v({},n,t.attrs);return O(P,v({},s,{icon:x}),null)};R.displayName="RightOutlined";R.inheritAttrs=!1;const F=()=>{const e=p(!1);return b(()=>{e.value=!0}),e},M={type:{type:String},actionFn:Function,close:Function,autofocus:Boolean,prefixCls:String,buttonProps:C(),emitEvent:Boolean,quitOnNullishReturnValue:Boolean};function S(e){return!!(e&&e.then)}const K=B({compatConfig:{MODE:3},name:"ActionButton",props:M,setup(e,n){let{slots:t}=n;const s=p(!1),r=p(),c=p(!1);let d;const u=F();k(()=>{e.autofocus&&(d=setTimeout(()=>{var a,o;return(o=(a=y(r.value))===null||a===void 0?void 0:a.focus)===null||o===void 0?void 0:o.call(a)}))}),b(()=>{clearTimeout(d)});const i=function(){for(var a,o=arguments.length,l=new Array(o),f=0;f<o;f++)l[f]=arguments[f];(a=e.close)===null||a===void 0||a.call(e,...l)},m=a=>{S(a)&&(c.value=!0,a.then(function(){u.value||(c.value=!1),i(...arguments),s.value=!1},o=>(u.value||(c.value=!1),s.value=!1,Promise.reject(o))))},A=a=>{const{actionFn:o}=e;if(s.value)return;if(s.value=!0,!o){i();return}let l;if(e.emitEvent){if(l=o(a),e.quitOnNullishReturnValue&&!S(l)){s.value=!1,i(a);return}}else if(o.length)l=o(e.close),s.value=!1;else if(l=o(),!l){i();return}m(l)};return()=>{const{type:a,prefixCls:o,buttonProps:l}=e;return O(E,g(g(g({},D(a)),{},{onClick:A,loading:c.value,prefixCls:o},l),{},{ref:r}),t)}}}),T=j("selectedApps",{state:()=>({selectedApps:[],applications:[],desiredStates:{},errorStates:{}}),actions:{setApplications(e){const n=this.applications;this.applications=e.map(t=>{const s=n.find(u=>u.name===t.name);if(!s)return{...t,isProcessing:!1,checked:this.selectedApps.includes(t.name)};let r=s.isProcessing;const c=this.desiredStates[t.name];return c&&t.status===c&&(r=!1,delete this.desiredStates[t.name]),s.status!==t.status&&(r=!1),{...t,isProcessing:r,checked:this.selectedApps.includes(t.name)}})},setDesiredState(e,n){this.desiredStates[e]=n},clearDesiredState(e){delete this.desiredStates[e]},getDesiredState(e){return this.desiredStates[e]},setErrorState(e,n){this.errorStates[e]=n},clearErrorState(e){delete this.errorStates[e]},saveOrder(){const e="dashboardLocalOrder",n=this.applications.filter(t=>t.HDRole!=="dependency").map(t=>t.name);localStorage.setItem(e,JSON.stringify(n))},updateSelection(e){this.selectedApps=e,this.applications.forEach(n=>{n.checked=e.includes(n.name)})},clearSelection(){this.selectedApps=[],this.applications.forEach(e=>{e.checked=!1})},toggleSelection(e){const n=this.applications.find(t=>t.name===e);n&&(n.checked=!n.checked,n.checked?this.selectedApps.push(n.name):this.selectedApps=this.selectedApps.filter(t=>t!==e))},setProcessing(e,n){const t=this.applications.find(s=>s.name===e);t&&(t.isProcessing=n)}}});let h=null;async function _(e){const n=T();try{const t=await I.get("/api/containers",{headers:{"X-HomeDock-CSRF-Token":e}});if(t.status===200){const s=t.data,r=H(s);return n.setApplications(r),r}return[]}catch(t){throw console.error("Error fetching containers:",t),t}}function H(e){const t=localStorage.getItem("dashboardLocalOrder");if(!t)return e;const s=JSON.parse(t),r=e.filter(i=>i.HDRole!=="dependency"),c=e.filter(i=>i.HDRole==="dependency"),d=s.map(i=>r.find(m=>m.name===i)).filter(Boolean),u=r.filter(i=>!s.includes(i.name));return[...d,...u,...c]}function z(e,n=3e3){L(),h=setInterval(()=>_(e),n)}function L(){h&&(clearInterval(h),h=null)}export{K as A,R,L as a,_ as f,z as s,T as u};
