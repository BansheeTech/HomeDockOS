import{M as tn,bQ as an,aU as f,q as D,bE as kt,aD as nn,as as Qe,aI as on,u as v,aL as p,I as u,v as l,bJ as x,t as g,au as i,bk as n,bU as y,bb as b,g as ge,s as ze,F as E,aX as G,bV as ua,H as ue,ak as sn,aw as Q,h as _t,bO as ye,bR as ln}from"./hdos_C_SZsOMSIrMtpKxCvYKSt.js";import{a as L,b as ca,d as da}from"./hdos_DahYSjy4MuyfOawe4NtU9.js";import{g as rn,i as un,j as cn,s as dn,k as pn,l as Ke,m as Ee,n as Tt,o as ce,p as St,q as vn,r as fn,t as mn,S as pa,C as hn,A as Je,v as va,w as xn,x as gn,y as yn,z as wn,B as bn,D as kn,E as _n,F as Tn,G as Sn}from"./hdos_B9WmLlHFvqcjTrToCZWMf.js";import{u as Cn,d as Ct,a as Dn,b as Fn,c as Mn,e as $n,f as In,g as fa,S as zn}from"./hdos_D84ldrbnpOBSGlFCjPza-.js";import{d as En}from"./hdos_D7NRCijMj_Q9fS__axrEk.js";import{d as et,a as Rn}from"./hdos_CvPrm34SGjwAav8ECB8VW.js";import{d as Dt}from"./hdos_CS7Pix6yyXf4PLMilHEK5.js";import{_ as Bn}from"./hdos_BmL9voBJ5b5vwqQC2jvAb.js";import{l as S}from"./hdos_DCATHP924u4YkH9cyFcrU.js";import{a as Re,S as Ft}from"./hdos_DBQ3nuQGEmKPX-UGY3Izv.js";import{P as Mt,U as Pn}from"./hdos_BaS7L3XD4ItaqMQRRairz.js";import"./hdos_14QYtasVjG6FMFXVus0DI.js";import{I as ma}from"./hdos_CqRTetoYvTHUGBYXRRAgc.js";import{$ as $t}from"./hdos_D24I8Ewnx4pcuVD2m8YP9.js";import"./hdos_Dz3aTMQqM4LnOlKzV3COc.js";import"./hdos_itWSuQ2oYLgMGq-Z_V6WL.js";import"./hdos_DCQvziD-0BGtLQC-jPv6N.js";import"./hdos_CJoaCRc7PMIr83ndc1bSY.js";import"./hdos_rIjgvs8g2SvFuibaH9wZC.js";import"./hdos_Cuccj8xUVyEDTvA_fcq1n.js";import"./hdos_BdDg-PaJlPE_ULloEgxIz.js";import"./hdos_B29Fis5VcXiuAWmU0jOeO.js";import"./hdos_D63Tfrq7hZ9D-jbqbBA6V.js";import"./hdos_BDdAn2wK6U-vCAPeqzTtn.js";import"./hdos_DIiYkTLp38M5kzG4bjPk9.js";import"./hdos_BgMkYQZl78q1rrLKtmN_v.js";import"./hdos_DW3QLbCM-f60X_QlaDeKZ.js";import"./hdos_BIX3gknspfGn1Xc6p4WJ2.js";import"./hdos_DylQT22gO-ATYM7PCURdj.js";const Zn={key:0,class:"absolute inset-0 z-[9999] pointer-events-none backdrop-blur-sm"},Un={class:"flex items-center align-center justify-center flex-col h-full"},Xn={class:"ant-upload-drag-icon"},Ln={class:"flex-1 flex flex-col overflow-auto px-4 pt-2 pb-5"},Yn={class:"mt-2 flex flex-col flex-1 gap-2"},jn={class:"appdrive-controls-container flex flex-col gap-2 items-start justify-between flex-shrink-0"},An={class:"appdrive-selectors flex gap-2 w-full flex-wrap"},Hn={class:"flex items-center gap-2"},Nn={class:"relative flex-shrink-0"},On={class:"truncate"},qn={class:"text-[10px] opacity-60"},Vn={class:"flex items-center gap-2"},Wn={class:"truncate text-xs"},Gn={class:"appdrive-actions-wrapper flex items-center gap-2 mt-0.5 w-full"},Qn=["title"],Kn=["title"],Jn={key:0,class:"flex items-center gap-1 text-[11px] flex-shrink-0 flex-wrap"},eo=["onClick"],to={class:"flex items-center justify-start text-[10px] gap-2 flex-shrink-0"},ao=["title"],no=["onClick"],oo={class:"relative"},so={key:0,class:"flex justify-center items-center w-full py-8"},lo={key:0,class:"absolute inset-0 flex justify-center items-center text-balance px-2 py-8"},io=["onTouchstart","onTouchend","onTouchcancel"],ro=["data-filename","onClick","onContextmenu","onTouchstart","onTouchend","onTouchcancel"],uo={key:1,class:"absolute -left-1 -bottom-1 flex items-center gap-0.5 z-10"},co={key:2,class:"absolute -right-1 -top-1 z-20"},po={key:3,class:"absolute inset-0 flex items-center justify-center z-10"},vo=["title"],fo={key:0,class:"absolute -bottom-1 left-2 right-2"},mo={key:0,class:"flex justify-center items-center text-balance px-2 py-8"},ho={class:"relative flex-shrink-0 z-[1]"},xo={class:i(["relative w-6 h-6 flex items-center justify-center"])},go=["data-filename","onClick","onContextmenu","onTouchstart","onTouchend","onTouchcancel"],yo={class:"relative flex-shrink-0 z-[1]"},wo={class:i(["relative w-6 h-6 flex items-center justify-center"])},bo={key:0,class:"absolute inset-0 flex items-center justify-center"},ko={key:1,class:"absolute -right-1.5 -top-1"},_o={class:"flex-1 overflow-hidden z-[1]"},To=["title"],So={class:"mb-1"},Co={class:"mb-1"},Do={class:"space-y-3"},Fo={class:"flex items-center gap-2 flex-1 min-w-0"},Mo={class:"flex mt-1.5 items-center flex-1 max-w-xs"},$o={class:"max-h-60 overflow-y-auto py-1"},Io={class:"px-3 py-1.5"},zo={class:"flex items-center gap-1.5"},Eo={class:"flex-1 min-w-0"},Ro={class:"flex items-center gap-1.5 mb-0.5"},Bo=["title"],Po={class:"px-3 py-1.5 opacity-40"},Zo={class:"flex items-center gap-1.5"},Uo={class:"flex items-center gap-1.5 flex-1 min-w-0"},Xo=["title"],Lo={class:"px-3 py-1 text-center"},Yo={class:"space-y-2.5 max-w-sm"},jo={class:"flex items-center gap-2"},tt=110,ha=125,Ao=20,Ho=3,xa=300,ga=500,ya=10,wa=300,ba=30,No=tn({__name:"AppAppDrive",props:{containerName:{},mountIndex:{}},setup(ka){const at=ka,{themeClasses:s}=an(),Y=rn(),nt=un(),C=cn(),Be=f([]),P=f([]),F=f([]),T=f(void 0),M=f(0),w=f(""),It=D(()=>P.value.length===0||M.value<0||M.value>=P.value.length?null:P.value[M.value]),ot=D(()=>It.value?.container_path||""),Z=D(()=>It.value?.read_only||!1),Pe=f(!1),we=f(!1),I=f(""),k=f(new Set),H=f(!1),h=f({startX:0,startY:0,currentX:0,currentY:0}),K=f(null);let st=!1;const zt=Cn(),{sortBy:Ze,sortDirection:be,viewMode:J}=dn(zt),Ue=f(!1),Xe=f(0),ke=f([]),j=f({}),U=f(new Set),_e=f([]),Le=f(0),de=f(0),Te=f(0),Se=f(!1),Et=f(""),Ye=f(!1);let lt=!1;const ee=f(null),q=f(0),A=f(0);let te=null,je=0;const it=f(!1),Rt=f(0),Bt=f(0),X=f(null),ae=f(!1),rt=f(""),ut=f(""),ne=f(null),V=f(!1),pe=f(""),Ce=f(!1),oe=f(""),De=f(!1),se=f(null),Ae=f(null);function le(e){const a=nt.dockerApps.find(t=>t.name===e);return{displayName:a?.display_name||e,iconPath:a?.image_path||"docker-icons/notfound.jpg"}}const ct=D(()=>Be.value.filter(e=>{const a=nt.dockerApps.find(t=>t.name===e.name);return!a?.HDRole||a.HDRole!=="dependency"})),Pt=D(()=>{const e=Be.value.find(t=>t.name===T.value);return e?le(e.name).displayName:""}),_a=D(()=>{if(de.value===0)return 0;let e=Te.value*100;return C.currentlyUploading.forEach(a=>{const t=C.uploadProgress[a.uid]||0;e+=t}),Math.round(e/de.value)});kt(()=>C.totalUploading,(e,a)=>{if(a!==void 0&&e<a){const t=a-e;Te.value+=t}de.value=Te.value+e,e===0&&de.value>0&&setTimeout(()=>{de.value=0,Te.value=0,Se.value=!1},3e3)},{immediate:!0});const Zt=D(()=>w.value?w.value.split("/").filter(e=>e):[]),Ut=D(()=>{const e=[...F.value];return e.sort((a,t)=>{if(a.is_directory&&!t.is_directory)return-1;if(!a.is_directory&&t.is_directory)return 1;let o=0;switch(Ze.value){case"name":o=a.display_name.localeCompare(t.display_name);break;case"size":o=a.size-t.size;break;case"date":o=a.modified-t.modified;break}return be.value==="asc"?o:-o}),e}),dt=D(()=>{const e=q.value||window.innerWidth-100,a=A.value||Math.max(1,Math.floor(e/tt)),o=(e-16)/a,r=[];let c=0;return w.value&&(r.push({name:"__back__",display_name:"..",size:0,modified:0,is_directory:!0,x:8+(o-100)/2,y:8}),c=1),Ut.value.forEach((d,m)=>{const _=m+c,B=_%a,z=Math.floor(_/a),O=8+B*o+(o-100)/2,re=8+z*ha;r.push({...d,x:O,y:re})}),r}),Ta=D(()=>{if(dt.value.length===0)return 300;const o=Math.max(...dt.value.map(r=>r.y))+130+16;return Math.max(o,300)}),pt=D(()=>{const e=q.value||window.innerWidth-100,a=A.value||Math.max(1,Math.floor(e/tt)),o=(e-16)/a;return ct.value.map((r,c)=>{const d=c%a,m=Math.floor(c/a),_=8+d*o+(o-100)/2,B=8+m*ha;return{...r,x:_,y:B}})}),Sa=D(()=>{if(pt.value.length===0)return 300;const o=Math.max(...pt.value.map(r=>r.y))+130+16;return Math.max(o,300)}),Xt=D(()=>{const e=Math.min(h.value.startX,h.value.currentX),a=Math.min(h.value.startY,h.value.currentY),t=Math.abs(h.value.currentX-h.value.startX),o=Math.abs(h.value.currentY-h.value.startY);return{left:`${e}px`,top:`${a}px`,width:`${t}px`,height:`${o}px`}}),Lt=D(()=>{const e=F.value.reduce((a,t)=>a+(t.is_directory?0:t.size),0);return ia(e)}),Ca=D(()=>T.value?Pt.value:"Select an application"),Da=D(()=>T.value?`${F.value.length} items`:"Browse application files"),Fa=D(()=>{const e=[],a=k.value.size;if(a>1){const t=Array.from(k.value).map(d=>F.value.find(m=>m.name===d)).filter(d=>d!==void 0),o=t.some(d=>d.is_directory),r=t.filter(d=>!d.is_directory),c=a>3||o;return e.push({label:`Selected: ${a} items`,icon:pn,disabled:!0}),e.push({divider:!0}),c?e.push({label:"Download as ZIP",icon:Ke,action:async()=>{const d=t.map(m=>m.name);Ie(),await Xa(d)}}):r.length>0&&e.push({label:"Download All",icon:Ct,action:async()=>{for(const d of r)await Ve(d);Ie()}}),Z.value||(e.push({label:"Delete All",icon:Dt,danger:!0,action:()=>{rt.value=`Delete ${a} items?`,ut.value=`Are you sure you want to delete ${a} selected items? This action cannot be undone.`,ne.value=null,ae.value=!0,Ie()}}),e.push({divider:!0}),e.push({label:"New Folder",icon:Ee,action:()=>V.value=!0})),e.push({label:"Refresh",icon:Tt,action:()=>ft()}),e}return X.value?X.value.is_directory?(e.push({label:"Open",icon:ce,action:()=>{const t=X.value.name;Ie(),$(t)}}),e.push({label:"Download as ZIP",icon:Ct,action:()=>Ve(X.value)}),e.push({divider:!0}),Z.value||(e.push({label:"Rename Folder",icon:et,action:()=>oa(X.value)}),e.push({label:"Delete Folder",icon:Dt,danger:!0,action:()=>aa(X.value)}),e.push({divider:!0}),e.push({label:"New Folder",icon:Ee,action:()=>V.value=!0}))):(e.push({label:"Download",icon:Ct,action:()=>Ve(X.value)}),e.push({divider:!0}),Z.value||(e.push({label:"Rename File",icon:et,action:()=>oa(X.value)}),e.push({label:"Delete File",icon:Dt,danger:!0,action:()=>aa(X.value)}),e.push({divider:!0}),e.push({label:"New Folder",icon:Ee,action:()=>V.value=!0}))):T.value&&(Z.value||e.push({label:"New Folder",icon:Ee,action:()=>V.value=!0}),e.push({label:"Refresh",icon:Tt,action:()=>ft()})),e});function Ma(e){return e.replace(/[^a-zA-Z0-9._-]/g,"").substring(0,128)}function $a(e){return typeof e!="number"||!Number.isInteger(e)||e<0?null:e}nn(async()=>{if(zt.load(),await jt(),at.containerName){const e=Ma(at.containerName);if(e&&Be.value.some(t=>t.name===e)){T.value=e,await vt(e);const t=$a(at.mountIndex);t!==null&&t<P.value.length&&(M.value=t,await $())}}Qe(()=>{Yt(),Ia()})}),on(()=>{te&&(te.disconnect(),te=null)}),kt(J,()=>{Qe(()=>{Yt()})}),kt(()=>nt.dockerApps.length,()=>{jt()});function Yt(){if(ee.value){const e=ee.value.clientWidth,a=Math.max(1,Math.floor(e/tt));(A.value===0||a!==A.value&&Math.abs(e-q.value)>20)&&(A.value=a,q.value=e)}}function Ia(){te&&te.disconnect(),ee.value&&(te=new ResizeObserver(e=>{for(const a of e){const t=a.contentRect.width,o=Math.max(1,Math.floor(t/tt));(A.value===0||o!==A.value&&Math.abs(t-q.value)>20)&&(A.value=o,q.value=t)}}),te.observe(ee.value))}async function jt(){Pe.value=!0;try{const e=await L.get("/api/appdrive/containers",{headers:{"X-HomeDock-CSRF-Token":Y.value}});Be.value=e.data.containers||[]}catch{S.error("Failed to load containers")}finally{Pe.value=!1}}function za(e){T.value=e,vt(e)}async function vt(e){if(M.value=0,w.value="",!e){F.value=[],P.value=[];return}try{const a=await L.get("/api/appdrive/mounts",{params:{container:e},headers:{"X-HomeDock-CSRF-Token":Y.value}});P.value=a.data.mounts||[],P.value.length>0?await $():F.value=[]}catch(a){F.value=[],P.value=[],S.error(a.response?.data?.error||"Failed to load mounts")}}async function Ea(){w.value="",await $()}async function $(e=""){if(!T.value||P.value.length===0)return;I.value="",k.value.clear();const a=++je;we.value=!0;try{const t=await L.get("/api/appdrive/files",{params:{container:T.value,mount:M.value,path:e},headers:{"X-HomeDock-CSRF-Token":Y.value}});if(a!==je)return;F.value=t.data.files||[],w.value=e}catch(t){if(a!==je)return;S.error(t.response?.data?.error||"Failed to load files")}finally{a===je&&(we.value=!1)}}async function ft(){await $(w.value)}let R=null,W=null,ie=null,mt=0,ht=0,Fe=null,ve=!1,He=!1,fe=0,me=0,he=0,Me=!1,Ne=!1,N=null,At=0,Ht=0,Oe=!1;function Nt(e,a){st||(W===e.name&&R?(clearTimeout(R),R=null,W=null,Ot(e)):(R&&clearTimeout(R),W=e.name,a?.ctrlKey||a?.metaKey?(k.value.has(e.name)?k.value.delete(e.name):k.value.add(e.name),I.value=""):(k.value.clear(),I.value=e.name),R=setTimeout(()=>{R=null,W=null},xa)))}function Ot(e){e.is_directory?$(e.name):Ve(e)}function qt(){R&&(clearTimeout(R),R=null),W===".."?(W=null,xt()):(W="..",R=setTimeout(()=>{R=null,W=null},xa))}function xt(){if(!w.value)return;const e=w.value.split("/");e.pop();const a=e.join("/");$(a)}function Ra(){$("")}function Ba(e){const t=Zt.value.slice(0,e+1).join("/");$(t)}function gt(e,a){const t=a.touches[0];t&&(Fe=e,ve=!1,He=!1,mt=t.clientX,ht=t.clientY,e.name!=="__back__"&&(ie=setTimeout(()=>{He=!0,navigator.vibrate&&navigator.vibrate(50);const o=new MouseEvent("contextmenu",{bubbles:!0,cancelable:!0,clientX:t.clientX,clientY:t.clientY});$e(o,e)},ga)))}function qe(e){const a=e.touches[0];if(!a)return;Math.sqrt(Math.pow(a.clientX-mt,2)+Math.pow(a.clientY-ht,2))>ya&&(ve=!0,Ne=!0,ie&&(clearTimeout(ie),ie=null))}function xe(e,a){if(ie&&(clearTimeout(ie),ie=null),He){He=!1,ve=!1,Fe=null;return}if(!ve&&Fe===e){const t=Date.now(),o=a.changedTouches[0];if(!o){ve=!1,Fe=null;return}const r=t-fe,c=Math.sqrt(Math.pow(o.clientX-me,2)+Math.pow(o.clientY-he,2));r<wa&&c<ba?(a.preventDefault(),e.name==="__back__"?xt():Ot(e),fe=0,me=0,he=0):(k.value.clear(),I.value=e.name,fe=t,me=o.clientX,he=o.clientY)}ve=!1,Fe=null}function Pa(e){const a=e.touches[0];a&&(Me=!0,Ne=!1,mt=a.clientX,ht=a.clientY)}function Vt(e){if(!Me||Ne){Me=!1,Ne=!1;return}const a=Date.now(),t=e.changedTouches[0];if(!t){Me=!1;return}const o=a-fe,r=Math.sqrt(Math.pow(t.clientX-me,2)+Math.pow(t.clientY-he,2));o<wa&&r<ba?(e.preventDefault(),xt(),fe=0,me=0,he=0):(fe=a,me=t.clientX,he=t.clientY),Me=!1}function Za(e){const a=e.target;if(a.closest(".appdrive-file-item")||a.closest(".appdrive-controls-container"))return;const r=e.touches[0];r&&(At=r.clientX,Ht=r.clientY,Oe=!1,N=setTimeout(()=>{navigator.vibrate&&navigator.vibrate(50);const c=new MouseEvent("contextmenu",{bubbles:!0,cancelable:!0,clientX:r.clientX,clientY:r.clientY});$e(c,null),N=null},ga))}function Ua(e){if(!N)return;const a=e.touches[0];if(!a)return;Math.sqrt(Math.pow(a.clientX-At,2)+Math.pow(a.clientY-Ht,2))>ya&&(Oe=!0,N&&(clearTimeout(N),N=null))}function Wt(){N&&(clearTimeout(N),N=null),Oe||(I.value="",k.value.clear()),Oe=!1}async function Ve(e){try{j.value[e.name]=0,e.is_directory&&U.value.add(e.name);const a=await L.get("/api/appdrive/download",{params:{container:T.value,mount:M.value,file:e.name},headers:{"X-HomeDock-CSRF-Token":Y.value},responseType:"blob",onDownloadProgress:r=>{r.total&&(j.value[e.name]=Math.round(r.loaded*100/r.total))}});e.is_directory&&U.value.delete(e.name);const t=URL.createObjectURL(a.data),o=document.createElement("a");o.href=t,o.download=e.is_directory?`${e.display_name}.zip`:e.display_name,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(t),setTimeout(()=>{delete j.value[e.name]},1e3)}catch{e.is_directory?(U.value.delete(e.name),S.error("Failed to download folder as ZIP")):S.error("Failed to download file"),delete j.value[e.name]}}const Gt=f(!1);async function Xa(e){if(e.length!==0)try{Gt.value=!0,e.forEach(d=>{F.value.find(_=>_.name===d)?.is_directory&&U.value.add(d)});const a=await L.post("/api/appdrive/download-multiple",{container:T.value,mount:M.value,files:e},{headers:{"X-HomeDock-CSRF-Token":Y.value},responseType:"blob"}),t=a.headers["content-disposition"];let o="download.zip";if(t){const d=t.match(/filename="?([^";\n]+)"?/);d&&(o=d[1].replace(/[<>:"/\\|?*]/g,"_"))}const r=URL.createObjectURL(a.data),c=document.createElement("a");c.href=r,c.download=o,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(r),S.success(`Downloaded ${e.length} items as ZIP`)}catch{S.error("Failed to download files as ZIP")}finally{Gt.value=!1,e.forEach(a=>{U.value.delete(a)})}}async function La(e,a,t){const o=new FormData;o.append("file",e),o.append("container",T.value),o.append("mount",String(M.value)),t&&o.append("path",t);try{const r=await L.post("/api/appdrive/upload",o,{headers:{"Content-Type":"multipart/form-data","X-HomeDock-CSRF-Token":Y.value},onUploadProgress:c=>{if(c.total){const d=Math.round(c.loaded/c.total*100),m=e;C.updateProgress(m.uid,d),a&&a({percent:d})}}});r.data.success||S.error(r.data.error||"Upload failed")}catch(r){throw L.isAxiosError(r)?r.response?.status===413?S.error("The selected file is larger than the maximum allowed size."):S.error(r.response?.data?.error||`Unexpected error occurred: ${r.message}`):S.error("An unknown error occurred. Please try again."),r}}async function yt(){if(!lt){lt=!0;try{for(;Le.value<Ho&&_e.value.length>0;){const e=_e.value.shift();if(!e)break;Le.value++,C.startUpload({uid:e.file.uid,name:e.file.name,size:e.file.size}),(async()=>{try{await La(e.file,e.onProgress,e.path),ke.value=ke.value.filter(a=>a.uid!==e.file.uid),C.completeUpload(e.file.uid),e.onSuccess&&e.onSuccess(null,e.file)}catch(a){C.cancelUpload(e.file.uid),e.onError&&e.onError(a)}finally{Le.value--,yt()}})()}}finally{lt=!1}Le.value===0&&_e.value.length===0&&await $(w.value)}}function Ya({file:e,onSuccess:a,onError:t,onProgress:o}){const r=e;C.addToQueue({uid:r.uid,name:r.name,size:r.size}),_e.value.push({file:r,onProgress:o,onSuccess:a,onError:t,path:w.value}),yt()}function ja(e){ke.value=[]}function Aa(e){Z.value||(e.preventDefault(),Xe.value++,e.dataTransfer?.types.includes("Files")&&(Ue.value=!0))}function Ha(e){e.preventDefault(),Xe.value--,Xe.value===0&&(Ue.value=!1)}function wt(e){return e.startsWith(".")}function We(e,a=0){Et.value=e,Ye.value=!0,a>0&&setTimeout(()=>{Ye.value=!1},a)}function Qt(){Ye.value=!1}async function Kt(e,a=""){const t=[];return new Promise((o,r)=>{const c=e.createReader(),d=()=>{c.readEntries(async m=>{if(m.length===0){o(t);return}for(const _ of m){if(wt(_.name))continue;const B=a?`${a}/${_.name}`:_.name;if(_.isFile){const z=_,O=await new Promise((re,bt)=>{z.file(re,bt)});t.push({file:O,relativePath:a})}else if(_.isDirectory){const O=await Kt(_,B);t.push(...O)}}d()},m=>{r(m)})};d()})}function Na(e){const a=new Set;return e.forEach(({relativePath:o})=>{if(o){const r=o.split("/");let c="";for(const d of r)c=c?`${c}/${d}`:d,a.add(c)}}),Array.from(a).sort((o,r)=>{const c=o.split("/").length,d=r.split("/").length;return c!==d?c-d:o.localeCompare(r)})}async function Oa(e){if(e.preventDefault(),e.stopPropagation(),Xe.value=0,Ue.value=!1,Z.value||!T.value||!e.dataTransfer)return;We("Scanning dropped items...");const a=[];if(e.dataTransfer.items&&e.dataTransfer.items.length>0){const o=[];for(let r=0;r<e.dataTransfer.items.length;r++){const c=e.dataTransfer.items[r];if(c.kind==="file"){const d=c.webkitGetAsEntry();d&&!wt(d.name)&&o.push(d)}}for(const r of o)if(r.isFile){const c=r,d=await new Promise((m,_)=>{c.file(m,_)});a.push({file:d,relativePath:""})}else if(r.isDirectory){We("Processing folders structure...");const c=r,d=await Kt(c,c.name);a.push(...d)}}else for(let o=0;o<e.dataTransfer.files.length;o++){const r=e.dataTransfer.files[o];wt(r.name)||a.push({file:r,relativePath:""})}if(a.length===0){Qt();return}const t=Na(a);if(t.length>0){se.value={allFiles:a,folders:t},De.value=!0,Qt();return}await Jt(a)}async function Jt(e){We(`Enqueueing ${e.length} ${e.length===1?"file":"files"} for upload...`),await Qe(),await new Promise(o=>setTimeout(o,50));const a=Date.now(),t=20;for(let o=0;o<e.length;o+=t){const r=e.slice(o,o+t);for(let c=0;c<r.length;c++){const{file:d,relativePath:m}=r[c],_=o+c,B=`${a}-${_}-${Math.random().toString(36).substring(2,11)}-${d.name}`,z=d;z.uid=B;const O=m?w.value?`${w.value}/${m}`:m:w.value,re=m?`${m}/${d.name}`:d.name;C.addToQueue({uid:z.uid,name:re,size:z.size}),_e.value.push({file:z,path:O,onProgress:void 0,onSuccess:void 0,onError:void 0})}o+t<e.length&&await new Promise(c=>setTimeout(c,0))}We("Starting upload...",2e3),await Qe(),yt()}async function qa(){if(!se.value)return;De.value=!1;const{allFiles:e}=se.value;se.value=null,await Jt(e)}function Va(){De.value=!1,se.value=null}function Wa(e){const a=e.target;if(a.closest(".appdrive-controls-container")||F.value.length===0&&!w.value||e.button!==0)return;const o=e.currentTarget?.getBoundingClientRect();if(!o)return;const r=e.clientX-o.left,c=e.clientY-o.top;K.value={x:r,y:c},a.closest(".appdrive-file-item")||(H.value=!0,h.value.startX=r,h.value.startY=c,h.value.currentX=r,h.value.currentY=c,I.value="",k.value.clear()),document.addEventListener("mousemove",ea),document.addEventListener("mouseup",ta)}function ea(e){const t=ee.value?.getBoundingClientRect();if(!t)return;let o=e.clientX-t.left,r=e.clientY-t.top;o=Math.max(0,Math.min(o,t.width)),r=Math.max(0,Math.min(r,t.height)),!H.value&&K.value&&Math.sqrt(Math.pow(o-K.value.x,2)+Math.pow(r-K.value.y,2))>Ao&&(H.value=!0,h.value.startX=K.value.x,h.value.startY=K.value.y,I.value="",k.value.clear()),H.value&&(h.value.currentX=o,h.value.currentY=r,Ga())}function ta(){const e=Math.abs(h.value.currentX-h.value.startX)>5||Math.abs(h.value.currentY-h.value.startY)>5;!e&&H.value&&(I.value="",k.value.clear()),H.value&&e&&(st=!0,setTimeout(()=>{st=!1},50)),H.value=!1,K.value=null,document.removeEventListener("mousemove",ea),document.removeEventListener("mouseup",ta)}function Ga(){const e=Math.min(h.value.startX,h.value.currentX),a=Math.min(h.value.startY,h.value.currentY),t=Math.abs(h.value.currentX-h.value.startX),o=Math.abs(h.value.currentY-h.value.startY);k.value.clear();const c=ee.value?.getBoundingClientRect();c&&document.querySelectorAll(".appdrive-file-item").forEach(d=>{const m=d.getBoundingClientRect(),_=m.left-c.left,B=m.top-c.top,z=_+m.width,O=B+m.height,re=e+t,bt=a+o;if(e<z&&re>_&&a<O&&bt>B){const ra=d.getAttribute("data-filename");ra&&k.value.add(ra)}})}function $e(e,a){e.preventDefault(),T.value&&(a&&!k.value.has(a.name)?(I.value=a.name,k.value.clear()):a||(I.value="",k.value.clear()),X.value=a,Rt.value=e.clientX,Bt.value=e.clientY,it.value=!0)}function Ie(){it.value=!1,X.value=null}function aa(e){ne.value=e,rt.value=`Delete ${e.is_directory?"Folder":"File"}`,ut.value=`Are you sure you want to delete "${e.display_name}"?${e.is_directory?" This will delete all contents.":""}`,ae.value=!0}async function Qa(){if(!ne.value&&k.value.size>0){const e=Array.from(k.value);let a=0,t=0;for(const o of e)try{await L.post("/api/appdrive/delete",{container:T.value,mount:M.value,file:o},{headers:{"X-HomeDock-CSRF-Token":Y.value}}),a++}catch{t++}a>0&&S.success(`Deleted ${a} item${a>1?"s":""}`),t>0&&S.error(`Failed to delete ${t} item${t>1?"s":""}`),k.value.clear(),await $(w.value),ae.value=!1;return}if(ne.value)try{await L.post("/api/appdrive/delete",{container:T.value,mount:M.value,file:ne.value.name},{headers:{"X-HomeDock-CSRF-Token":Y.value}}),S.success(`Deleted ${ne.value.display_name}`),await $(w.value)}catch(e){S.error(e.response?.data?.error||"Failed to delete")}finally{ae.value=!1,ne.value=null}}async function na(){if(!pe.value.trim()){S.error("Please enter a folder name");return}try{await L.post("/api/appdrive/create-folder",{container:T.value,mount:M.value,name:pe.value.trim(),path:w.value},{headers:{"X-HomeDock-CSRF-Token":Y.value}}),S.success(`Created folder "${pe.value}"`),pe.value="",V.value=!1,await $(w.value)}catch(e){S.error(e.response?.data?.error||"Failed to create folder")}}function oa(e){Ae.value=e,oe.value=e.display_name,Ce.value=!0}async function sa(){if(!Ae.value||!oe.value.trim()){S.error("Please enter a new name");return}try{await L.post("/api/appdrive/rename",{container:T.value,mount:M.value,old_name:Ae.value.name,new_name:oe.value.trim()},{headers:{"X-HomeDock-CSRF-Token":Y.value}}),S.success(`Renamed to "${oe.value}"`),Ce.value=!1,Ae.value=null,oe.value="",await $(w.value)}catch(e){S.error(e.response?.data?.error||"Failed to rename")}}function Ka(){be.value=be.value==="asc"?"desc":"asc"}function Ja(){J.value=J.value==="grid"?"list":"grid"}function la(e){if(e.is_directory)return ce;const a=e.display_name.split(".").pop()?.toLowerCase()||"",t=["jpg","jpeg","png","gif","bmp","webp","svg","ico"],o=["mp4","mkv","avi","mov","wmv","flv","webm"],r=["mp3","wav","ogg","flac","aac","wma","m4a"],c=["zip","rar","7z","tar","gz","bz2","xz"],d=["js","ts","py","java","c","cpp","h","go","rs","rb","php","html","css","scss","vue","jsx","tsx","json","xml","yaml","yml","sh","bash","sql"],m=["doc","docx"],_=["xls","xlsx","csv"],B=["ppt","pptx"],z=["txt","md","log","ini","conf","cfg"];return t.includes(a)?xn:o.includes(a)?gn:r.includes(a)?yn:c.includes(a)?Ke:d.includes(a)?wn:m.includes(a)?bn:_.includes(a)?kn:B.includes(a)?_n:z.includes(a)?Tn:Sn}function ia(e){if(e===0)return"0 B";const a=1024,t=["B","KB","MB","GB","TB"],o=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,o)).toFixed(2))+" "+t[o]}function en(e){if(e===0)return"0B";const a=1024,t=["B","K","M","G","T"],o=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,o)).toFixed(1))+t[o]}function Ge(e){const t=Date.now()/1e3-e.modified;return t<60?"Just now":t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:t<604800?`${Math.floor(t/86400)}d ago`:""}return(e,a)=>(p(),v("div",{class:"app-appdrive flex flex-col h-full overflow-hidden",onDragenter:Aa,onDragleave:Ha,onDragover:a[20]||(a[20]=ye(()=>{},["prevent"])),onDrop:ye(Oa,["prevent","stop"])},[u(ge,{name:"dragger-fade"},{default:x(()=>[Ue.value&&!Z.value?(p(),v("div",Zn,[l("div",{class:i([[n(s).scopeSelector,n(s).dropZoneDragHolder],"fullscreen-dragger h-full border-2 border-dashed rounded-lg flex items-center justify-center"])},[l("div",Un,[l("p",Xn,[u(n(y),{icon:n(St),class:i([[n(s).dropZoneDragIcon],"text-5xl w-16 h-16"])},null,8,["icon","class"])]),l("p",{class:i([[n(s).dropZoneDragUpText],"px-4 text-balance text-center text-lg font-semibold mt-4"])},"Drop files or folders to upload to "+b(Pt.value),3),l("p",{class:i([[n(s).dropZoneDragDownText],"px-4 text-balance text-center text-sm mt-2"])},"Folders will maintain their structure.",2),l("p",{class:i([[n(s).dropZoneDragDownText],"px-4 text-balance text-center text-sm mt-1"])},"Hidden files (.*) are automatically filtered.",2)])],2)])):g("",!0)]),_:1}),l("div",Ln,[l("div",Yn,[l("div",jn,[l("div",An,[u(n(Ft),{value:T.value,"onUpdate:value":a[0]||(a[0]=t=>T.value=t),class:i([[n(s).scopeSelector,n(s).dropZoneSortSelect],"appdrive-container-select h-8 flex-1 rounded-md min-w-[180px] transition duration-150"]),"popup-class-name":`${n(s).scopeSelector} appdrive-container-dropdown`,"show-search":!1,placeholder:"Select an application",onChange:a[1]||(a[1]=t=>vt(t)),loading:Pe.value},{suffixIcon:x(()=>[u(n(y),{icon:n(vn),class:"w-4 h-4"},null,8,["icon"])]),default:x(()=>[(p(!0),v(E,null,G(ct.value,t=>(p(),ze(n(Re),{key:t.name,value:t.name},{default:x(()=>[l("div",Hn,[l("div",Nn,[u(ua,{src:le(t.name).iconPath,alt:le(t.name).displayName,class:"w-4 h-4 rounded",draggable:"false"},null,8,["src","alt"]),l("span",{class:i([[t.status==="running"?"bg-green-500":"bg-gray-400"],"absolute -bottom-0.5 -right-0.5 w-1.5 h-1.5 rounded-full ring-1 ring-black/20"])},null,2)]),l("span",On,b(le(t.name).displayName),1),l("span",qn,"("+b(t.mounts_count)+" mount"+b(t.mounts_count>1?"s":"")+")",1)])]),_:2},1032,["value"]))),128))]),_:1},8,["value","class","popup-class-name","loading"]),P.value.length>1?(p(),ze(n(Ft),{key:0,value:M.value,"onUpdate:value":a[2]||(a[2]=t=>M.value=t),class:i([[n(s).scopeSelector,n(s).dropZoneSortSelect],"appdrive-mount-select h-8 flex-1 rounded-md min-w-[200px] transition duration-150"]),"popup-class-name":`${n(s).scopeSelector} appdrive-mount-dropdown`,"show-search":!1,placeholder:"Select mount",onChange:Ea},{suffixIcon:x(()=>[u(n(y),{icon:n(ce),class:"w-4 h-4"},null,8,["icon"])]),default:x(()=>[(p(!0),v(E,null,G(P.value,(t,o)=>(p(),ze(n(Re),{key:o,value:o},{default:x(()=>[l("div",Vn,[u(n(y),{icon:t.read_only?n(ca):n(ce),class:"w-3 h-3 flex-shrink-0"},null,8,["icon"]),l("span",Wn,b(t.container_path),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["value","class","popup-class-name"])):g("",!0)]),l("div",Gn,[u(n(Ft),{value:n(Ze),"onUpdate:value":a[3]||(a[3]=t=>sn(Ze)?Ze.value=t:null),class:i([[n(s).scopeSelector,n(s).dropZoneSortSelect],"appdrive-sort-select h-8 flex-1 rounded-md min-w-[140px] transition duration-150"]),"popup-class-name":`${n(s).scopeSelector}`,"show-search":!1},{suffixIcon:x(()=>[u(n(y),{icon:n(Dn),class:"w-4 h-4"},null,8,["icon"])]),default:x(()=>[u(n(Re),{value:"name"},{default:x(()=>[...a[21]||(a[21]=[ue("Sort by Name",-1)])]),_:1}),u(n(Re),{value:"size"},{default:x(()=>[...a[22]||(a[22]=[ue("Sort by Size",-1)])]),_:1}),u(n(Re),{value:"date"},{default:x(()=>[...a[23]||(a[23]=[ue("Sort by Date",-1)])]),_:1})]),_:1},8,["value","class","popup-class-name"]),l("button",{onClick:Ka,class:i([[n(s).dropZoneSortButton],"px-2 py-1 border rounded-md transition-colors h-8 flex items-center justify-center flex-shrink-0"]),title:n(be)==="asc"?"Sort Ascending":"Sort Descending"},[u(n(y),{icon:n(be)==="asc"?n(Fn):n(Mn),class:"w-4 h-4"},null,8,["icon"])],10,Qn),l("button",{onClick:Ja,class:i([[n(s).dropZoneSortButton],"px-2 py-1 border rounded-md transition-colors h-8 flex items-center justify-center flex-shrink-0"]),title:n(J)==="grid"?"Switch to List View":"Switch to Grid View"},[u(n(y),{icon:n(J)==="grid"?n($n):n(In),class:"w-4 h-4"},null,8,["icon"])],10,Kn),l("button",{onClick:ft,class:i([[n(s).dropZoneSortButton],"px-2 py-1 border rounded-md transition-colors h-8 flex items-center justify-center flex-shrink-0"]),title:"Refresh"},[u(n(y),{icon:n(Tt),class:i([{"animate-spin":we.value},"w-4 h-4"])},null,8,["icon","class"])],2)])]),u(ge,{name:"breadcrumb-slide"},{default:x(()=>[w.value?(p(),v("div",Jn,[l("button",{onClick:Ra,class:i([[n(s).dropZoneSortButton],"px-2 py-0.5 rounded hover:opacity-80 transition-opacity flex items-center gap-1"])},[u(n(y),{icon:n(fn),class:"w-3 h-3"},null,8,["icon"]),a[24]||(a[24]=l("span",null,"Root",-1))],2),(p(!0),v(E,null,G(Zt.value,(t,o)=>(p(),v(E,{key:o},[u(n(y),{icon:n(mn),class:i([[n(s).dropZoneFileIcon],"w-3 h-3 opacity-50"])},null,8,["icon","class"]),l("button",{onClick:r=>Ba(o),class:i([[n(s).dropZoneSortButton],"px-2 py-0.5 rounded hover:opacity-80 transition-opacity truncate max-w-[150px]"])},b(t),11,eo)],64))),128))])):g("",!0)]),_:1}),l("div",to,[l("span",{class:i([[n(s).dropZoneTotalSizeScope],"rounded-full px-2 py-0.5"])},b(F.value.length)+" "+b(F.value.length===1?"item":"items"),3),Lt.value!=="0 B"&&F.value.length>0?(p(),v("span",{key:0,class:i([[n(s).dropZoneTotalSizeScope],"rounded-full px-2 py-0.5"])},b(Lt.value)+" total ",3)):g("",!0),Z.value?(p(),v("span",{key:1,class:i([[n(s).dropZoneTotalSizeScope],"rounded-full px-2 py-0.5 flex items-center gap-1"])},[u(n(y),{icon:n(ca),class:"w-3 h-3"},null,8,["icon"]),a[25]||(a[25]=ue(" Read-only ",-1))],2)):g("",!0),ot.value?(p(),v("span",{key:2,class:i([[n(s).dropZoneTotalSizeScope],"rounded-full px-2 py-0.5 opacity-60 truncate max-w-[200px]"]),title:ot.value},b(ot.value),11,ao)):g("",!0)]),l("div",{ref_key:"containerRef",ref:ee,class:"view-mode-container",onMousedown:Wa,onContextmenu:a[8]||(a[8]=t=>$e(t,null)),onTouchstart:Za,onTouchmove:Ua,onTouchend:Wt,onTouchcancel:Wt},[T.value?T.value?(p(),ze(ge,{key:1,name:n(J)==="grid"?"view-mode-fade":"list-view-fade",mode:"out-in"},{default:x(()=>[n(J)==="grid"?(p(),v("div",{key:"grid-view",class:"appdrive-icons-container relative w-full select-none",style:Q({height:`${Ta.value}px`})},[u(pa,{visible:H.value,style:Q(Xt.value)},null,8,["visible","style"]),F.value.length===0&&!w.value&&!we.value?(p(),v("div",lo,[u(n($t),{class:i([n(s).dropZoneEmptyText]),description:Z.value?"This mount is empty":"This mount is empty. Drag and drop files to upload."},null,8,["class","description"])])):g("",!0),u(_t,{name:"file-item"},{default:x(()=>[(p(!0),v(E,null,G(dt.value,t=>(p(),v(E,{key:t.name},[t.name==="__back__"?(p(),v("div",{key:0,style:Q({position:"absolute",left:`${t.x}px`,top:`${t.y}px`}),onClick:qt,onContextmenu:a[4]||(a[4]=ye(()=>{},["prevent"])),onTouchstart:o=>gt(t,o),onTouchmove:qe,onTouchend:o=>xe(t,o),onTouchcancel:o=>xe(t,o),class:i(["group flex flex-col items-center gap-1 cursor-pointer p-2 rounded-lg appdrive-file-item touch-manipulation select-none","transition-[background,transform,border] duration-150","w-[100px] h-[120px]",n(s).desktopIconBg||"hover:bg-white/5"])},[l("div",{class:i(["relative w-16 h-16 flex-shrink-0 flex items-center justify-center rounded-2xl",n(s).desktopIconContainerBg||"bg-white/10","transition-transform duration-200 group-hover:scale-105"])},[u(n(y),{icon:n(fa),class:i([[n(s).dropZoneFileIcon],"h-10 w-10"])},null,8,["icon","class"])],2),l("span",{class:i([[n(s).dropZoneFileText],"text-[11px] leading-tight text-center"])},"..",2)],46,io)):(p(),v("div",{key:1,"data-filename":t.name,style:Q({position:"absolute",left:`${t.x}px`,top:`${t.y}px`}),class:i(["group flex flex-col items-center gap-1 cursor-pointer p-2 rounded-lg appdrive-file-item touch-manipulation select-none","transition-[background,transform,border] duration-150","w-[100px] h-[120px] border",I.value===t.name||k.value.has(t.name)?[n(s).desktopIconBgSelected||"bg-blue-500/20",n(s).desktopIconBorderSelected||"border-blue-500"]:["border-transparent",n(s).desktopIconBg||"hover:bg-white/5"]]),onClick:o=>Nt(t,o),onContextmenu:ye(o=>$e(o,t),["stop"]),onTouchstart:o=>gt(t,o),onTouchmove:qe,onTouchend:o=>xe(t,o),onTouchcancel:o=>xe(t,o)},[l("div",{class:i(["relative w-16 h-16 flex-shrink-0 flex items-center justify-center rounded-2xl",n(s).desktopIconContainerBg||"bg-white/10","transition-transform duration-200 group-hover:scale-105",(I.value===t.name||k.value.has(t.name))&&(n(s).desktopIconContainerBgSelected||"bg-blue-500/30")])},[!t.is_directory&&t.size>0?(p(),v("div",{key:0,class:i([[n(s).dropZoneFileSize],"absolute -left-1 -top-1 text-[8px] font-medium px-1 py-0.5 rounded whitespace-nowrap z-10"])},b(en(t.size)),3)):g("",!0),Ge(t)?(p(),v("div",uo,[l("div",{class:i([[n(s).dropZoneFileSize],"text-[8px] font-medium px-1 py-0.5 rounded whitespace-nowrap"])},b(Ge(t)),3)])):g("",!0),U.value.has(t.name)?(p(),v("div",co,[u(n(y),{icon:n(Ke),class:i([[n(s).dropZoneLockIcon],"h-4 w-4"])},null,8,["icon","class"])])):g("",!0),u(n(y),{icon:la(t),class:i([[n(s).dropZoneFileIcon,U.value.has(t.name)?"opacity-40":""],"h-10 w-10 transition duration-300 group-hover:scale-110"])},null,8,["icon","class"]),U.value.has(t.name)?(p(),v("div",po,[u(n(y),{icon:n(da),class:i([[n(s).dropZoneLockIcon],"h-7 w-7 animate-spin"])},null,8,["icon","class"])])):g("",!0)],2),l("span",{class:i([[n(s).dropZoneFileText],"text-[11px] leading-tight text-center line-clamp-2 w-full px-1 break-words"]),title:t.display_name},b(t.display_name),11,vo),j.value[t.name]!==void 0&&j.value[t.name]<100?(p(),v("div",fo,[u(n(Mt),{percent:j.value[t.name],class:i([[n(s).scopeSelector],"h-1 rounded-full"]),"show-info":!1,size:2,status:"active"},null,8,["percent","class"])])):g("",!0)],46,ro))],64))),128))]),_:1})],4)):(p(),v("div",{key:`list-view-${w.value}`,class:"appdrive-list-container w-full select-none"},[u(pa,{visible:H.value,style:Q(Xt.value)},null,8,["visible","style"]),F.value.length===0&&!w.value&&!we.value?(p(),v("div",mo,[u(n($t),{class:i([n(s).dropZoneEmptyText]),description:Z.value?"This mount is empty":"This mount is empty. Drag and drop files to upload."},null,8,["class","description"])])):g("",!0),u(_t,{name:"file-item-list"},{default:x(()=>[w.value?(p(),v("div",{key:"back-button",onClick:qt,onContextmenu:a[5]||(a[5]=ye(()=>{},["prevent"])),onTouchstart:Pa,onTouchmove:qe,onTouchend:a[6]||(a[6]=t=>Vt(t)),onTouchcancel:a[7]||(a[7]=t=>Vt(t)),class:i(["group flex items-center gap-3 cursor-pointer px-2 py-1.5 rounded transition-colors appdrive-file-item touch-manipulation select-none",n(s).desktopIconBg||"hover:bg-white/5"])},[l("div",ho,[l("div",xo,[u(n(y),{icon:n(fa),class:i([[n(s).dropZoneFileIcon],"h-5 w-5"])},null,8,["icon","class"])])]),l("span",{class:i([[n(s).dropZoneFileText],"text-xs"])},"..",2)],34)):g("",!0),(p(!0),v(E,null,G(Ut.value,t=>(p(),v("div",{key:t.name,"data-filename":t.name,class:i(["group relative flex items-center gap-3 cursor-pointer px-2 py-1.5 rounded transition-colors appdrive-file-item touch-manipulation select-none overflow-hidden",I.value===t.name||k.value.has(t.name)?[n(s).desktopIconBgSelected||"bg-blue-500/20"]:[n(s).desktopIconBg||"hover:bg-white/5"]]),onClick:o=>Nt(t,o),onContextmenu:ye(o=>$e(o,t),["stop"]),onTouchstart:o=>gt(t,o),onTouchmove:qe,onTouchend:o=>xe(t,o),onTouchcancel:o=>xe(t,o)},[j.value[t.name]!==void 0&&j.value[t.name]<100?(p(),v("div",{key:0,class:"absolute inset-0 bg-blue-500/20 transition-all duration-300 ease-out",style:Q({width:`${j.value[t.name]}%`})},null,4)):g("",!0),l("div",yo,[l("div",wo,[u(n(y),{icon:la(t),class:i([[n(s).dropZoneFileIcon,U.value.has(t.name)?"opacity-40":""],"h-5 w-5"])},null,8,["icon","class"]),U.value.has(t.name)?(p(),v("div",bo,[u(n(y),{icon:n(da),class:i([[n(s).dropZoneLockIcon],"h-4 w-4 animate-spin"])},null,8,["icon","class"])])):g("",!0),U.value.has(t.name)?(p(),v("div",ko,[u(n(y),{icon:n(Ke),class:i([[n(s).dropZoneLockIcon],"h-3 w-3"])},null,8,["icon","class"])])):g("",!0)])]),l("div",_o,[l("span",{class:i([[n(s).dropZoneFileText],"text-xs truncate block"]),title:t.display_name},b(t.display_name),11,To)]),t.is_directory?g("",!0):(p(),v("div",{key:1,class:i([[n(s).dropZoneFileSize],"list-view-size text-[10px] font-medium px-1.5 py-0.5 rounded whitespace-nowrap flex-shrink-0 z-[1]"])},b(ia(t.size)),3)),Ge(t)?(p(),v("div",{key:2,class:i([[n(s).dropZoneFileSize],"list-view-time text-[10px] font-medium px-1.5 py-0.5 rounded whitespace-nowrap flex-shrink-0 z-[1]"])},b(Ge(t)),3)):g("",!0)],42,go))),128))]),_:1})]))]),_:1},8,["name"])):g("",!0):(p(),v("div",{key:0,class:"appdrive-container-picker relative w-full select-none",style:Q({height:`${Sa.value}px`})},[u(_t,{name:"container-icon"},{default:x(()=>[(p(!0),v(E,null,G(pt.value,t=>(p(),v("div",{key:t.name,onClick:o=>za(t.name),style:Q({position:"absolute",left:`${t.x}px`,top:`${t.y}px`}),class:i(["group flex flex-col items-center gap-1 cursor-pointer p-2 rounded-lg border border-transparent","transition-[background,transform,border,box-shadow] duration-150","w-[100px] h-[120px] select-none","hover:-translate-y-0.5",n(s).desktopIconBg||"hover:bg-white/5"])},[l("div",oo,[l("div",{class:i(["relative w-16 h-16 flex items-center justify-center rounded-2xl overflow-hidden border border-transparent","transition-[background,transform,border-color] duration-150",n(s).desktopIconContainerBg,n(s).desktopIconContainerBgHover])},[u(ua,{src:le(t.name).iconPath,alt:le(t.name).displayName,class:"w-12 h-12 object-contain rounded-xl",draggable:"false"},null,8,["src","alt"]),l("span",{class:i([[t.status==="running"?"bg-green-500":"bg-gray-400",n(s).desktopStatusBadgeBorder],"absolute bottom-1 right-1 w-3 h-3 rounded-full"])},null,2)],2),l("div",{class:i([[n(s).dropZoneFileSize],"absolute -top-1 -right-1 w-5 h-5 flex items-center justify-center rounded-full z-10"])},[u(n(y),{icon:n(ce),class:"w-3.5 h-3.5"},null,8,["icon"])],2)]),l("span",{class:i([[n(s).desktopIconText],"text-xs text-center max-w-full overflow-hidden text-ellipsis whitespace-nowrap font-medium"])},b(le(t.name).displayName),3)],14,no))),128))]),_:1}),ct.value.length===0&&!Pe.value?(p(),v("div",so,[u(n($t),{class:i([n(s).dropZoneEmptyText]),description:"No containers with accessible mounts found"},null,8,["class"])])):g("",!0)],4))],544)])]),u(hn,{visible:it.value,x:Rt.value,y:Bt.value,items:Fa.value,onClose:Ie},null,8,["visible","x","y","items"]),u(Je,{visible:ae.value,"onUpdate:visible":a[9]||(a[9]=t=>ae.value=t),type:"confirm",title:rt.value,content:ut.value,"ok-text":"Delete","cancel-text":"Cancel",onOk:Qa,onCancel:a[10]||(a[10]=t=>ae.value=!1)},null,8,["visible","title","content"]),u(Je,{visible:V.value,"onUpdate:visible":a[12]||(a[12]=t=>V.value=t),type:"info",title:"Create New Folder","ok-text":"Create","cancel-text":"Cancel",onOk:na,onCancel:a[13]||(a[13]=t=>V.value=!1),icon:n(Ee)},{default:x(()=>[l("div",So,[l("label",{class:i([[n(s).notTextDown],"text-sm block mb-2"])},"Folder name (max 255 characters)",2),u(n(ma),{value:pe.value,"onUpdate:value":a[11]||(a[11]=t=>pe.value=t),placeholder:"Enter folder name...",onPressEnter:na,class:i([[n(s).scopeSelector,n(s).loginFormInput],"h-10"]),autofocus:"",maxlength:255},{prefix:x(()=>[u(n(y),{icon:n(ce),class:i([[n(s).formIcon],"mr-0.5 transition duration-300"]),width:"16",height:"16"},null,8,["icon","class"])]),_:1},8,["value","class"])])]),_:1},8,["visible","icon"]),u(Je,{visible:Ce.value,"onUpdate:visible":a[15]||(a[15]=t=>Ce.value=t),type:"info",title:"Rename Item","ok-text":"Rename","cancel-text":"Cancel",onOk:sa,onCancel:a[16]||(a[16]=t=>Ce.value=!1),icon:n(et)},{default:x(()=>[l("div",Co,[l("label",{class:i([[n(s).notTextDown],"text-sm block mb-2"])},"New name (max 255 characters)",2),u(n(ma),{value:oe.value,"onUpdate:value":a[14]||(a[14]=t=>oe.value=t),placeholder:"Enter new name...",onPressEnter:sa,class:i([[n(s).scopeSelector,n(s).loginFormInput],"h-10"]),autofocus:"",maxlength:255},{prefix:x(()=>[u(n(y),{icon:n(et),class:i([[n(s).formIcon],"mr-0.5 transition duration-300"]),width:"16",height:"16"},null,8,["icon","class"])]),_:1},8,["value","class"])])]),_:1},8,["visible","icon"]),u(Je,{visible:De.value,"onUpdate:visible":a[17]||(a[17]=t=>De.value=t),type:"info",title:"Folder Upload Detected","ok-text":"Upload Folder","cancel-text":"Cancel",onOk:qa,onCancel:Va,icon:n(ce),width:480,"reverse-buttons":!0},{default:x(()=>[l("div",Do,[l("p",{class:i([[n(s).notTextDown],"text-sm leading-relaxed"])},[a[26]||(a[26]=ue(" You are about to upload ",-1)),l("strong",null,b(se.value?.allFiles.length||0)+" files",1),a[27]||(a[27]=ue(" across ",-1)),l("strong",null,b(se.value?.folders.length||0)+" directories",1),a[28]||(a[28]=ue(". ",-1))],2),l("p",{class:i([[n(s).notTextDown],"text-sm leading-relaxed"])},"The folder structure will be preserved inside the container's volume.",2)])]),_:1},8,["visible","icon"]),u(ge,{name:"upload-slide-up"},{default:x(()=>[T.value&&!Z.value?(p(),ze(n(Pn),{key:0,fileList:ke.value,"onUpdate:fileList":a[18]||(a[18]=t=>ke.value=t),name:"file",multiple:!0,customRequest:Ya,onChange:ja,showUploadList:!1,class:"fixed bottom-10 right-2 z-50 hidden max-[900px]:block"},{default:x(()=>[l("button",{class:i([[n(s).dropZoneSortButton],"w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-transform duration-300 active:scale-95 border-none cursor-pointer"]),title:"Upload Files"},[u(n(y),{icon:n(En),class:"w-6 h-6"},null,8,["icon"])],2)]),_:1},8,["fileList"])):g("",!0)]),_:1}),u(ge,{name:"upload-slide-up"},{default:x(()=>[n(C).isUploading?(p(),v("div",{key:0,class:i(["border-t",[n(s).dropZoneDragHolder,n(s).scopeSelector]])},[l("div",{class:i([n(s).hrSelector])},null,2),l("div",{onClick:a[19]||(a[19]=t=>Se.value=!Se.value),class:"flex items-center gap-2 h-7 pb-0.5 px-3 cursor-pointer hover:opacity-80 transition-opacity"},[l("div",Fo,[(p(),v("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",class:i([[n(s).dropZoneDragIcon],"flex-shrink-0"])},[...a[29]||(a[29]=[l("rect",{width:"24",height:"24",fill:"none"},null,-1),l("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.3"},[l("path",{"stroke-dasharray":"2 4","stroke-dashoffset":"6",d:"M12 21c-4.97 0 -9 -4.03 -9 -9c0 -4.97 4.03 -9 9 -9"},[l("animate",{attributeName:"stroke-dashoffset",dur:"0.6s",repeatCount:"indefinite",values:"6;0"})]),l("path",{"stroke-dasharray":"32","stroke-dashoffset":"32",d:"M12 3c4.97 0 9 4.03 9 9c0 4.97 -4.03 9 -9 9"},[l("animate",{fill:"freeze",attributeName:"stroke-dashoffset",begin:"0.1s",dur:"0.4s",values:"32;0"})]),l("path",{"stroke-dasharray":"10","stroke-dashoffset":"10",d:"M12 16v-7.5"},[l("animate",{fill:"freeze",attributeName:"stroke-dashoffset",begin:"0.5s",dur:"0.2s",values:"10;0"})]),l("path",{"stroke-dasharray":"6","stroke-dashoffset":"6",d:"M12 8.5l3.5 3.5M12 8.5l-3.5 3.5"},[l("animate",{fill:"freeze",attributeName:"stroke-dashoffset",begin:"0.7s",dur:"0.2s",values:"6;0"})])],-1)])],2)),l("span",{class:i([[n(s).dropZoneDragUpText],"text-[10px] leading-none truncate"])},b(Te.value)+" of "+b(de.value),3)]),l("div",Mo,[u(n(Mt),{percent:_a.value,class:i([[n(s).scopeSelector],"rounded-full flex-1"]),"show-info":!1,size:2,status:"active"},null,8,["percent","class"])]),u(n(y),{icon:n(Rn),class:i([[n(s).dropZoneFileIcon,"transition-transform duration-200",Se.value&&"rotate-180"],"w-3.5 h-3.5 flex-shrink-0"])},null,8,["icon","class"])]),u(ge,{name:"expand-height"},{default:x(()=>[Se.value?(p(),v("div",{key:0,class:i([n(s).dropZoneFileDisplayer])},[l("div",{class:i([n(s).hrSelector])},null,2),l("div",$o,[(p(!0),v(E,null,G(n(C).currentlyUploading,(t,o)=>(p(),v(E,{key:t.uid},[l("div",Io,[l("div",zo,[u(n(y),{icon:n(va),class:i([[n(s).dropZoneFileIcon],"w-3.5 h-3.5 flex-shrink-0"])},null,8,["icon","class"]),l("div",Eo,[l("div",Ro,[l("p",{class:i([[n(s).dropZoneFileText],"text-[11px] font-medium truncate flex-1"]),title:t.name},b(t.name),11,Bo),l("span",{class:i([[n(s).dropZoneFileSize],"text-[9px] font-semibold px-1 rounded whitespace-nowrap"])},b(n(C).uploadProgress[t.uid]||0)+"% ",3)]),u(n(Mt),{percent:n(C).uploadProgress[t.uid]||0,class:i([[n(s).scopeSelector],"rounded-full"]),"show-info":!1,size:1.5,status:"active"},null,8,["percent","class"])])])]),o<n(C).currentlyUploading.length-1||n(C).queue.length>0?(p(),v("div",{key:0,class:i([n(s).hrSelector])},null,2)):g("",!0)],64))),128)),(p(!0),v(E,null,G(n(C).queue.slice(0,3),(t,o)=>(p(),v(E,{key:t.uid},[l("div",Po,[l("div",Zo,[u(n(y),{icon:n(va),class:i([[n(s).dropZoneFileIcon],"w-3.5 h-3.5 flex-shrink-0"])},null,8,["icon","class"]),l("div",Uo,[l("p",{class:i([[n(s).dropZoneFileText],"text-[11px] truncate flex-1"]),title:t.name},b(t.name),11,Xo),l("span",{class:i([[n(s).dropZoneFileSize],"text-[9px] font-medium px-1 rounded whitespace-nowrap"])}," Waiting... ",2)])])]),o<Math.min(2,n(C).queue.length-1)?(p(),v("div",{key:0,class:i([n(s).hrSelector])},null,2)):g("",!0)],64))),128)),n(C).queue.length>3?(p(),v(E,{key:0},[l("div",{class:i([n(s).hrSelector])},null,2),l("div",Lo,[l("span",{class:i([[n(s).dropZoneFilesCount],"text-[9px] opacity-60"])}," And "+b(n(C).queue.length-3)+" more in queue... ",3)])],64)):g("",!0)])],2)):g("",!0)]),_:1})],2)):g("",!0)]),_:1}),u(zn,{visible:Ye.value,message:Et.value,position:"bottom-left"},null,8,["visible","message"]),u(Bn,{icon:n(St),message:Ca.value,info:Da.value,showHelp:!0},{help:x(()=>[l("div",Yo,[l("div",jo,[u(n(y),{icon:n(St),class:i(["w-5 h-5",n(s).statusBarIcon])},null,8,["icon","class"]),l("h4",{class:i(["text-base font-semibold",n(s).statusBarText])},"App Drive",2)]),l("div",{class:i(["text-[10px] md:text-xs space-y-2 leading-relaxed",n(s).statusBarInfo])},[...a[30]||(a[30]=[l("p",null,"Access and manage files stored in your applications volumes. Browse, upload, download, and organize files directly within the application mapped directories. Only volumes mounted within HomeDock OS data directory are accessible for security.",-1)])],2)])]),_:1},8,["icon","message","info"])],32))}}),ks=ln(No,[["__scopeId","data-v-08643f9b"]]);export{ks as default};
