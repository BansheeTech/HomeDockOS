import{e as O,am as P,ak as p,z as b,d as y,o as D,aD as E,P as g,a5 as C,B,U as k}from"./hdos_DO2KlacCFzRPXG-gXmGHl.js";import{a as I}from"./hdos_CT5z5oIZwHJJAu_bO76z6.js";import{h as j}from"./hdos_lQFk0Bcpd9-TmCuehLt8B.js";var x={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z"}}]},name:"right",theme:"outlined"};function v(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?Object(arguments[n]):{},s=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(t).filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable}))),s.forEach(function(a){N(e,a,t[a])})}return e}function N(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var R=function(n,t){var s=v({},n,t.attrs);return O(P,v({},s,{icon:x}),null)};R.displayName="RightOutlined";R.inheritAttrs=!1;const F=()=>{const e=p(!1);return b(()=>{e.value=!0}),e},M={type:{type:String},actionFn:Function,close:Function,autofocus:Boolean,prefixCls:String,buttonProps:k(),emitEvent:Boolean,quitOnNullishReturnValue:Boolean};function S(e){return!!(e&&e.then)}const z=y({compatConfig:{MODE:3},name:"ActionButton",props:M,setup(e,n){let{slots:t}=n;const s=p(!1),a=p(),c=p(!1);let d;const u=F();D(()=>{e.autofocus&&(d=setTimeout(()=>{var r,i;return(i=(r=E(a.value))===null||r===void 0?void 0:r.focus)===null||i===void 0?void 0:i.call(r)}))}),b(()=>{clearTimeout(d)});const o=function(){for(var r,i=arguments.length,l=new Array(i),f=0;f<i;f++)l[f]=arguments[f];(r=e.close)===null||r===void 0||r.call(e,...l)},m=r=>{S(r)&&(c.value=!0,r.then(function(){u.value||(c.value=!1),o(...arguments),s.value=!1},i=>(u.value||(c.value=!1),s.value=!1,Promise.reject(i))))},A=r=>{const{actionFn:i}=e;if(s.value)return;if(s.value=!0,!i){o();return}let l;if(e.emitEvent){if(l=i(r),e.quitOnNullishReturnValue&&!S(l)){s.value=!1,o(r);return}}else if(i.length)l=i(e.close),s.value=!1;else if(l=i(),!l){o();return}m(l)};return()=>{const{type:r,prefixCls:i,buttonProps:l}=e;return O(B,g(g(g({},C(r)),{},{onClick:A,loading:c.value,prefixCls:i},l),{},{ref:a}),t)}}}),T=j("selectedApps",{state:()=>({selectedApps:[],applications:[],desiredStates:{},errorStates:{}}),actions:{setApplications(e){const n=this.applications;this.applications=e.map(t=>{const s=n.find(u=>u.name===t.name);if(!s)return{...t,isProcessing:!1,checked:this.selectedApps.includes(t.name)};let a=s.isProcessing;const c=this.desiredStates[t.name];return c&&t.status===c&&(a=!1,delete this.desiredStates[t.name]),s.status!==t.status&&(a=!1),{...t,isProcessing:a,checked:this.selectedApps.includes(t.name)}})},setDesiredState(e,n){this.desiredStates[e]=n},clearDesiredState(e){delete this.desiredStates[e]},getDesiredState(e){return this.desiredStates[e]},setErrorState(e,n){this.errorStates[e]=n},clearErrorState(e){delete this.errorStates[e]},saveOrder(){const e="dashboardLocalOrder",n=this.applications.filter(t=>t.HDRole!=="dependency").map(t=>t.name);localStorage.setItem(e,JSON.stringify(n))},updateSelection(e){this.selectedApps=e,this.applications.forEach(n=>{n.checked=e.includes(n.name)})},clearSelection(){this.selectedApps=[],this.applications.forEach(e=>{e.checked=!1})},toggleSelection(e){const n=this.applications.find(t=>t.name===e);n&&(n.checked=!n.checked,n.checked?this.selectedApps.push(n.name):this.selectedApps=this.selectedApps.filter(t=>t!==e))},setProcessing(e,n){const t=this.applications.find(s=>s.name===e);t&&(t.isProcessing=n)}}});let h=null;async function _(e){const n=T();try{const t=await I.get("/api/containers",{headers:{"X-HomeDock-CSRF-Token":e}});if(t.status===200){const s=t.data,a=H(s);return n.setApplications(a),a}return[]}catch(t){throw console.error("Error fetching containers:",t),t}}function H(e){const t=localStorage.getItem("dashboardLocalOrder");if(!t)return e;const s=JSON.parse(t),a=e.filter(o=>o.HDRole!=="dependency"),c=e.filter(o=>o.HDRole==="dependency"),d=s.map(o=>a.find(m=>m.name===o)).filter(Boolean),u=a.filter(o=>!s.includes(o.name));return[...d,...u,...c]}function J(e,n=3e3){L(),h=setInterval(()=>_(e),n)}function L(){h&&(clearInterval(h),h=null)}export{z as A,R,L as a,_ as f,J as s,T as u};
