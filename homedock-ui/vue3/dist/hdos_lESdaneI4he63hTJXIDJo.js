import{aU as f,q as E,M as ge,bQ as be,s as qe,aL as k,u as L,t as N,aw as U,v as u,au as r,bk as a,I as m,bV as xe,bb as z,T as Ke,bE as ee,aD as Je,aI as Qe,bU as P,bJ as te,F as et,aX as tt,g as nt,h as at,bR as ot}from"./hdos_C_SZsOMSIrMtpKxCvYKSt.js";import{i as st,a as lt,X as it,ag as rt,g as ut,ah as ct,ai as dt,n as fe,a6 as vt,a1 as pt,aa as mt,a9 as ft,a7 as ht,ab as gt,aj as bt,ak as xt,ad as yt,ac as wt,O as _t,al as It,am as Ct,V as Mt,L as St,an as Bt,t as Et,o as kt,S as Dt,C as Lt,a5 as he}from"./hdos_B9WmLlHFvqcjTrToCZWMf.js";import{_ as Tt}from"./hdos_BmL9voBJ5b5vwqQC2jvAb.js";import{d as $t}from"./hdos_Dk8ORdgBuQt10zGqyIF6s.js";import{e as At}from"./hdos_D24I8Ewnx4pcuVD2m8YP9.js";import{d as Xt}from"./hdos_D-aTiBESONjHycDbZB5aD.js";import"./hdos_DCATHP924u4YkH9cyFcrU.js";import"./hdos_DahYSjy4MuyfOawe4NtU9.js";import"./hdos_Dz3aTMQqM4LnOlKzV3COc.js";import"./hdos_itWSuQ2oYLgMGq-Z_V6WL.js";import"./hdos_DCQvziD-0BGtLQC-jPv6N.js";import"./hdos_CJoaCRc7PMIr83ndc1bSY.js";import"./hdos_rIjgvs8g2SvFuibaH9wZC.js";import"./hdos_Cuccj8xUVyEDTvA_fcq1n.js";import"./hdos_BdDg-PaJlPE_ULloEgxIz.js";import"./hdos_B29Fis5VcXiuAWmU0jOeO.js";function Rt(h={}){const{zIndex:v=1e4}=h,d=f(!1),g=f({x:0,y:0}),x=f([]),s=E(()=>({position:"fixed",left:`${g.value.x}px`,top:`${g.value.y}px`,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:v}));function H(b,M){x.value=b,g.value={x:M.x,y:M.y},d.value=!0}function I(b){g.value={x:b.x,y:b.y}}function c(){d.value=!1,x.value=[]}return{isVisible:d,position:g,items:x,ghostStyle:s,show:H,updatePosition:I,hide:c}}const Yt={class:"relative"},Pt={key:0,class:"absolute -top-2 -right-2 bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold shadow-lg"},zt=ge({__name:"DragGhost",props:{visible:{type:Boolean},items:{},style:{}},setup(h){const{themeClasses:v}=be();return(d,g)=>(k(),qe(Ke,{to:"body"},[h.visible&&h.items.length>0?(k(),L("div",{key:0,class:"fixed pointer-events-none",style:U(h.style)},[u("div",Yt,[u("div",{class:r(["flex flex-col items-center gap-1 p-3 rounded-lg w-[100px] opacity-90",[a(v).desktopIconBgSelected,a(v).desktopIconBorderSelected]])},[u("div",{class:r(["relative w-16 h-16 flex items-center justify-center rounded-2xl overflow-hidden border",[a(v).desktopIconContainerBg,a(v).desktopIconContainerBorderSelected]])},[m(xe,{src:h.items[0].image_path,class:"w-12 h-12 object-contain pointer-events-none rounded-xl",alt:"",draggable:"false"},null,8,["src"])],2),u("span",{class:r([[a(v).desktopIconText],"text-xs text-center max-w-full overflow-hidden text-ellipsis whitespace-nowrap font-medium"])},z(h.items[0].display_name||h.items[0].name),3)],2),h.items.length>1?(k(),L("div",Pt,z(h.items.length),1)):N("",!0)])],4)):N("",!0)]))}}),Gt={width:24,height:24,hidden:!0,body:'<path fill="currentColor" d="M21 14H3V4h18m0-2H3c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h7l-2 3v1h8v-1l-2-3h7a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2Z"/>'},Ot={key:0,class:"empty-folder-state"},Ft=["data-app-id","onMousedown","onClick","onDblclick","onContextmenu","onTouchstart","onTouchend","title"],Wt={key:0,class:"absolute inset-0 flex items-center justify-center bg-black/20 rounded-2xl pointer-events-none z-[2]"},Ut={class:"space-y-2.5 max-w-sm"},Nt={class:"flex items-center gap-2"},B=16,Ht=ge({__name:"AppFolder",props:{folderId:{}},setup(h){const v=h,d=st(),g=lt(),{isMobile:x}=it(),{themeClasses:s}=be(),{confirm:H}=rt(),I=ut(),c=f(null),b=f(110),M=f(125),S=f(16),ne=E(()=>({sizeX:b.value,sizeY:M.value,padding:S.value,iconWidth:100,iconHeight:130})),{selectedApp:D,selectedApps:C,isSelectingArea:A,selectionBox:p,selectionBoxStyle:ye,selectItem:ae,clearSelection:we}=ct({containerRef:c,gridConfig:ne,enableBoxSelection:!0,enableMultiSelect:!0}),_e=E(()=>({selectedApp:D.value,selectedApps:C.value,selectedFolder:null,selectedFolders:new Set,selectedSystemIcon:null,selectedSystemIcons:new Set})),{isDragging:X,hasMoved:R,startDrag:Ie,updateDrag:oe,endDrag:V,handleTouchStart:Ce}=dt({mode:"ghost",containerId:v.folderId,containerRef:c,gridConfig:ne,selection:_e,enableMobileDrag:!1,onMobileTap:(e,t)=>{ae({type:"app",id:e.id})},onMobileDoubleTap:(e,t)=>{const n=_.value.find(l=>l.id===e.id);n&&re(n,!0)},onMobileLongPress:(e,t)=>{const n=_.value.find(l=>l.id===e.id);if(n){const l=t.touches?.[0]||t.changedTouches?.[0];if(l){const o=new MouseEvent("contextmenu",{bubbles:!0,cancelable:!0,clientX:l.clientX,clientY:l.clientY});ue(o,n)}}}}),{ghostStyle:Me,updatePosition:se}=Rt(),y=f(null),i=f(null),j=f(0),G=f(!1),le=E(()=>{if(!X.value||!R.value||!y.value)return[];const e=C.value;if(e.size>0&&e.has(y.value))return _.value.filter(n=>e.has(n.id));const t=_.value.find(n=>n.id===y.value);return t?[t]:[]}),T=f({visible:!1,x:0,y:0}),Se=E(()=>d.getFolderById(v.folderId)),Z=E(()=>Se.value?.name||"Unknown Folder"),_=E(()=>{const e=d.getAppsInFolder(v.folderId),t={running:1,paused:2,restarting:3,created:4,exited:5};return e.sort((n,l)=>{const o=t[n.status]||99,w=t[l.status]||99;return o===w?n.name.localeCompare(l.name):o-w})}),Be=ye;function Ee(e){return{running:s.value.statusBadgeRunning,exited:s.value.statusBadgeExited,paused:s.value.statusBadgePaused,created:s.value.statusBadgeCreated,restarting:s.value.statusBadgeRestarting}[e]||s.value.statusBadgeCreated}function O(){const e=c.value?.clientWidth||window.innerWidth;if(x.value){const l=e-32,o=Math.floor(l/4);b.value=o,M.value=o+15,S.value=16}else b.value=110,M.value=125,S.value=16;De()}function ke(e){const t=j.value||1,n=Math.floor(e/t),l=e%t,o={position:"absolute",left:`${S.value+l*b.value}px`,top:`${S.value+n*M.value}px`};return x.value&&(o.width=`${b.value}px`),o}function De(){const e=c.value?.clientWidth||window.innerWidth;j.value=Math.max(1,Math.floor((e-S.value*2)/b.value))}function Le(e){return{running:"",paused:"brightness-50 opacity-75",exited:"grayscale brightness-50 opacity-75",created:"brightness-50 sepia opacity-50"}[e.status]||""}function Te(e,t){if(R.value)return;const n=t?.ctrlKey||t?.metaKey;ae({type:"app",id:e.id},{ctrl:n})}function $e(e){if(x.value||e.target.closest(".desktop-icon")||e.button!==0)return;const t=c.value?.getBoundingClientRect();if(!t)return;we();const n=e.clientX-t.left,l=e.clientY-t.top,o=Math.max(B,Math.min(n,t.width-B)),w=Math.max(B,Math.min(l,t.height-B));A.value=!0,p.value.startX=o,p.value.startY=w,p.value.currentX=o,p.value.currentY=w,document.addEventListener("mousemove",q),document.addEventListener("mouseup",K)}function q(e){if(!A.value)return;const t=c.value?.getBoundingClientRect();if(!t)return;const n=e.clientX-t.left,l=e.clientY-t.top;p.value.currentX=Math.max(B,Math.min(n,t.width-B)),p.value.currentY=Math.max(B,Math.min(l,t.height-B)),Ae()}function K(e){A.value&&(A.value=!1,document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",K))}function Ae(){const e=Math.min(p.value.startX,p.value.currentX),t=Math.min(p.value.startY,p.value.currentY),n=Math.abs(p.value.currentX-p.value.startX),l=Math.abs(p.value.currentY-p.value.startY);C.value.clear();const o=e,w=t,We=e+n,Ue=t+l,de=j.value||1;_.value.forEach((Ne,ve)=>{const He=Math.floor(ve/de),Ve=ve%de,pe=S.value+Ve*b.value,me=S.value+He*M.value,je=pe+100,Ze=me+130;o<je&&We>pe&&w<Ze&&Ue>me&&C.value.add(Ne.id)})}const $=f({x:0,y:0});function Xe(e,t,n){y.value=e.id;const l=c.value?.querySelector(`[data-app-id="${e.id}"]`);if(l){const o=l.getBoundingClientRect();$.value={x:t-o.left-o.width/2,y:n-o.top-o.height/2}}else $.value={x:50,y:60};Ie({type:"app",id:e.id},t,n)}function Re(e,t){x.value||e.button===0&&(e.preventDefault(),Xe(t,e.clientX,e.clientY),document.addEventListener("mousemove",F),document.addEventListener("mouseup",W))}function F(e){y.value&&(oe(e.clientX,e.clientY),R.value&&se({x:e.clientX-$.value.x,y:e.clientY-$.value.y}))}function W(e){document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",W),V(),y.value=null}function ie(e){if(!y.value)return;if(e.touches.length>1){Y();return}const t=e.touches[0];oe(t.clientX,t.clientY),R.value&&(e.preventDefault(),se({x:t.clientX-$.value.x,y:t.clientY-$.value.y}))}function Y(e){document.removeEventListener("touchmove",ie),document.removeEventListener("touchend",Y),document.removeEventListener("touchcancel",Y),V(),y.value=null}function re(e,t=!1){if(x.value&&!t)return;e.status==="running"&&e.service_url?window.open(e.service_url,"_blank","noopener,noreferrer"):g.openWindow("properties",{title:`${e.display_name||e.name} - Properties`,data:{appId:e.id},allowMultiple:!0})}function ue(e,t){e.preventDefault(),e.stopPropagation(),D.value=t.id,i.value=t,T.value={visible:!0,x:e.clientX,y:e.clientY}}function Ye(e){e.target.closest(".desktop-icon")||(e.preventDefault(),e.stopPropagation(),D.value=null,i.value=null,T.value={visible:!0,x:e.clientX,y:e.clientY})}const Pe=E(()=>{if(!i.value)return[{label:"Refresh",icon:fe,action:()=>{}}];const e=i.value,t=e.status==="running",n=e.status==="exited",l=e.status==="paused",o=[];return t&&e.service_url&&(o.push({label:"Open",icon:At,action:()=>{i.value?.service_url&&window.open(i.value.service_url,"_blank","noopener,noreferrer")}}),o.push({divider:!0})),o.push({label:t?"Stop":"Start",icon:t?vt:pt,action:async()=>{i.value&&(t?await mt(i.value,I.value,s.value.scopeSelector):await ft(i.value,I.value,s.value.scopeSelector))},disabled:l}),o.push({label:"Restart",icon:ht,action:async()=>{i.value&&await gt(i.value,I.value,s.value.scopeSelector)},disabled:n}),o.push({divider:!0}),o.push({label:l?"Unpause":"Pause",icon:l?bt:xt,action:async()=>{i.value&&(l?await yt(i.value,I.value,s.value.scopeSelector):await wt(i.value,I.value,s.value.scopeSelector))},disabled:n}),o.push({divider:!0}),o.push({label:"View Logs",icon:_t,action:()=>{i.value&&g.openWindow("logs",{title:`${i.value.display_name||i.value.name} - Logs`,data:{appName:i.value.name},allowMultiple:!0})}}),o.push({label:"Update",icon:It,action:async()=>{i.value&&await Ct(i.value,I.value,s.value.scopeSelector)}}),o.push({label:"Refresh",icon:fe,action:()=>{}}),o.push({divider:!0}),o.push({label:"Properties",icon:Mt,action:()=>{i.value&&g.openWindow("properties",{title:`${i.value.display_name||i.value.name} - Properties`,data:{appId:i.value.id},allowMultiple:!0})}}),o.push({divider:!0}),o.push({label:"Remove from Folder",icon:Xt,action:()=>{i.value&&d.removeAppFromFolder(i.value.id)}}),o.push({divider:!0}),o.push({label:"Uninstall",icon:St,action:()=>{if(!i.value)return;const w=i.value;H({title:"Confirm Uninstall",content:`Are you sure you want to uninstall ${w.display_name||w.name}? This action cannot be undone.`,okText:"Uninstall",cancelText:"Cancel",onOk:async()=>{await Bt(w,I.value,s.value.scopeSelector)}})}}),o});function ze(){T.value.visible=!1,i.value=null}function Ge(e,t){Ce(e,{type:"app",id:t.id})}function Oe(e){}function Vt(e,t){}function Fe(e,t){if(!c.value)return!1;const n=c.value.getBoundingClientRect();return e>=n.left&&e<=n.right&&t>=n.top&&t<=n.bottom}function J(e){G.value=Fe(e.clientX,e.clientY)}function Q(e){G.value&&d.draggedAppIds.length>0&&(e.preventDefault(),d.draggedAppIds.forEach(t=>{const n=d.dockerApps.find(l=>l.id===t);n&&n.folderId!==v.folderId&&d.addAppToFolder(t,v.folderId)}),d.clearDraggedApps()),G.value=!1}ee(()=>d.draggedAppIds.length>0,e=>{e?(document.addEventListener("mousemove",J,!0),document.addEventListener("mouseup",Q,!0)):(document.removeEventListener("mousemove",J,!0),document.removeEventListener("mouseup",Q,!0),G.value=!1,X.value&&(X.value=!1,y.value=null,R.value=!1,document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",W)))}),ee(Z,e=>{const t=g.windows.find(n=>n.appId==="folder-view"&&n.data?.folderId===v.folderId);t&&g.updateWindowTitle(t.id,e)},{immediate:!1});function ce(){O()}return ee(()=>x.value,()=>{O()}),Je(()=>{if(O(),window.addEventListener("resize",ce),c.value){const e=new ResizeObserver(()=>{O()});e.observe(c.value),c.value.__resizeObserver=e}}),Qe(()=>{y.value=null,V(),window.removeEventListener("resize",ce),c.value&&c.value.__resizeObserver&&c.value.__resizeObserver.disconnect(),document.removeEventListener("mousemove",J,!0),document.removeEventListener("mouseup",Q,!0),document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",W),document.removeEventListener("touchmove",ie),document.removeEventListener("touchend",Y),document.removeEventListener("touchcancel",Y),document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",K),X.value&&d.clearDraggedApps()}),(e,t)=>(k(),L("div",{class:r(["folder-view-container",a(s).folderContainerBg])},[u("div",{class:r(["folder-breadcrumb",[a(s).folderBreadcrumbBg,a(s).folderBreadcrumbBorder]])},[m(a(P),{icon:a(Gt),class:r(["breadcrumb-icon",a(s).folderBreadcrumbIcon])},null,8,["icon","class"]),u("span",{class:r(["breadcrumb-text",a(s).folderBreadcrumbText])},"Desktop",2),m(a(P),{icon:a(Et),class:r(["breadcrumb-separator",a(s).folderBreadcrumbSeparator])},null,8,["icon","class"]),m(a(P),{icon:a(kt),class:r(["breadcrumb-icon",a(s).folderBreadcrumbIcon])},null,8,["icon","class"]),u("span",{class:r(["breadcrumb-text folder-name",a(s).folderBreadcrumbText])},z(Z.value),3),u("span",{class:r(["app-count",a(s).folderAppCount])},"("+z(_.value.length)+" apps)",3)],2),_.value.length===0?(k(),L("div",Ot,[m(a(P),{icon:a($t),class:r(["empty-icon",a(s).folderEmptyIcon])},null,8,["icon","class"]),u("h3",{class:r(["empty-title",a(s).folderEmptyTitle])},"Empty folder",2),u("p",{class:r(["empty-description",a(s).folderEmptyDescription])},"Drag apps here to organize them",2)])):N("",!0),u("div",{class:"folder-apps-grid",ref_key:"containerRef",ref:c,onContextmenu:Ye,onMousedown:$e},[m(Dt,{visible:a(A),style:U(a(Be))},null,8,["visible","style"]),m(at,{name:"icon-appear"},{default:te(()=>[(k(!0),L(et,null,tt(_.value,(n,l)=>(k(),L("div",{key:n.id,"data-app-id":n.id,class:r(["desktop-icon group flex flex-col items-center gap-1 cursor-pointer p-3 rounded-lg w-[100px] z-[1] select-none outline-none border",a(x)?"touch-pan-y":"touch-none",!(a(D)===n.id||a(C).has(n.id))&&["border-transparent","shadow-[0_0_0_1px_transparent]"],(a(D)===n.id||a(C).has(n.id))&&[a(s).desktopIconBgSelected,a(s).desktopIconBorderSelected,a(s).desktopIconShadowSelected],a(X)&&(y.value===n.id||a(C).has(n.id))?"opacity-50 !cursor-grabbing":"hover:-translate-y-0.5 active:cursor-grabbing"]),style:U(ke(l)),onMousedown:o=>Re(o,n),onClick:o=>Te(n,o),onDblclick:o=>re(n),onContextmenu:o=>ue(o,n),onTouchstart:o=>Ge(o,n),onTouchmove:Oe,onTouchend:o=>void 0,title:`${n.display_name||n.name} (${n.status})`},[u("div",{class:r(["icon-container relative w-16 h-16 flex items-center justify-center rounded-2xl overflow-hidden pointer-events-none border",a(s).desktopIconContainerBg,a(s).desktopIconContainerScaleHover,!(a(D)===n.id||a(C).has(n.id))&&["border-transparent",a(s).desktopIconContainerBgHover],(a(D)===n.id||a(C).has(n.id))&&[a(s).desktopIconContainerBgSelected,a(s).desktopIconContainerBorderSelected],Le(n)])},[m(xe,{src:n.image_path,class:"app-image rounded-xl",alt:"",draggable:"false"},null,8,["src"]),m(nt,{name:"loading-overlay-fade"},{default:te(()=>[n.isProcessing===!0?(k(),L("div",Wt,[...t[0]||(t[0]=[u("div",{class:"w-8 h-8 rounded-full border-[3px] border-white/30 border-t-blue-500 animate-spin shadow-lg"},null,-1)])])):N("",!0)]),_:2},1024),u("div",{class:r(["status-badge",Ee(n.status),a(s).desktopStatusBadgeBorder,{"status-pulse":n.status==="running"}])},null,2)],2),u("span",{class:r(["app-name",[a(s).desktopIconText]])},z(n.display_name||n.name),3)],46,Ft))),128))]),_:1})],544),m(Lt,{visible:T.value.visible,x:T.value.x,y:T.value.y,items:Pe.value,onClose:ze},null,8,["visible","x","y","items"]),m(Tt,{icon:a(he),message:`${Z.value}`,info:`${_.value.length} ${_.value.length===1?"app":"apps"}`,showHelp:!0},{help:te(()=>[u("div",Ut,[u("div",Nt,[m(a(P),{icon:a(he),class:r(["w-5 h-5",a(s).statusBarIcon])},null,8,["icon","class"]),u("h4",{class:r(["text-base font-semibold",a(s).statusBarText])},"Folder",2)]),u("div",{class:r(["text-[10px] md:text-xs space-y-2 leading-relaxed",a(s).statusBarInfo])},[...t[1]||(t[1]=[u("p",null,"Folders help you organize your apps by grouping related applications together. Create folders by dragging apps on top of each other on the desktop, making it easier to manage and access your installed applications.",-1)])],2)])]),_:1},8,["icon","message","info"]),m(zt,{visible:le.value.length>0,items:le.value,style:U(a(Me))},null,8,["visible","items","style"])],2))}}),vn=ot(Ht,[["__scopeId","data-v-1283b589"]]);export{vn as default};
