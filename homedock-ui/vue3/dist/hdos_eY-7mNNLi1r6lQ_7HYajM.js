import{M as Be,bQ as $e,aU as i,bE as ce,aD as Le,aI as Se,u as y,aL as _,v as n,I as c,t as Ve,au as s,bk as a,bU as f,bb as C,aw as de,bO as De,A as He,bJ as fe,H as Y,bR as Ue}from"./hdos_BnIymrgN3FMaW96NhsgWi.js";import{d as Xe,a as P}from"./hdos_DahYSjy4MuyfOawe4NtU9.js";import{c as je,a as ze,al as Fe,am as ve}from"./hdos_DMBX8EgZFkFEssZyeFxZ3.js";import{_ as Ye}from"./hdos_BcWAxXmlibZ2SSqtP9a_8.js";import{a as Pe,d as me}from"./hdos_BhSrQuT_-kshj2sfQCltl.js";import{d as We}from"./hdos__v-SyBCIMCm6obe4dZLFs.js";import{d as pe}from"./hdos_DM3zcfrM_gHAclaIngbnU.js";import"./hdos_BwFNaVKxrzJr1i43ZL7xh.js";import"./hdos_B3Gn8FiDAIlVGTwMyO36P.js";import"./hdos_Dz3aTMQqM4LnOlKzV3COc.js";import"./hdos_itWSuQ2oYLgMGq-Z_V6WL.js";import"./hdos_DCQvziD-0BGtLQC-jPv6N.js";import"./hdos_CJoaCRc7PMIr83ndc1bSY.js";import"./hdos_CtY2UTrCU7CborQ9sr8jv.js";import"./hdos_Cuccj8xUVyEDTvA_fcq1n.js";import"./hdos_TIm5gfXqLWlO6DtkdAyHA.js";import"./hdos_CDFYpsm_-2sqqpjcHcxLG.js";const he={width:24,height:24,body:'<path fill="currentColor" d="M19 12h-2v3h-3v2h5v-5M7 9h3V7H5v5h2V9m14-6H3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 16H3V5h18v14Z"/>'},Re={width:24,height:24,body:'<path fill="currentColor" d="m14 2l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8m4 18V9h-5V4H6v16h12m-1-7v6H7l5-5l2 2m-4-5.5A1.5 1.5 0 0 1 8.5 12A1.5 1.5 0 0 1 7 10.5A1.5 1.5 0 0 1 8.5 9a1.5 1.5 0 0 1 1.5 1.5Z"/>'},Ae={class:"image-viewer flex flex-col h-full overflow-hidden"},Ze=["disabled"],Ne=["disabled"],Oe={key:0,class:"absolute inset-0 flex items-center justify-center"},Ge={class:"flex flex-col items-center gap-3"},Ke={key:1,class:"absolute inset-0 flex items-center justify-center"},qe={class:"flex flex-col items-center gap-3 text-center p-8"},Je={class:"w-16 h-16 rounded-2xl flex items-center justify-center bg-red-500/10"},Qe={key:2,class:"absolute inset-0 flex items-center justify-center"},et={class:"flex flex-col items-center gap-3 text-center p-8"},tt=["src","alt"],at={class:"flex items-center gap-1 text-green-500 text-[10px]"},nt={class:"space-y-3 max-w-sm"},ot={class:"flex items-center gap-2"},it={class:"space-y-1.5"},lt={class:"flex items-start gap-2"},st={class:"flex items-start gap-2"},ut={class:"flex items-start gap-2"},rt=Be({__name:"UtilsImageViewer",props:{_windowId:{},externalFile:{},imageFile:{}},setup(ge){const{themeClasses:l}=$e(),S=je(),W=ze(),m=ge,V=i(null),x=i(null),p=i(null),E=i(""),R=i(m._windowId&&W.getWindowById(m._windowId)?.title||""),B=i(""),T=i(!1),b=i(null),k=i(!1),r=i(1),h=i("fit"),g=i(0),w=i(0),M=i(!1),A=i(0),Z=i(0),N=i(0),O=i(0),$=i(!1),L=i(0),G=i(1),D=i(0),H=i(0),U=i(0),X=i(0),v=i(null);function K(e){const t=new Uint8Array(e);return t[0]===255&&t[1]===216&&t[2]===255?"jpeg":t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71?"png":t[0]===71&&t[1]===73&&t[2]===70&&t[3]===56?"gif":t[0]===82&&t[1]===73&&t[2]===70&&t[3]===70&&t[8]===87&&t[9]===69&&t[10]===66&&t[11]===80?"webp":t[0]===66&&t[1]===77?"bmp":t[0]===0&&t[1]===0&&t[2]===1&&t[3]===0?"ico":t[0]===73&&t[1]===73&&t[2]===42&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===42?"tiff":null}function we(e){const t=e.toLowerCase().split(".");return t.length>1?t[t.length-1]:""}function xe(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`}function q(e){m._windowId&&e&&R.value&&W.updateWindowTitle(m._windowId,`${R.value} - ${e}`)}const J={jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",bmp:"image/bmp",ico:"image/x-icon",tiff:"image/tiff"};function Q(e,t){const o=new Uint8Array(e);let u="";for(let d=0;d<o.byteLength;d++)u+=String.fromCharCode(o[d]);return`data:${t};base64,${btoa(u)}`}async function ee(e){T.value=!0,b.value=null,k.value=!1,p.value=null,v.value=null,E.value=e.name,q(e.name);const t=we(e.name);try{let o,u;if(e.source==="storage")o=await P.get("/api/storage/download",{params:{file:e.path},headers:{"X-HomeDock-CSRF-Token":S.value},responseType:"arraybuffer"}),u=o.data;else if(e.source==="dropzone")o=await P.get("/api/dropzone/download",{params:{file:e.path},headers:{"X-HomeDock-CSRF-Token":S.value},responseType:"arraybuffer"}),u=o.data;else if(e.source==="appdrive")o=await P.get("/api/appdrive/download",{params:{container:e.container,path:e.path},headers:{"X-HomeDock-CSRF-Token":S.value},responseType:"arraybuffer"}),u=o.data;else throw new Error("Unknown file source");const d=K(u);if(!d)throw new Error("File does not appear to be a valid image. Magic bytes validation failed.");if(!({jpeg:["jpg","jpeg"],png:["png"],gif:["gif"],webp:["webp"],bmp:["bmp"],ico:["ico"],tiff:["tif","tiff"]}[d]||[]).includes(t))throw new Error(`File extension (.${t}) does not match detected type (${d.toUpperCase()}). Possible file manipulation detected.`);const Ee=J[d];p.value=Q(u,Ee),B.value=d.toUpperCase(),k.value=!0,v.value={width:0,height:0,size:u.byteLength}}catch(o){console.error("Failed to load image:",o),b.value=o.message||"Failed to load image"}finally{T.value=!1}}function te(e){T.value=!0,b.value=null,k.value=!1,p.value=null,v.value=null,E.value=e.name,q(e.name);const t=e.extension.toLowerCase();try{const o=e.buffer,u=K(o);if(!u)throw new Error("File does not appear to be a valid image. Magic bytes validation failed.");if(!({jpeg:["jpg","jpeg"],png:["png"],gif:["gif"],webp:["webp"],bmp:["bmp"],ico:["ico"],tiff:["tif","tiff"]}[u]||[]).includes(t))throw new Error(`File extension (.${t}) does not match detected type (${u.toUpperCase()}). Possible file manipulation detected.`);const re=J[u];p.value=Q(o,re),B.value=u.toUpperCase(),k.value=!0,v.value={width:0,height:0,size:o.byteLength}}catch(o){console.error("Failed to load image:",o),b.value=o.message||"Failed to load image"}finally{T.value=!1}}function be(){x.value&&v.value&&(v.value.width=x.value.naturalWidth,v.value.height=x.value.naturalHeight),j()}function ye(){b.value="Failed to decode image",p.value=null}function ae(){r.value=Math.min(5,r.value*1.25),h.value="custom"}function ne(){r.value=Math.max(.1,r.value/1.25),h.value="custom"}function j(){if(!V.value||!x.value)return;const e=V.value.getBoundingClientRect(),t=x.value.naturalWidth,o=x.value.naturalHeight;if(t===0||o===0)return;const u=(e.width-40)/t,d=(e.height-40)/o;r.value=Math.min(1,Math.min(u,d)),h.value="fit",g.value=0,w.value=0}function oe(){r.value=1,h.value="actual",g.value=0,w.value=0}function _e(e){const t=e.deltaY>0?.9:1.1,o=Math.max(.1,Math.min(5,r.value*t));r.value=o,h.value="custom"}function Te(e){e.button===0&&(M.value=!0,A.value=e.clientX,Z.value=e.clientY,N.value=g.value,O.value=w.value,document.addEventListener("mouseup",z),document.addEventListener("mousemove",F))}function z(){ke(),document.removeEventListener("mouseup",z),document.removeEventListener("mousemove",F)}function F(e){if(!M.value)return;const t=e.clientX-A.value,o=e.clientY-Z.value;g.value=N.value+t,w.value=O.value+o}function ke(){M.value=!1}function ie(e){if(e.length<2)return 0;const t=e[0].clientX-e[1].clientX,o=e[0].clientY-e[1].clientY;return Math.sqrt(t*t+o*o)}function Me(e){e.touches.length===2?(e.preventDefault(),L.value=ie(e.touches),G.value=r.value,$.value=!0):e.touches.length===1&&($.value=!0,D.value=e.touches[0].clientX,H.value=e.touches[0].clientY,U.value=g.value,X.value=w.value)}function Ie(e){if($.value){if(e.touches.length===2){e.preventDefault();const t=ie(e.touches);if(L.value>0){const o=t/L.value,u=Math.max(.1,Math.min(5,G.value*o));r.value=u,h.value="custom"}}else if(e.touches.length===1){e.preventDefault();const t=e.touches[0].clientX-D.value,o=e.touches[0].clientY-H.value;g.value=U.value+t,w.value=X.value+o}}}function le(e){e.touches.length===0?($.value=!1,L.value=0):e.touches.length===1&&(D.value=e.touches[0].clientX,H.value=e.touches[0].clientY,U.value=g.value,X.value=w.value)}function se(e){e.key==="+"||e.key==="="?(e.preventDefault(),ae()):e.key==="-"?(e.preventDefault(),ne()):e.key==="0"?(e.preventDefault(),oe()):(e.key==="f"||e.key==="F")&&(e.preventDefault(),j())}function I(){p.value=null}ce(()=>m.externalFile,e=>{e&&(I(),ee(e))},{immediate:!0}),ce(()=>m.imageFile,e=>{e&&(I(),te(e))},{immediate:!0});function ue(e){const t=e.detail;t?.imageFile?(I(),te(t.imageFile)):t?.externalFile&&(I(),ee(t.externalFile))}return Le(()=>{document.addEventListener("keydown",se),m._windowId&&window.addEventListener(`homedock:open-file-${m._windowId}`,ue)}),Se(()=>{document.removeEventListener("keydown",se),document.removeEventListener("mouseup",z),document.removeEventListener("mousemove",F),m._windowId&&window.removeEventListener(`homedock:open-file-${m._windowId}`,ue),I()}),(e,t)=>(_(),y("div",Ae,[n("div",{class:s(["toolbar flex items-center gap-2 px-3 py-2 border-b flex-shrink-0",a(l).utilityToolbarBorder])},[n("button",{onClick:ne,disabled:r.value<=.1,class:s([[a(l).windowText,a(l).windowButtonBgHover],"p-1.5 rounded transition-colors disabled:opacity-30"]),title:"Zoom Out (-)"},[c(a(f),{icon:a(Pe),class:"w-4 h-4"},null,8,["icon"])],10,Ze),n("span",{class:s(["text-xs min-w-[50px] text-center",a(l).windowText])},C(Math.round(r.value*100))+"%",3),n("button",{onClick:ae,disabled:r.value>=5,class:s([[a(l).windowText,a(l).windowButtonBgHover],"p-1.5 rounded transition-colors disabled:opacity-30"]),title:"Zoom In (+)"},[c(a(f),{icon:a(me),class:"w-4 h-4"},null,8,["icon"])],10,Ne),n("div",{class:s(["w-px h-4 mx-1",a(l).utilityDivider])},null,2),n("button",{onClick:j,class:s([[a(l).windowText,a(l).windowButtonBgHover,h.value==="fit"?"bg-blue-500/20":""],"p-1.5 rounded transition-colors"]),title:"Fit to Window"},[c(a(f),{icon:a(We),class:"w-4 h-4"},null,8,["icon"])],2),n("button",{onClick:oe,class:s([[a(l).windowText,a(l).windowButtonBgHover,h.value==="actual"?"bg-blue-500/20":""],"p-1.5 rounded transition-colors"]),title:"Actual Size (1:1)"},[c(a(f),{icon:a(he),class:"w-4 h-4"},null,8,["icon"])],2),t[0]||(t[0]=n("div",{class:"flex-1"},null,-1)),v.value?(_(),y("div",{key:0,class:s(["text-xs opacity-60",a(l).windowText])},C(v.value.width)+" × "+C(v.value.height)+" · "+C(xe(v.value.size)),3)):Ve("",!0)],2),n("div",{ref_key:"containerRef",ref:V,class:s(["flex-1 overflow-hidden relative",a(l).imageViewerBg]),onWheel:De(_e,["prevent"]),onMousedown:Te,onTouchstart:Me,onTouchmove:Ie,onTouchend:le,onTouchcancel:le},[T.value?(_(),y("div",Oe,[n("div",Ge,[c(a(f),{icon:a(Xe),class:s(["w-8 h-8 animate-spin",a(l).windowTextMuted])},null,8,["icon","class"]),n("span",{class:s(["text-sm",a(l).windowTextMuted])},"Loading image...",2)])])):b.value?(_(),y("div",Ke,[n("div",qe,[n("div",Je,[c(a(f),{icon:a(Fe),class:"w-8 h-8 text-red-500"},null,8,["icon"])]),n("h3",{class:s(["text-lg font-medium",a(l).windowText])},"Cannot Display Image",2),n("p",{class:s(["text-sm max-w-xs",a(l).windowTextMuted])},C(b.value),3)])])):p.value?(_(),y("div",{key:3,class:"absolute inset-0 flex items-center justify-center",style:de({cursor:M.value?"grabbing":"grab"})},[n("img",{ref_key:"imageRef",ref:x,src:p.value,alt:E.value,class:"max-w-none select-none",style:de({transform:`translate(${g.value}px, ${w.value}px) scale(${r.value})`,transformOrigin:"center center",transition:M.value?"none":"transform 0.15s ease-out"}),onLoad:be,onError:ye,draggable:"false"},null,44,tt)],4)):(_(),y("div",Qe,[n("div",et,[n("div",{class:s(["w-16 h-16 rounded-2xl flex items-center justify-center",a(l).imageViewerBg])},[c(a(f),{icon:a(ve),class:s(["w-8 h-8",a(l).windowTextMuted])},null,8,["icon","class"])],2),n("h3",{class:s(["text-lg font-medium",a(l).windowText])},"No Image",2),n("p",{class:s(["text-sm max-w-xs",a(l).windowTextMuted])},"Open an image file to view it here.",2)])]))],34),c(Ye,{icon:a(Re),message:E.value||"No image",info:B.value?B.value.toUpperCase():""},He({help:fe(()=>[n("div",nt,[n("div",ot,[c(a(f),{icon:a(ve),class:s(["w-5 h-5",a(l).statusBarIcon])},null,8,["icon","class"]),n("h4",{class:s(["text-base font-semibold",a(l).statusBarText])},"Image Viewer",2)]),n("div",{class:s(["text-[10px] md:text-xs space-y-2.5 leading-relaxed",a(l).statusBarInfo])},[t[5]||(t[5]=n("p",null,"A secure image viewer with magic bytes validation.",-1)),n("div",it,[n("div",lt,[c(a(f),{icon:a(pe),class:"w-3.5 h-3.5 mt-0.5 text-green-500 flex-shrink-0"},null,8,["icon"]),t[2]||(t[2]=n("p",null,[n("strong",null,"Verified:"),Y(" Images are validated against their magic bytes to prevent spoofed files.")],-1))]),n("div",st,[c(a(f),{icon:a(me),class:"w-3.5 h-3.5 mt-0.5 text-blue-500 flex-shrink-0"},null,8,["icon"]),t[3]||(t[3]=n("p",null,[n("strong",null,"Zoom:"),Y(" Use +/- keys or mouse wheel to zoom. Press F to fit to window.")],-1))]),n("div",ut,[c(a(f),{icon:a(he),class:"w-3.5 h-3.5 mt-0.5 text-purple-500 flex-shrink-0"},null,8,["icon"]),t[4]||(t[4]=n("p",null,[n("strong",null,"Pan:"),Y(" Click and drag to pan around zoomed images.")],-1))])])],2)])]),_:2},[k.value?{name:"extra",fn:fe(()=>[n("div",at,[c(a(f),{icon:a(pe),class:"w-3.5 h-3.5"},null,8,["icon"]),t[1]||(t[1]=n("span",null,"Verified",-1))])]),key:"0"}:void 0]),1032,["icon","message","info"])]))}}),Ct=Ue(rt,[["__scopeId","data-v-e6d2b3ec"]]);export{Ct as default};
