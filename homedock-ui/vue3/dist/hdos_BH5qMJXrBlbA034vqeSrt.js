import{M as Xo,bQ as Yo,aU as v,q as z,as as te,bE as kt,aD as Ao,aI as Ho,u as p,aL as d,I as m,v as l,bJ as F,t as g,au as c,bk as a,bT as jo,g as et,s as V,bU as y,bb as b,H as R,ak as Oo,aw as oe,h as _t,F as L,aX as ge,bO as Ue,bR as qo}from"./hdos_BmqLjGp9pD_x_NB4upKEB.js";import{a as $,d as ae}from"./hdos_BbS_vWe5DNlDDYAPlKxdN.js";import{g as Vo,S as Go,s as Wo,k as No,l as se,m as Be,n as no,o as ne,t as ye,C as Qo,A as tt,T as Ko,y as M,B as Tt,D as ot,z as lo,x as St,w as ro,v as xe,E as Ft,F as Jo}from"./hdos_TAoCV3MV09JGZrSceMlkI.js";import{u as ea}from"./hdos_BruOM-EsGencX_0CIOn22.js";import{u as ta,d as Dt,a as oa,b as aa,c as sa,e as na,f as la,S as ra,g as ia}from"./hdos_DgEY98OfZ92zueEqeZynU.js";import{d as ca}from"./hdos_D7NRCijMj_Q9fS__axrEk.js";import{d as ua}from"./hdos_BX8oNELbZ9gHTfM-9pR1a.js";import{d as Mt}from"./hdos_DPhlMBAcwmj4N6C-RIU0v.js";import{d as we,a as da}from"./hdos_CvPrm34SGjwAav8ECB8VW.js";import{d as Ct}from"./hdos_CS7Pix6yyXf4PLMilHEK5.js";import{_ as pa}from"./hdos_CAFSXUB9ejWuPT9PfRgwK.js";import{l as x}from"./hdos_D44-qjTiwUddp5Oy6nAd3.js";import{a as zt,S as ma}from"./hdos_nEiH1KAJyvQ0-p9G03o80.js";import"./hdos_DF46ymXzO4uwxmDSAe6gf.js";import{b as va,I as io}from"./hdos_DEccDvFFPfF_WAEMr3xFz.js";import{A as fa}from"./hdos_C56hPeskeGK9eFGBq89e1.js";import{$ as ha}from"./hdos_BsaJBtI1N-WeUcSk3jJyl.js";import{P as $t,U as ga}from"./hdos_DGn-1hRvwwN21IC3LJIQ3.js";import"./hdos_Dz3aTMQqM4LnOlKzV3COc.js";import"./hdos_itWSuQ2oYLgMGq-Z_V6WL.js";import"./hdos_DCQvziD-0BGtLQC-jPv6N.js";import"./hdos_CJoaCRc7PMIr83ndc1bSY.js";import"./hdos_DIn7j5yNZ-jo19dGvRebC.js";import"./hdos_Cuccj8xUVyEDTvA_fcq1n.js";import"./hdos_BIGJWr_bpeXTKglK2UXub.js";import"./hdos_DG8c-fE8MmEkU_Tt58C8V.js";import"./hdos_D63Tfrq7hZ9D-jbqbBA6V.js";import"./hdos_4kSeDeykJxDNm69X1d3vo.js";import"./hdos_Pj1gt1xWrDqJMDlNHOv0C.js";import"./hdos_d3RpjDleDDtyEEtdMU5VZ.js";import"./hdos_CVlC1q8VixWAeFa88SdlV.js";import"./hdos_BFFMvorPffEppRIR3Lrt-.js";import"./hdos_oIjEx523yCJ4FOOvJZIdT.js";const It={width:24,height:24,body:'<path fill="currentColor" d="M16 8c1.1 0 2 .9 2 2v10c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V10c0-1.1.9-2 2-2h9V6c0-1.7-1.3-3-3-3S7 4.3 7 6H5c0-2.8 2.2-5 5-5s5 2.2 5 5v2h1m-6 9c1.1 0 2-.9 2-2s-.9-2-2-2s-2 .9-2 2s.9 2 2 2m12-4h-2V7h2v6m0 4h-2v-2h2v2Z"/>'},ya={key:0,class:"absolute inset-0 z-[9999] pointer-events-none backdrop-blur-sm"},xa={class:"flex items-center align-center justify-center flex-col h-full"},wa={class:"ant-upload-drag-icon"},ba={class:"flex-1 flex flex-col overflow-auto px-4 pt-2 pb-5"},ka={class:"mt-2 flex flex-col flex-1 gap-2"},_a={class:"dropzone-controls-container flex flex-col gap-2 items-start justify-between flex-shrink-0"},Ta={class:"dropzone-search-wrapper flex-1 min-w-0 w-full"},Sa={class:"flex items-center gap-2"},Fa={class:"truncate"},Da={class:"dropzone-actions-wrapper flex items-center gap-2 mt-0.5 w-full"},Ma=["title"],Ca=["title"],za={class:"flex items-center justify-start text-[10px] gap-2 flex-shrink-0"},$a={key:0,class:"ml-0.5"},Ia={key:0,class:"flex justify-center items-center text-balance px-2 py-8"},Za={class:"text-[10px] font-semibold truncate"},Ea={class:"text-[9px] opacity-60 ml-auto"},Pa=["data-filename","onClick","onDblclick","onContextmenu","onTouchstart","onTouchend","onTouchcancel"],Ra={key:1,class:"absolute -left-1 -bottom-1 flex items-center gap-0.5 z-10"},Ua={key:0,class:"w-1.5 h-1.5 bg-green-500 rounded-full ring-1 ring-black/30"},Ba={key:2,class:"absolute -right-1 -top-1 flex items-center gap-0.5"},La={key:3,class:"absolute -right-1 -top-1 z-20"},Xa={key:4,class:"absolute inset-0 flex items-center justify-center z-10"},Ya=["title"],Aa={key:0,class:"absolute -bottom-1 left-2 right-2"},Ha={class:"text-[10px] font-semibold truncate"},ja={class:"text-[9px] opacity-60 ml-auto"},Oa=["data-filename","onClick","onDblclick","onContextmenu","onTouchstart","onTouchend","onTouchcancel"],qa={class:"relative flex-shrink-0 z-[1]"},Va={class:c(["relative w-6 h-6 flex items-center justify-center"])},Ga={key:0,class:"absolute -left-1 -top-1 w-1.5 h-1.5 bg-green-500 rounded-full z-10 ring-1 ring-black/30"},Wa={key:1,class:"absolute inset-0 flex items-center justify-center"},Na={key:2,class:"absolute -right-1.5 -top-1"},Qa={key:3,class:"absolute -right-1 -bottom-1"},Ka={class:"flex-1 overflow-hidden z-[1]"},Ja=["title"],es=["data-filename","onClick","onDblclick","onContextmenu","onTouchstart","onTouchend","onTouchcancel"],ts={class:"relative flex-shrink-0 z-[1]"},os={class:c(["relative w-6 h-6 flex items-center justify-center"])},as={key:0,class:"absolute -left-1 -top-1 w-1.5 h-1.5 bg-green-500 rounded-full z-10 ring-1 ring-black/30"},ss={key:1,class:"absolute inset-0 flex items-center justify-center"},ns={key:2,class:"absolute -right-1.5 -top-1"},ls={key:3,class:"absolute -right-1 -bottom-1"},rs={class:"flex-1 overflow-hidden z-[1]"},is=["title"],cs={class:"mb-1"},us={class:"mb-1"},ds={class:"space-y-3"},ps={class:"text-sm font-bold flex items-center gap-2"},ms={class:"text-xs space-y-1.5 ml-4 list-disc"},vs={class:"flex items-center gap-2 flex-1 min-w-0"},fs={class:"flex mt-1.5 items-center flex-1 max-w-xs"},hs={class:"max-h-60 overflow-y-auto py-1"},gs={class:"px-3 py-1.5"},ys={class:"flex items-center gap-1.5"},xs={class:"flex-1 min-w-0"},ws={class:"flex items-center gap-1.5 mb-0.5"},bs=["title"],ks={class:"px-3 py-1.5 opacity-40"},_s={class:"flex items-center gap-1.5"},Ts={class:"flex items-center gap-1.5 flex-1 min-w-0"},Ss=["title"],Fs={class:"px-3 py-1 text-center"},Ds={class:"space-y-2.5 max-w-sm"},Ms={class:"flex items-center gap-2"},Cs=3,zs=20,$s=110,Zt=125,Et=300,Pt=30,co=500,uo=10,Is=Xo({__name:"AppDropzone",setup(Zs){const Y=Vo(),{themeClasses:r}=Yo(),D=Go(),Rt=ea(),I=v([]),T=v(""),_=v(""),Le=v([]),Xe=v(!1);let Ye=0;const Ut=ta(),{sortBy:Ae,sortDirection:be,viewMode:N}=Wo(Ut),ke=v([]),He=v(0),le=v(0),_e=v(0),Te=v(!1),re=v(""),Se=v(!1),je=v(null),ie=v(""),Q=v(!1),at=v(""),st=v(""),ce=v(null),Fe=v(!1),G=v(null),S=v(null),h=v(new Set),A=v(!1),w=v({startX:0,startY:0,currentX:0,currentY:0}),K=v(null);let nt=!1;const W=v(null),ue=v({}),de=v({}),C=v({}),Z=v(new Set),De=v(!1),Bt=v(""),Oe=v(!1),lt=v(0),Lt=v(0),Me=v(!1),rt=v(!1),Xt=v(0),Yt=v(0),U=v(null);let H=0,j=0,O=0,J=null,At=0,Ht=0,qe=null,Ce=!1,Ve=!1,q=null,jt=0,Ot=0,Ge=!1,it=null,ee=null,ct=!1,ze=!1;const po={folder:ne,txt:Ft,md:Ft,pdf:Ft,png:xe,jpg:xe,jpeg:xe,gif:xe,psd:xe,webp:xe,mp4:ro,mkv:ro,mp3:St,wav:St,flac:St,zip:se,rar:se,doc:lo,docx:lo,pptx:ot,ppt:ot,ppsx:ot,pps:ot,xlsx:Tt,xls:Tt,csv:Tt,exe:M,app:M,sh:M,js:M,ts:M,py:M,c:M,cpp:M,h:M,hpp:M,cs:M,java:M,php:M,html:M,css:M,json:M,xml:M,sql:M,rs:M},$e=z(()=>I.value),mo=z(()=>_.value&&_.value.trim().length>=2?[]:[...I.value].sort((o,e)=>o.is_directory&&!e.is_directory?-1:!o.is_directory&&e.is_directory?1:(o.display_name||o.name).localeCompare(e.display_name||e.name)).map(o=>({value:o.display_name||o.name,label:o.display_name||o.name,isDirectory:o.is_directory,fileName:o.name}))),ut=z(()=>{const t=[...$e.value].sort((o,e)=>{if(o.is_directory&&!e.is_directory)return-1;if(!o.is_directory&&e.is_directory)return 1;let s=0;switch(Ae.value){case"name":s=o.name.localeCompare(e.name);break;case"size":s=o.size-e.size;break;case"date":if(!o.modified&&!e.modified)s=0;else if(!o.modified)s=1;else if(!e.modified)s=-1;else{const n=typeof o.modified=="number"?o.modified:new Date(o.modified).getTime()/1e3,i=typeof e.modified=="number"?e.modified:new Date(e.modified).getTime()/1e3;s=n-i}break}return be.value==="asc"?s:-s});return T.value?[{name:"..",display_name:"..",size:0,modified:0,is_directory:!0},...t]:t}),vo=z(()=>{if(le.value===0)return 0;let t=_e.value*100;return D.currentlyUploading.forEach(o=>{const e=D.uploadProgress[o.uid]||0;t+=e}),Math.round(t/le.value)}),dt=z(()=>{if(!_.value||_.value.trim().length<2)return[];const t=new Map;return ut.value.forEach(o=>{const e=o.name.includes("/")?o.name.substring(0,o.name.lastIndexOf("/")):"";t.has(e)||t.set(e,[]),t.get(e).push(o)}),Array.from(t.entries()).map(([o,e])=>({folder:o,files:e})).sort((o,e)=>o.folder===""&&e.folder!==""?-1:o.folder!==""&&e.folder===""?1:o.folder.localeCompare(e.folder))}),pe=z(()=>_.value&&_.value.trim().length>=2),pt=z(()=>{const t=lt.value||window.innerWidth-100,o=Math.max(1,Math.floor(t/$s)),s=(t-16)/o;if(pe.value){const n=[];let i=8;return dt.value.forEach(u=>{n.push({name:`__header__${u.folder}`,display_name:u.folder===""?"Homepath":u.folder,size:0,modified:0,is_directory:!0,x:8,y:i,gridRow:0,gridCol:0,isHeader:!0,headerText:u.folder===""?"Homepath":u.folder}),i+=32,u.files.forEach((k,B)=>{const E=B%o,X=Math.floor(B/o),Pe=8+E*s+(s-100)/2,Re=i+X*Zt;n.push({...k,x:Pe,y:Re,gridRow:X,gridCol:E})});const f=Math.ceil(u.files.length/o);i+=f*Zt+16}),n}return ut.value.map((n,i)=>{const u=i%o,f=Math.floor(i/o),k=8+u*s+(s-100)/2,B=8+f*Zt;return{...n,x:k,y:B,gridRow:f,gridCol:u}})}),fo=z(()=>{if(pt.value.length===0)return 300;const s=Math.max(...pt.value.map(n=>n.y))+130+16;return Math.max(s,300)}),We=z(()=>ve(I.value.reduce((t,o)=>t+o.size,0))),ho=z(()=>{if(S.value&&h.value.size===0){const t=I.value.find(o=>o.name===S.value);return ve(t?t.size:0)}if(h.value.size>0){const o=I.value.filter(e=>h.value.has(e.name)).reduce((e,s)=>e+s.size,0);return ve(o)}return We.value}),go=z(()=>S.value||h.value.size>0?`${ho.value} selected`:`${We.value} total`),yo=z(()=>window.innerWidth<768),xo=z(()=>{if(_.value&&_.value.trim().length>=2)return`Searching all folders for "${_.value}"`;if(!T.value)return`${I.value.length} ${I.value.length===1?"item":"items"} available`;const t=T.value.split("/").filter(e=>e),o=t[t.length-1]||"";if(yo.value){const e=t.length;return`${"../".repeat(Math.max(0,e-1))}${o}`}return t.join(" / ")}),qt=z(()=>{const t=Math.min(w.value.startX,w.value.currentX),o=Math.min(w.value.startY,w.value.currentY),e=Math.abs(w.value.currentX-w.value.startX),s=Math.abs(w.value.currentY-w.value.startY);return{left:`${t}px`,top:`${o}px`,width:`${e}px`,height:`${s}px`}}),wo=z(()=>{const t=[],o=h.value.size;if(o>1){const e=Array.from(h.value).map(u=>I.value.find(f=>f.name===u)).filter(u=>u!==void 0),s=e.some(u=>u.is_directory),n=e.filter(u=>!u.is_directory),i=o>3||s;return t.push({label:`Selected: ${o} items`,icon:No,disabled:!0},{divider:!0}),i?t.push({label:"Download as ZIP",icon:se,action:async()=>{const u=e.map(f=>f.name);Ee(),await To(u)}}):n.length>0&&t.push({label:"Download All",icon:Dt,action:async()=>{for(const u of n)await ft(u.name);Ee()}}),t.push({label:"Delete All",icon:Ct,action:()=>{at.value=`Delete ${o} items?`,st.value=`Are you sure you want to delete ${o} selected items? This action cannot be undone.`,ce.value=null,Q.value=!0,Ee()}},{divider:!0},{label:"New Folder",icon:Be,action:()=>Je()},{label:"Refresh",icon:no,action:()=>P(T.value)}),t}return U.value?U.value.is_directory?(t.push({label:"Open",icon:ne,action:()=>{const e=U.value.name;Ee(),pe.value?(ze=!0,_.value="",te(()=>{Ke(e),ze=!1})):Ke(e)}}),t.push({label:"Download as ZIP",icon:Dt,action:()=>So(U.value.name)}),t.push({divider:!0}),pe.value?t.push({label:"Rename Folder",icon:we,disabled:!0,action:()=>{}}):t.push({label:"Rename Folder",icon:we,action:()=>oo(U.value)}),t.push({label:"Delete Folder",icon:Ct,action:()=>ao(U.value)},{divider:!0},{label:"New Folder",icon:Be,action:()=>Je()})):(t.push({label:"Download",icon:Dt,action:()=>ft(U.value.name)},{divider:!0}),pe.value?t.push({label:"Rename File",icon:we,disabled:!0,action:()=>{}}):t.push({label:"Rename File",icon:we,action:()=>oo(U.value)}),t.push({label:"Delete File",icon:Ct,action:()=>ao(U.value)},{divider:!0},{label:"New Folder",icon:Be,action:()=>Je()})):(t.push({label:"New Folder",icon:Be,action:()=>Je()}),t.push({label:"Refresh",icon:no,action:()=>P(T.value)})),t});kt(_,t=>{if(it&&clearTimeout(it),!t||t.trim().length===0){ze||P(T.value);return}t.trim().length>=2&&(it=setTimeout(()=>{P("",!0)},300))}),kt(N,()=>{te(()=>{wt(),so()})}),kt(()=>D.totalUploading,(t,o)=>{if(o!==void 0&&t<o){const e=o-t;_e.value+=e}le.value=_e.value+t,t===0&&le.value>0&&setTimeout(()=>{le.value=0,_e.value=0,Me.value=!1},3e3)},{immediate:!0});const mt=t=>t.startsWith("."),vt=t=>{if(!t.modified)return!1;const o=new Date,e=typeof t.modified=="number"?new Date(t.modified*1e3):new Date(t.modified);return(o.getTime()-e.getTime())/(1e3*60*60)<1},me=t=>{if(!t.modified)return"";const o=new Date,e=typeof t.modified=="number"?new Date(t.modified*1e3):new Date(t.modified),s=Math.floor((o.getTime()-e.getTime())/1e3);if(s<60)return`${s}s ago`;const n=Math.floor(s/60);if(n<60)return`${n}m ago`;const i=Math.floor(n/60);if(i<24)return`${i}h ago`;const u=Math.floor(i/24);if(u<30)return`${u}d ago`;const f=Math.floor(u/30);return f<12?`${f}mo ago`:`${Math.floor(f/12)}y ago`},Vt=async(t,o="")=>{const e=[];return new Promise((s,n)=>{const i=t.createReader(),u=()=>{i.readEntries(async f=>{if(f.length===0){s(e);return}for(const k of f){if(mt(k.name))continue;const B=o?`${o}/${k.name}`:k.name;if(k.isFile){const E=k,X=await new Promise((Pe,Re)=>{E.file(Pe,Re)});e.push({file:X,relativePath:o})}else if(k.isDirectory){const X=await Vt(k,B);e.push(...X)}}u()},f=>{n(f)})};u()})},bo=t=>{const o=new Set;return t.forEach(({relativePath:s})=>{if(s){const n=s.split("/");let i="";for(const u of n)i=i?`${i}/${u}`:u,o.add(i)}}),Array.from(o).sort((s,n)=>{const i=s.split("/").length,u=n.split("/").length;return i!==u?i-u:s.localeCompare(n)})};function ve(t){const o=typeof t=="number"?t:parseFloat(t);if(o===0)return"0 B";const e=1024,s=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(o)/Math.log(e));return Math.round(o/Math.pow(e,n)*100)/100+" "+s[n]}function ko(t){const o=typeof t=="number"?t:parseFloat(t);if(o===0)return"0B";const e=1024,s=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(o)/Math.log(e)),i=o/Math.pow(e,n);return(i>=100?Math.round(i).toString():i.toFixed(1))+s[n]}const Ne=t=>{if(t.is_directory)return t.name===".."?ia:ne;const o=t.name.split(".").pop()?.toLowerCase();return po[o||"unknown"]||Jo},Ie=(t,o=0)=>{Bt.value=t,Oe.value=!0,o>0&&setTimeout(()=>{Oe.value=!1},o)},Qe=()=>{Oe.value=!1},P=async(t="",o=!1)=>{try{if(_.value.trim()&&_.value.length>=2||o){De.value=!0;const n=setTimeout(()=>{De.value&&Ie("Searching files...")},200),i=await $.get("/api/search_files",{headers:{"X-HomeDock-CSRF-Token":Y.value},params:{query:_.value.trim()}});clearTimeout(n),I.value=i.data.files||[],T.value="",Rt.setFiles(I.value),De.value=!1,Qe();return}const e=t?{path:t}:{},s=await $.get("/api/get_files",{headers:{"X-HomeDock-CSRF-Token":Y.value},params:e});I.value=s.data.files||[],T.value=s.data.current_path||"",Rt.setFiles(I.value)}catch(e){De.value=!1,Qe(),$.isAxiosError(e)?x.error(e.response?.data?.error_message||"Failed to fetch files. Please try again."):x.error("Failed to fetch files. Please try again.")}},_o=async(t,o,e)=>{const s=new FormData;s.append("file",t),e&&s.append("path",e);try{const n=await $.post("/api/upload_file",s,{headers:{"X-HomeDock-CSRF-Token":Y.value},onUploadProgress:i=>{if(i.total){const u=Math.round(i.loaded/i.total*100),f=t;D.updateProgress(f.uid,u),o&&o({percent:u})}}});n.data.success||x.error(n.data.error.value||"Upload failed")}catch(n){throw $.isAxiosError(n)?n.response?.status===413?x.error("The selected file is larger than 1GB."):x.error(n.response?.data?.error_message||`Unexpected error occurred: ${n.message}`):x.error("An unknown error occurred. Please try again."),n}},ft=async t=>{if(C.value[t]!==void 0&&C.value[t]<100&&C.value[t]>0){x.info(`Download for ${t} is already in progress.`);return}try{ue.value[t]=!0,de.value[t]=!0,C.value[t]=0;const o=await $.get(`/api/download_file?file=${encodeURIComponent(t)}`,{headers:{"X-HomeDock-CSRF-Token":Y.value},responseType:"blob",onDownloadProgress:i=>{if(i.total){const u=Math.round(i.loaded*100/i.total);C.value[t]=u}}}),e=window.URL.createObjectURL(new Blob([o.data])),s=document.createElement("a");s.href=e;const n=t.split("/").pop()||t;s.setAttribute("download",n),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(e),setTimeout(()=>{ue.value[t]=!1,de.value[t]=!1},1e3)}catch(o){$.isAxiosError(o)?x.error(o.response?.data?.error_message||"Failed to download file. Please try again."):x.error("Failed to download file. Please try again."),delete C.value[t],de.value[t]=!1,ue.value[t]=!1}},To=async t=>{if(t.length!==0)try{t.forEach(u=>{I.value.find(k=>k.name===u)?.is_directory&&Z.value.add(u)});const o=await $.post("/api/download_multiple",{files:t},{headers:{"X-HomeDock-CSRF-Token":Y.value},responseType:"blob"}),e=o.headers["content-disposition"];let s="download.zip";if(e){const u=e.match(/filename="?([^";\n]+)"?/);u&&(s=u[1].replace(/[<>:"/\\|?*]/g,"_"))}const n=window.URL.createObjectURL(new Blob([o.data])),i=document.createElement("a");i.href=n,i.setAttribute("download",s),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(n),x.success(`Downloaded ${t.length} items as ZIP`)}catch{x.error("Failed to download files as ZIP")}finally{t.forEach(o=>{Z.value.delete(o)})}},So=async t=>{try{Z.value.add(t);const o=await $.post("/api/download_multiple",{files:[t]},{headers:{"X-HomeDock-CSRF-Token":Y.value},responseType:"blob"}),e=window.URL.createObjectURL(new Blob([o.data])),s=document.createElement("a");s.href=e;const n=t.split("/").pop()||t;s.setAttribute("download",`${n}.zip`),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(e)}catch{x.error("Failed to download folder as ZIP")}finally{Z.value.delete(t)}},Gt=async(t,o=!1)=>{try{const e=await $.post("/api/delete_file",{file:t},{headers:{"X-HomeDock-CSRF-Token":Y.value}});return e.data.success?(o||x.success(e.data.message),{success:!0}):(o||x.error(e.data.error||"Failed to delete file"),{success:!1,error:e.data.error})}catch(e){return o||($.isAxiosError(e)?x.error(e.response?.data?.error_message||"Failed to delete file. Please try again."):x.error("Failed to delete file. Please try again.")),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}},ht=async()=>{if(!ct){ct=!0;try{for(;He.value<Cs&&ke.value.length>0;){const t=ke.value.shift();if(!t)break;He.value++,D.startUpload({uid:t.file.uid,name:t.file.name,size:t.file.size}),(async()=>{try{await _o(t.file,t.onProgress,t.path),Le.value=Le.value.filter(o=>o.uid!==t.file.uid),D.completeUpload(t.file.uid),t.onSuccess&&t.onSuccess(null,t.file)}catch(o){D.cancelUpload(t.file.uid),t.onError&&t.onError(o)}finally{He.value--,ht()}})()}}finally{ct=!1}He.value===0&&ke.value.length===0&&await P(T.value)}},Fo=async({file:t,onSuccess:o,onError:e,onProgress:s})=>{const n=t;D.addToQueue({uid:n.uid,name:n.name,size:n.size}),ke.value.push({file:n,onProgress:s,onSuccess:o,onError:e,path:T.value}),ht()},Wt=async t=>{Ie(`Enqueueing ${t.length} ${t.length===1?"file":"files"} for upload...`),await te(),await new Promise(s=>setTimeout(s,50));const o=Date.now(),e=20;for(let s=0;s<t.length;s+=e){const n=t.slice(s,s+e);for(let i=0;i<n.length;i++){const{file:u,relativePath:f}=n[i],k=s+i,B=`${o}-${k}-${Math.random().toString(36).substring(2,11)}-${u.name}`,E=u;E.uid=B;const X=f?T.value?`${T.value}/${f}`:f:T.value;D.addToQueue({uid:E.uid,name:E.name,size:E.size}),ke.value.push({file:E,path:X,onProgress:void 0,onSuccess:void 0,onError:void 0})}s+e<t.length&&await new Promise(i=>setTimeout(i,0))}Ie("Starting upload...",2e3),await te(),ht()},Nt=async()=>{if(!re.value.trim()){x.error("Folder name cannot be empty");return}try{const t=await $.post("/api/create_folder",{name:re.value.trim(),path:T.value},{headers:{"X-HomeDock-CSRF-Token":Y.value}});t.data.success?(x.success(t.data.message),Te.value=!1,re.value="",await P(T.value)):x.error(t.data.error||"Failed to create folder")}catch(t){$.isAxiosError(t)?x.error(t.response?.data?.error||"Failed to create folder. Please try again."):x.error("Failed to create folder. Please try again.")}},Qt=async()=>{if(!je.value||!ie.value.trim()){x.error("New name cannot be empty");return}try{const t=await $.post("/api/rename_item",{old_name:je.value.name,new_name:ie.value.trim()},{headers:{"X-HomeDock-CSRF-Token":Y.value}});t.data.success?(x.success(t.data.message),Se.value=!1,je.value=null,ie.value="",await P(T.value)):x.error(t.data.error||"Failed to rename item")}catch(t){$.isAxiosError(t)?x.error(t.response?.data?.error||"Failed to rename item. Please try again."):x.error("Failed to rename item. Please try again.")}},Ke=t=>{P(t)},Kt=()=>{if(!T.value)return;const t=T.value.split("/").filter(e=>e);t.pop();const o=t.join("/");P(o)},Do=t=>{t.preventDefault(),Ye++,t.dataTransfer?.types.includes("Files")&&(Xe.value=!0)},Mo=t=>{t.preventDefault(),Ye--,Ye===0&&(Xe.value=!1)},Co=async t=>{if(t.preventDefault(),t.stopPropagation(),Ye=0,Xe.value=!1,!t.dataTransfer)return;Ie("Scanning dropped items...");const o=[];if(t.dataTransfer.items&&t.dataTransfer.items.length>0){const s=[];for(let n=0;n<t.dataTransfer.items.length;n++){const i=t.dataTransfer.items[n];if(i.kind==="file"){const u=i.webkitGetAsEntry();u&&!mt(u.name)&&s.push(u)}}for(const n of s)if(n.isFile){const i=n,u=await new Promise((f,k)=>{i.file(f,k)});o.push({file:u,relativePath:""})}else if(n.isDirectory){Ie("Processing folders structure...");const i=n,u=await Vt(i,i.name);o.push(...u)}}else for(let s=0;s<t.dataTransfer.files.length;s++){const n=t.dataTransfer.files[s];mt(n.name)||o.push({file:n,relativePath:""})}if(o.length===0){Qe();return}const e=bo(o);if(e.length>0){G.value={allFiles:o,folders:e},Fe.value=!0,Qe();return}await Wt(o)},zo=t=>{t.file.status==="done"?x.success(`${t.file.name} uploaded successfully`):t.file.status==="error"&&x.error(`${t.file.name} upload failed.`)},gt=(t,o)=>{const e=o;if(!e||nt)return;const s="touches"in e;if(t.name===".."){if(s){const i=e.changedTouches?.[0]||e.touches?.[0];if(i){const u=Date.now(),f=u-H,k=Math.sqrt(Math.pow(i.clientX-j,2)+Math.pow(i.clientY-O,2));if(f<Et&&k<Pt){Kt(),H=0,j=0,O=0;return}else{H=u,j=i.clientX,O=i.clientY;return}}}return}if(s){const i=e.changedTouches?.[0]||e.touches?.[0];if(i){const u=Date.now(),f=u-H,k=Math.sqrt(Math.pow(i.clientX-j,2)+Math.pow(i.clientY-O,2));if(f<Et&&k<Pt){Ze(t),H=0,j=0,O=0;return}else{h.value.clear(),S.value=t.name,H=u,j=i.clientX,O=i.clientY;return}}}e?.ctrlKey||e?.metaKey?(h.value.has(t.name)?h.value.delete(t.name):h.value.add(t.name),S.value=null):(h.value.clear(),S.value=t.name)},Ze=t=>{if(t.name===".."){Kt();return}t.is_directory?pe.value?(ze=!0,_.value="",te(()=>{Ke(t.name),ze=!1})):Ke(t.name):ft(t.name)},yt=(t,o)=>{const e=o.touches[0];e&&(qe=t,Ce=!1,Ve=!1,At=e.clientX,Ht=e.clientY,t.name!==".."&&(J=setTimeout(()=>{Ve=!0,navigator.vibrate&&navigator.vibrate(50);const s=new MouseEvent("contextmenu",{bubbles:!0,cancelable:!0,clientX:e.clientX,clientY:e.clientY});he(s,t)},co)))},xt=t=>{const o=t.touches[0];if(!o)return;Math.sqrt(Math.pow(o.clientX-At,2)+Math.pow(o.clientY-Ht,2))>uo&&(Ce=!0,J&&(clearTimeout(J),J=null))},fe=(t,o)=>{if(J&&(clearTimeout(J),J=null),Ve){Ve=!1,Ce=!1,qe=null;return}if(!Ce&&qe){const e=Date.now(),s=o.changedTouches[0];if(!s)return;const n=e-H,i=Math.sqrt(Math.pow(s.clientX-j,2)+Math.pow(s.clientY-O,2));n<Et&&i<Pt?(Ze(t),H=0,j=0,O=0):(h.value.clear(),S.value=t.name,H=e,j=s.clientX,O=s.clientY)}Ce=!1,qe=null},$o=t=>{const o=t.target;if(o.closest(".dropzone-file-item")||o.closest(".dropzone-controls-container"))return;const n=t.touches[0];n&&(jt=n.clientX,Ot=n.clientY,Ge=!1,q=setTimeout(()=>{navigator.vibrate&&navigator.vibrate(50);const i=new MouseEvent("contextmenu",{bubbles:!0,cancelable:!0,clientX:n.clientX,clientY:n.clientY});he(i,null),q=null},co))},Io=t=>{if(!q)return;const o=t.touches[0];if(!o)return;Math.sqrt(Math.pow(o.clientX-jt,2)+Math.pow(o.clientY-Ot,2))>uo&&(Ge=!0,q&&(clearTimeout(q),q=null))},Jt=()=>{q&&(clearTimeout(q),q=null),Ge||(S.value=null,h.value.clear()),Ge=!1},Zo=t=>{const o=t.target;if(o.closest(".dropzone-controls-container")||$e.value.length===0||t.button!==0)return;const s=t.currentTarget?.getBoundingClientRect();if(!s)return;const n=t.clientX-s.left,i=t.clientY-s.top;K.value={x:n,y:i},o.closest(".dropzone-file-item")||(A.value=!0,w.value.startX=n,w.value.startY=i,w.value.currentX=n,w.value.currentY=i,S.value=null,h.value.clear()),document.addEventListener("mousemove",eo),document.addEventListener("mouseup",to)},eo=t=>{const e=W.value?.getBoundingClientRect();if(!e)return;let s=t.clientX-e.left,n=t.clientY-e.top;s=Math.max(0,Math.min(s,e.width)),n=Math.max(0,Math.min(n,e.height)),!A.value&&K.value&&Math.sqrt(Math.pow(s-K.value.x,2)+Math.pow(n-K.value.y,2))>zs&&(A.value=!0,w.value.startX=K.value.x,w.value.startY=K.value.y,S.value=null,h.value.clear()),A.value&&(w.value.currentX=s,w.value.currentY=n,Eo())},to=()=>{const t=Math.abs(w.value.currentX-w.value.startX)>5||Math.abs(w.value.currentY-w.value.startY)>5;!t&&A.value&&(S.value=null,h.value.clear()),A.value&&t&&(nt=!0,setTimeout(()=>{nt=!1},50)),A.value=!1,K.value=null,document.removeEventListener("mousemove",eo),document.removeEventListener("mouseup",to)},Eo=()=>{const t=Math.min(w.value.startX,w.value.currentX),o=Math.min(w.value.startY,w.value.currentY),e=Math.abs(w.value.currentX-w.value.startX),s=Math.abs(w.value.currentY-w.value.startY);h.value.clear();const i=W.value?.getBoundingClientRect();i&&document.querySelectorAll(".dropzone-file-item").forEach(u=>{const f=u.getBoundingClientRect(),k=f.left-i.left,B=f.top-i.top,E=k+f.width,X=B+f.height,Pe=t+e,Re=o+s;if(t<E&&Pe>k&&o<X&&Re>B){const bt=u.getAttribute("data-filename");bt&&bt!==".."&&h.value.add(bt)}})},he=(t,o=null)=>{t.preventDefault(),o?.name===".."&&(o=null),o&&!h.value.has(o.name)?(S.value=o.name,h.value.clear()):o||(S.value="",h.value.clear()),U.value=o,Xt.value=t.clientX,Yt.value=t.clientY,rt.value=!0},Ee=()=>{rt.value=!1,U.value=null},Je=()=>{re.value="",Te.value=!0},oo=t=>{je.value=t;const o=t.display_name||t.name.split("/").pop()||t.name;ie.value=o,Se.value=!0},ao=t=>{const o=t.is_directory?"folder":"file",e=t.display_name||t.name.split("/").pop()||t.name;ce.value=t,at.value=`Delete ${o}?`,st.value=`Are you sure you want to delete "${e}"?${t.is_directory?" This will delete all files inside.":""}`,Q.value=!0},Po=async()=>{if(!ce.value&&h.value.size>0){const t=Array.from(h.value);let o=0,e=0;for(const s of t)(await Gt(s,!0)).success?o++:e++;e===0?x.success(`${o} ${o===1?"item":"items"} deleted successfully`):o===0?x.error(`Failed to delete ${e} ${e===1?"item":"items"}`):x.warning(`${o} ${o===1?"item":"items"} deleted, ${e} failed`),h.value.clear(),S.value=null,Q.value=!1,await P(T.value);return}ce.value&&(await Gt(ce.value.name),Q.value=!1,ce.value=null,await P(T.value))},Ro=async()=>{if(!G.value)return;Fe.value=!1;const{allFiles:t}=G.value;G.value=null,await te(),await Wt(t)},Uo=()=>{Fe.value=!1,G.value=null},Bo=()=>{be.value=be.value==="asc"?"desc":"asc"},Lo=()=>{N.value=N.value==="grid"?"list":"grid",te(()=>{wt()})},wt=()=>{W.value&&(lt.value=W.value.clientWidth,Lt.value=W.value.clientHeight)},so=()=>{ee&&ee.disconnect(),W.value&&(ee=new ResizeObserver(t=>{for(const o of t)lt.value=o.contentRect.width,Lt.value=o.contentRect.height}),ee.observe(W.value))};return Ao(()=>{Ut.load(),P(),wt(),so()}),Ho(()=>{ee&&(ee.disconnect(),ee=null)}),(t,o)=>(d(),p("div",{class:"app-dropzone flex flex-col h-full overflow-hidden",onDragenter:Do,onDragleave:Mo,onDragover:o[18]||(o[18]=Ue(()=>{},["prevent"])),onDrop:Ue(Co,["prevent","stop"])},[m(et,{name:"dragger-fade"},{default:F(()=>[Xe.value?(d(),p("div",ya,[l("div",{class:c([[a(r).scopeSelector,a(r).dropZoneDragHolder],"fullscreen-dragger h-full border-2 border-dashed rounded-lg flex items-center justify-center"])},[l("div",xa,[l("p",wa,[m(jo,{icons:[a(ye),a(ua)],iconSize:64,interval:2e3,class:c([[a(r).dropZoneDragIcon],"text-5xl"])},null,8,["icons","class"])]),l("p",{class:c([[a(r).dropZoneDragUpText],"px-4 text-balance text-center text-lg font-semibold mt-4"])},"Drop files or folders to upload and encrypt",2),l("p",{class:c([[a(r).dropZoneDragDownText],"px-4 text-balance text-center text-sm mt-2"])},"Folders will maintain their structure.",2),l("p",{class:c([[a(r).dropZoneDragDownText],"px-4 text-balance text-center text-sm mt-1"])},"Hidden files (.*) are automatically filtered.",2)])],2)])):g("",!0)]),_:1}),l("div",ba,[l("div",ka,[l("div",_a,[l("div",Ta,[m(a(fa),{value:_.value,"onUpdate:value":o[1]||(o[1]=e=>_.value=e),options:mo.value,"popup-class-name":`${a(r).scopeSelector}`,class:"w-full"},{option:F(({label:e,isDirectory:s,fileName:n})=>[l("div",Sa,[m(a(y),{icon:s?a(ne):Ne({name:n,is_directory:!1,size:0,modified:0}),class:c([[a(r).dropZoneFileIcon],"w-4 h-4 flex-shrink-0"])},null,8,["icon","class"]),l("span",Fa,b(e),1)])]),default:F(()=>[m(a(va),{value:_.value,"onUpdate:value":o[0]||(o[0]=e=>_.value=e),placeholder:"Search files...",class:"w-full text-sm","enter-button":"Search"},{prefix:F(()=>[De.value?(d(),V(a(y),{key:0,icon:a(ae),class:c([[a(r).dropZoneInputIcon,"animate-spin"],"mx-1"])},null,8,["icon","class"])):(d(),V(a(y),{key:1,icon:a(ye),class:c([[a(r).dropZoneInputIcon],"mx-1"])},null,8,["icon","class"]))]),_:1},8,["value"])]),_:1},8,["value","options","popup-class-name"])]),l("div",Da,[m(a(ma),{value:a(Ae),"onUpdate:value":o[2]||(o[2]=e=>Oo(Ae)?Ae.value=e:null),class:c([[a(r).scopeSelector,a(r).dropZoneSortSelect],"dropzone-sort-select h-8 flex-1 rounded-md min-w-[140px] transition duration-150"]),"popup-class-name":`${a(r).scopeSelector}`,"show-search":!1},{suffixIcon:F(()=>[m(a(y),{icon:a(oa),class:"w-4 h-4"},null,8,["icon"])]),default:F(()=>[m(a(zt),{value:"name"},{default:F(()=>[...o[19]||(o[19]=[R("Sort by Name",-1)])]),_:1}),m(a(zt),{value:"size"},{default:F(()=>[...o[20]||(o[20]=[R("Sort by Size",-1)])]),_:1}),m(a(zt),{value:"date"},{default:F(()=>[...o[21]||(o[21]=[R("Sort by Date",-1)])]),_:1})]),_:1},8,["value","class","popup-class-name"]),l("button",{onClick:Bo,class:c([[a(r).dropZoneSortButton],"px-2 py-1 border rounded-md transition-colors h-8 flex items-center justify-center flex-shrink-0"]),title:a(be)==="asc"?"Sort Ascending":"Sort Descending"},[m(a(y),{icon:a(be)==="asc"?a(aa):a(sa),class:"w-4 h-4"},null,8,["icon"])],10,Ma),l("button",{onClick:Lo,class:c([[a(r).dropZoneSortButton],"px-2 py-1 border rounded-md transition-colors h-8 flex items-center justify-center flex-shrink-0"]),title:a(N)==="grid"?"Switch to List View":"Switch to Grid View"},[m(a(y),{icon:a(N)==="grid"?a(na):a(la),class:"w-4 h-4"},null,8,["icon"])],10,Ca)])]),l("div",za,[l("span",{class:c([[a(r).dropZoneTotalSizeScope],"rounded-full px-2 py-0.5"])},[R(b($e.value.length)+" "+b($e.value.length===1?"file":"files")+" ",1),_.value&&_.value.trim().length>=2?(d(),p("span",$a,"(global search)")):g("",!0)],2),We.value!=="0 B"&&I.value.length>0?(d(),p("span",{key:0,class:c([[a(r).dropZoneTotalSizeScope],"rounded-full px-2 py-0.5"])},b(We.value)+" total ",3)):g("",!0)]),l("div",{ref_key:"containerRef",ref:W,class:"view-mode-container",onMousedown:Zo,onContextmenu:o[6]||(o[6]=e=>he(e,null)),onTouchstart:$o,onTouchmove:Io,onTouchend:Jt,onTouchcancel:Jt},[$e.value.length===0&&!T.value?(d(),p("div",Ia,[m(a(ha),{class:c([a(r).dropZoneEmptyText]),description:_.value&&_.value.trim().length>=2?"No files found matching your search across all folders":"Drag and drop your files here to store and encrypt them"},null,8,["class","description"])])):g("",!0),m(et,{name:a(N)==="grid"?"view-mode-fade":"list-view-fade",mode:"out-in"},{default:F(()=>[a(N)==="grid"?(d(),p("div",{key:"grid-view",class:"dropzone-icons-container relative w-full select-none",style:oe({height:`${fo.value}px`})},[A.value?(d(),p("div",{key:0,class:"absolute pointer-events-none z-[100] border-2 border-blue-500 bg-blue-500/20",style:oe(qt.value)},null,4)):g("",!0),m(_t,{name:"file-item"},{default:F(()=>[(d(!0),p(L,null,ge(pt.value,e=>(d(),p(L,{key:e.name},[e.isHeader?(d(),p("div",{key:0,class:c([[a(r).dropZoneTotalSizeScope],"flex items-center gap-2 px-3 py-1.5 rounded-md"]),style:oe({position:"absolute",left:`${e.x}px`,top:`${e.y}px`,width:"calc(100% - 16px)"})},[m(a(y),{icon:a(ne),class:c([[a(r).dropZoneFileIcon],"w-4 h-4 flex-shrink-0"])},null,8,["icon","class"]),l("span",Za,b(e.headerText),1),l("span",Ea,b(dt.value.find(s=>(s.folder===""?"Homepath":s.folder)===e.headerText)?.files.length||0)+" items ",1)],6)):(d(),p("div",{key:1,"data-filename":e.name,class:c(["group flex flex-col items-center gap-1 cursor-pointer p-2 rounded-lg","transition-[background,transform,border,box-shadow] duration-[150ms,200ms,0ms,0ms]","w-[100px] h-[120px] z-[1] touch-manipulation select-none outline-none border dropzone-file-item",!(S.value===e.name||h.value.has(e.name))&&["border-transparent","shadow-[0_0_0_1px_transparent]",a(r).desktopIconBg||"hover:bg-white/5"],(S.value===e.name||h.value.has(e.name))&&[a(r).desktopIconBgSelected||"bg-blue-500/20",a(r).desktopIconBorderSelected||"border-blue-500",a(r).desktopIconShadowSelected||"shadow-[0_0_0_1px_rgba(59,130,246,0.5)]"]]),style:oe({position:"absolute",left:`${e.x}px`,top:`${e.y}px`}),onClick:s=>gt(e,s),onDblclick:s=>Ze(e),onContextmenu:Ue(s=>he(s,e),["stop"]),onTouchstart:s=>yt(e,s),onTouchmove:o[3]||(o[3]=s=>xt(s)),onTouchend:s=>fe(e,s),onTouchcancel:s=>fe(e,s)},[l("div",{class:c(["relative w-16 h-16 flex-shrink-0 flex items-center justify-center rounded-2xl",a(r).desktopIconContainerBg||"bg-white/10","transition-transform duration-200",!(S.value===e.name||h.value.has(e.name))&&(a(r).desktopIconContainerBgHover||"hover:bg-white/20"),(S.value===e.name||h.value.has(e.name))&&(a(r).desktopIconContainerBgSelected||"bg-blue-500/30")])},[!e.is_directory&&e.size>0?(d(),p("div",{key:0,class:c([[a(r).dropZoneFileSize],"absolute -left-1 -top-1 text-[8px] font-medium px-1 py-0.5 rounded whitespace-nowrap z-10"])},b(ko(e.size)),3)):g("",!0),me(e)?(d(),p("div",Ra,[vt(e)?(d(),p("div",Ua)):g("",!0),l("div",{class:c([[a(r).dropZoneFileSize],"text-[8px] font-medium px-1 py-0.5 rounded whitespace-nowrap"])},b(me(e)),3)])):g("",!0),e.is_directory?g("",!0):(d(),p("div",Ba,[de.value[e.name]?(d(),V(a(y),{key:0,icon:a(ae),class:c([[a(r).dropZoneLockIcon],"transition duration-300 animate-spin h-3 w-3"])},null,8,["icon","class"])):(d(),V(a(y),{key:1,icon:ue.value[e.name]?a(It):a(Mt),class:c([[a(r).dropZoneLockIcon],"transition duration-300 h-3 w-3"])},null,8,["icon","class"]))])),e.is_directory&&Z.value.has(e.name)?(d(),p("div",La,[m(a(y),{icon:a(se),class:c([[a(r).dropZoneLockIcon],"h-4 w-4"])},null,8,["icon","class"])])):g("",!0),m(a(y),{icon:Ne(e),class:c([[a(r).dropZoneFileIcon,e.is_directory&&Z.value.has(e.name)?"opacity-40":""],"h-10 w-10 transition duration-300 group-hover:scale-110"])},null,8,["icon","class"]),e.is_directory&&Z.value.has(e.name)?(d(),p("div",Xa,[m(a(y),{icon:a(ae),class:c([[a(r).dropZoneLockIcon],"h-7 w-7 animate-spin"])},null,8,["icon","class"])])):g("",!0)],2),l("span",{class:c([[a(r).dropZoneFileText],"text-[11px] leading-tight text-center line-clamp-2 w-full px-1 break-words"]),title:e.display_name||e.name},b(e.name.split("/").pop()),11,Ya),C.value[e.name]!==void 0&&C.value[e.name]<100?(d(),p("div",Aa,[m(a($t),{percent:C.value[e.name],class:c([[a(r).scopeSelector],"h-1 rounded-full"]),"show-info":!1,size:2,status:"active"},null,8,["percent","class"])])):g("",!0)],46,Pa))],64))),128))]),_:1})],4)):(d(),p("div",{key:`list-view-${T.value}`,class:"dropzone-list-container w-full select-none"},[A.value?(d(),p("div",{key:0,class:"absolute pointer-events-none z-[100] border-2 border-blue-500 bg-blue-500/20",style:oe(qt.value)},null,4)):g("",!0),pe.value?(d(!0),p(L,{key:1},ge(dt.value,e=>(d(),p(L,{key:e.folder},[l("div",{class:c([[a(r).dropZoneTotalSizeScope],"flex items-center gap-2 px-2 py-1.5 mt-2 mb-1 rounded-md sticky top-0 z-10"])},[m(a(y),{icon:a(ne),class:c([[a(r).dropZoneFileIcon],"w-4 h-4 flex-shrink-0"])},null,8,["icon","class"]),l("span",Ha,b(e.folder===""?"Homepath":e.folder),1),l("span",ja,b(e.files.length)+" "+b(e.files.length===1?"item":"items"),1)],2),m(_t,{name:"file-item-list"},{default:F(()=>[(d(!0),p(L,null,ge(e.files,s=>(d(),p("div",{key:s.name,"data-filename":s.name,class:c(["group relative flex items-center gap-3 cursor-pointer px-2 py-1.5 rounded transition-colors dropzone-file-item overflow-hidden ml-4",!(S.value===s.name||h.value.has(s.name))&&[a(r).desktopIconBg||"hover:bg-white/5"],(S.value===s.name||h.value.has(s.name))&&[a(r).desktopIconBgSelected||"bg-blue-500/20"]]),onClick:n=>gt(s,n),onDblclick:n=>Ze(s),onContextmenu:Ue(n=>he(n,s),["stop"]),onTouchstart:n=>yt(s,n),onTouchmove:o[4]||(o[4]=n=>xt(n)),onTouchend:n=>fe(s,n),onTouchcancel:n=>fe(s,n)},[C.value[s.name]!==void 0&&C.value[s.name]<100?(d(),p("div",{key:0,class:"absolute inset-0 bg-blue-500/20 transition-all duration-300 ease-out",style:oe({width:`${C.value[s.name]}%`})},null,4)):g("",!0),l("div",qa,[l("div",Va,[vt(s)?(d(),p("div",Ga)):g("",!0),m(a(y),{icon:Ne(s),class:c([[a(r).dropZoneFileIcon,s.is_directory&&Z.value.has(s.name)?"opacity-40":""],"h-5 w-5"])},null,8,["icon","class"]),s.is_directory&&Z.value.has(s.name)?(d(),p("div",Wa,[m(a(y),{icon:a(ae),class:c([[a(r).dropZoneLockIcon],"h-4 w-4 animate-spin"])},null,8,["icon","class"])])):g("",!0),s.is_directory&&Z.value.has(s.name)?(d(),p("div",Na,[m(a(y),{icon:a(se),class:c([[a(r).dropZoneLockIcon],"h-3 w-3"])},null,8,["icon","class"])])):g("",!0),s.is_directory?g("",!0):(d(),p("div",Qa,[de.value[s.name]?(d(),V(a(y),{key:0,icon:a(ae),class:c([[a(r).dropZoneLockIcon],"animate-spin h-2 w-2"])},null,8,["icon","class"])):(d(),V(a(y),{key:1,icon:ue.value[s.name]?a(It):a(Mt),class:c([[a(r).dropZoneLockIcon],"h-2 w-2"])},null,8,["icon","class"]))]))])]),l("div",Ka,[l("span",{class:c([[a(r).dropZoneFileText],"text-xs truncate block"]),title:s.name},b(s.name.split("/").pop()),11,Ja)]),s.is_directory?g("",!0):(d(),p("div",{key:1,class:c([[a(r).dropZoneFileSize],"list-view-size text-[10px] font-medium px-1.5 py-0.5 rounded whitespace-nowrap flex-shrink-0 z-[1]"])},b(ve(s.size)),3)),me(s)?(d(),p("div",{key:2,class:c([[a(r).dropZoneFileSize],"list-view-time text-[10px] font-medium px-1.5 py-0.5 rounded whitespace-nowrap flex-shrink-0 z-[1]"])},b(me(s)),3)):g("",!0)],42,Oa))),128))]),_:2},1024)],64))),128)):(d(),V(_t,{key:2,name:"file-item-list"},{default:F(()=>[(d(!0),p(L,null,ge(ut.value,e=>(d(),p("div",{key:e.name,"data-filename":e.name,class:c(["group relative flex items-center gap-3 cursor-pointer px-2 py-1.5 rounded transition-colors dropzone-file-item overflow-hidden",!(S.value===e.name||h.value.has(e.name))&&[a(r).desktopIconBg||"hover:bg-white/5"],(S.value===e.name||h.value.has(e.name))&&[a(r).desktopIconBgSelected||"bg-blue-500/20"]]),onClick:s=>gt(e,s),onDblclick:s=>Ze(e),onContextmenu:Ue(s=>he(s,e),["stop"]),onTouchstart:s=>yt(e,s),onTouchmove:o[5]||(o[5]=s=>xt(s)),onTouchend:s=>fe(e,s),onTouchcancel:s=>fe(e,s)},[C.value[e.name]!==void 0&&C.value[e.name]<100?(d(),p("div",{key:0,class:"absolute inset-0 bg-blue-500/20 transition-all duration-300 ease-out",style:oe({width:`${C.value[e.name]}%`})},null,4)):g("",!0),l("div",ts,[l("div",os,[vt(e)?(d(),p("div",as)):g("",!0),m(a(y),{icon:Ne(e),class:c([[a(r).dropZoneFileIcon,e.is_directory&&Z.value.has(e.name)?"opacity-40":""],"h-5 w-5"])},null,8,["icon","class"]),e.is_directory&&Z.value.has(e.name)?(d(),p("div",ss,[m(a(y),{icon:a(ae),class:c([[a(r).dropZoneLockIcon],"h-4 w-4 animate-spin"])},null,8,["icon","class"])])):g("",!0),e.is_directory&&Z.value.has(e.name)?(d(),p("div",ns,[m(a(y),{icon:a(se),class:c([[a(r).dropZoneLockIcon],"h-3 w-3"])},null,8,["icon","class"])])):g("",!0),e.is_directory?g("",!0):(d(),p("div",ls,[de.value[e.name]?(d(),V(a(y),{key:0,icon:a(ae),class:c([[a(r).dropZoneLockIcon],"animate-spin h-2 w-2"])},null,8,["icon","class"])):(d(),V(a(y),{key:1,icon:ue.value[e.name]?a(It):a(Mt),class:c([[a(r).dropZoneLockIcon],"h-2 w-2"])},null,8,["icon","class"]))]))])]),l("div",rs,[l("span",{class:c([[a(r).dropZoneFileText],"text-xs truncate block"]),title:e.display_name||e.name},b(e.name.split("/").pop()),11,is)]),e.is_directory?g("",!0):(d(),p("div",{key:1,class:c([[a(r).dropZoneFileSize],"list-view-size text-[10px] font-medium px-1.5 py-0.5 rounded whitespace-nowrap flex-shrink-0 z-[1]"])},b(ve(e.size)),3)),me(e)?(d(),p("div",{key:2,class:c([[a(r).dropZoneFileSize],"list-view-time text-[10px] font-medium px-1.5 py-0.5 rounded whitespace-nowrap flex-shrink-0 z-[1]"])},b(me(e)),3)):g("",!0)],42,es))),128))]),_:1}))]))]),_:1},8,["name"])],544)])]),m(Qo,{visible:rt.value,x:Xt.value,y:Yt.value,items:wo.value,onClose:Ee},null,8,["visible","x","y","items"]),m(tt,{visible:Q.value,"onUpdate:visible":o[7]||(o[7]=e=>Q.value=e),type:"confirm",title:at.value,content:st.value,"ok-text":"Delete","cancel-text":"Cancel",onOk:Po,onCancel:o[8]||(o[8]=e=>Q.value=!1)},null,8,["visible","title","content"]),m(tt,{visible:Te.value,"onUpdate:visible":o[10]||(o[10]=e=>Te.value=e),type:"info",title:"Create New Folder","ok-text":"Create","cancel-text":"Cancel",onOk:Nt,onCancel:o[11]||(o[11]=e=>Te.value=!1),icon:a(Be)},{default:F(()=>[l("div",cs,[l("label",{class:c([[a(r).notTextDown],"text-sm block mb-2"])},"Folder name (max 255 characters)",2),m(a(io),{value:re.value,"onUpdate:value":o[9]||(o[9]=e=>re.value=e),placeholder:"Enter folder name...",onPressEnter:Nt,class:c([[a(r).scopeSelector,a(r).loginFormInput],"h-10"]),autofocus:"",maxlength:255},{prefix:F(()=>[m(a(y),{icon:a(ne),class:c([[a(r).formIcon],"mr-0.5 transition duration-300"]),width:"16",height:"16"},null,8,["icon","class"])]),_:1},8,["value","class"])])]),_:1},8,["visible","icon"]),m(tt,{visible:Se.value,"onUpdate:visible":o[13]||(o[13]=e=>Se.value=e),type:"info",title:"Rename Item","ok-text":"Rename","cancel-text":"Cancel",onOk:Qt,onCancel:o[14]||(o[14]=e=>Se.value=!1),icon:a(we)},{default:F(()=>[l("div",us,[l("label",{class:c([[a(r).notTextDown],"text-sm block mb-2"])},"New name (max 255 characters)",2),m(a(io),{value:ie.value,"onUpdate:value":o[12]||(o[12]=e=>ie.value=e),placeholder:"Enter new name...",onPressEnter:Qt,class:c([[a(r).scopeSelector,a(r).loginFormInput],"h-10"]),autofocus:"",maxlength:255},{prefix:F(()=>[m(a(y),{icon:a(we),class:c([[a(r).formIcon],"mr-0.5 transition duration-300"]),width:"16",height:"16"},null,8,["icon","class"])]),_:1},8,["value","class"])])]),_:1},8,["visible","icon"]),m(tt,{visible:Fe.value,"onUpdate:visible":o[15]||(o[15]=e=>Fe.value=e),type:"info",title:"Folder Upload Detected","ok-text":"Upload Folder","cancel-text":"Cancel",onOk:Ro,onCancel:Uo,icon:a(Ko),width:480,"reverse-buttons":!0},{default:F(()=>[l("div",ds,[l("p",{class:c([[a(r).notTextDown],"text-sm leading-relaxed"])},[o[22]||(o[22]=R(" You are about to upload ",-1)),l("strong",null,b(G.value?.allFiles.length||0)+" files",1),o[23]||(o[23]=R(" across ",-1)),l("strong",null,b(G.value?.folders.length||0)+" directories",1),o[24]||(o[24]=R(". Each file will be encrypted individually, which can be resource-intensive for large folders. ",-1))],2),l("div",{class:c([[a(r).dropZoneTotalSizeScope],"rounded-lg p-3.5 space-y-2.5"])},[l("p",ps,[m(a(y),{icon:a(se),class:"w-5 h-5"},null,8,["icon"]),o[25]||(o[25]=l("span",null,"ZIP Before Uploading",-1))]),o[32]||(o[32]=l("p",{class:"text-xs leading-relaxed"},"Cancel this upload and manually compress the folder to a ZIP file first. Then upload that single ZIP file instead:",-1)),l("ul",ms,[l("li",null,[o[26]||(o[26]=R(" Encrypt ",-1)),o[27]||(o[27]=l("strong",null,"1 file",-1)),o[28]||(o[28]=R(" instead of ",-1)),l("strong",null,b(G.value?.allFiles.length||0)+" files",1)]),o[29]||(o[29]=l("li",null,[l("strong",null,"Much faster"),R(" upload and encryption")],-1)),o[30]||(o[30]=l("li",null,[l("strong",null,"Less resource intensive"),R(" on the server")],-1)),o[31]||(o[31]=l("li",null,[l("strong",null,"Easier"),R(" to download and restore later")],-1))])],2)])]),_:1},8,["visible","icon"]),m(a(ga),{fileList:Le.value,"onUpdate:fileList":o[16]||(o[16]=e=>Le.value=e),name:"file",multiple:!0,customRequest:Fo,onChange:zo,showUploadList:!1,class:"fixed bottom-10 right-2 z-50 hidden max-[900px]:block"},{default:F(()=>[l("button",{class:c([[a(r).dropZoneSortButton],"w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-transform duration-300 active:scale-95 border-none cursor-pointer"]),title:"Upload Files"},[m(a(y),{icon:a(ca),class:"w-6 h-6"},null,8,["icon"])],2)]),_:1},8,["fileList"]),m(et,{name:"upload-slide-up"},{default:F(()=>[a(D).isUploading?(d(),p("div",{key:0,class:c(["border-t",[a(r).dropZoneDragHolder,a(r).scopeSelector]])},[l("div",{class:c([a(r).hrSelector])},null,2),l("div",{onClick:o[17]||(o[17]=e=>Me.value=!Me.value),class:"flex items-center gap-2 h-7 pb-0.5 px-3 cursor-pointer hover:opacity-80 transition-opacity"},[l("div",vs,[(d(),p("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",class:c([[a(r).dropZoneDragIcon],"flex-shrink-0"])},[...o[33]||(o[33]=[l("rect",{width:"24",height:"24",fill:"none"},null,-1),l("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.3"},[l("path",{"stroke-dasharray":"2 4","stroke-dashoffset":"6",d:"M12 21c-4.97 0 -9 -4.03 -9 -9c0 -4.97 4.03 -9 9 -9"},[l("animate",{attributeName:"stroke-dashoffset",dur:"0.6s",repeatCount:"indefinite",values:"6;0"})]),l("path",{"stroke-dasharray":"32","stroke-dashoffset":"32",d:"M12 3c4.97 0 9 4.03 9 9c0 4.97 -4.03 9 -9 9"},[l("animate",{fill:"freeze",attributeName:"stroke-dashoffset",begin:"0.1s",dur:"0.4s",values:"32;0"})]),l("path",{"stroke-dasharray":"10","stroke-dashoffset":"10",d:"M12 16v-7.5"},[l("animate",{fill:"freeze",attributeName:"stroke-dashoffset",begin:"0.5s",dur:"0.2s",values:"10;0"})]),l("path",{"stroke-dasharray":"6","stroke-dashoffset":"6",d:"M12 8.5l3.5 3.5M12 8.5l-3.5 3.5"},[l("animate",{fill:"freeze",attributeName:"stroke-dashoffset",begin:"0.7s",dur:"0.2s",values:"6;0"})])],-1)])],2)),l("span",{class:c([[a(r).dropZoneDragUpText],"text-[10px] leading-none truncate"])},b(_e.value)+" of "+b(le.value),3)]),l("div",fs,[m(a($t),{percent:vo.value,class:c([[a(r).scopeSelector],"rounded-full flex-1"]),"show-info":!1,size:2,status:"active"},null,8,["percent","class"])]),m(a(y),{icon:a(da),class:c([[a(r).dropZoneFileIcon,"transition-transform duration-200",Me.value&&"rotate-180"],"w-3.5 h-3.5 flex-shrink-0"])},null,8,["icon","class"])]),m(et,{name:"expand-height"},{default:F(()=>[Me.value?(d(),p("div",{key:0,class:c([a(r).dropZoneFileDisplayer])},[l("div",{class:c([a(r).hrSelector])},null,2),l("div",hs,[(d(!0),p(L,null,ge(a(D).currentlyUploading,(e,s)=>(d(),p(L,{key:e.uid},[l("div",gs,[l("div",ys,[m(a(y),{icon:a(ye),class:c([[a(r).dropZoneFileIcon],"w-3.5 h-3.5 flex-shrink-0"])},null,8,["icon","class"]),l("div",xs,[l("div",ws,[l("p",{class:c([[a(r).dropZoneFileText],"text-[11px] font-medium truncate flex-1"]),title:e.name},b(e.name),11,bs),l("span",{class:c([[a(r).dropZoneFileSize],"text-[9px] font-semibold px-1 rounded whitespace-nowrap"])},b(a(D).uploadProgress[e.uid]||0)+"% ",3)]),m(a($t),{percent:a(D).uploadProgress[e.uid]||0,class:c([[a(r).scopeSelector],"rounded-full"]),"show-info":!1,size:1.5,status:"active"},null,8,["percent","class"])])])]),s<a(D).currentlyUploading.length-1||a(D).queue.length>0?(d(),p("div",{key:0,class:c([a(r).hrSelector])},null,2)):g("",!0)],64))),128)),(d(!0),p(L,null,ge(a(D).queue.slice(0,3),(e,s)=>(d(),p(L,{key:e.uid},[l("div",ks,[l("div",_s,[m(a(y),{icon:a(ye),class:c([[a(r).dropZoneFileIcon],"w-3.5 h-3.5 flex-shrink-0"])},null,8,["icon","class"]),l("div",Ts,[l("p",{class:c([[a(r).dropZoneFileText],"text-[11px] truncate flex-1"]),title:e.name},b(e.name),11,Ss),l("span",{class:c([[a(r).dropZoneFileSize],"text-[9px] font-medium px-1 rounded whitespace-nowrap"])}," Waiting... ",2)])])]),s<Math.min(2,a(D).queue.length-1)?(d(),p("div",{key:0,class:c([a(r).hrSelector])},null,2)):g("",!0)],64))),128)),a(D).queue.length>3?(d(),p(L,{key:0},[l("div",{class:c([a(r).hrSelector])},null,2),l("div",Fs,[l("span",{class:c([[a(r).dropZoneFilesCount],"text-[9px] opacity-60"])}," And "+b(a(D).queue.length-3)+" more in queue... ",3)])],64)):g("",!0)])],2)):g("",!0)]),_:1})],2)):g("",!0)]),_:1}),m(ra,{visible:Oe.value,message:Bt.value,position:"bottom-left"},null,8,["visible","message"]),m(pa,{icon:a(ye),message:xo.value,info:go.value,showHelp:!0},{help:F(()=>[l("div",Ds,[l("div",Ms,[m(a(y),{icon:a(ye),class:c(["w-5 h-5",a(r).statusBarIcon])},null,8,["icon","class"]),l("h4",{class:c(["text-base font-semibold",a(r).statusBarText])},"Drop Zone",2)]),l("div",{class:c(["text-[10px] md:text-xs space-y-2 leading-relaxed",a(r).statusBarInfo])},[...o[34]||(o[34]=[l("p",null,"Your personal encrypted cloud storage built into HomeDock OS. Every file you upload is automatically encrypted with military-grade AES-256-GCM encryption before being stored. Simply drag and drop your files. HomeDock OS encrypts and signs them instantly using your unique user key. Only you can decrypt and access your files.",-1)])],2)])]),_:1},8,["icon","message","info"])],32))}}),fn=qo(Is,[["__scopeId","data-v-0f0a7257"]]);export{fn as default};
