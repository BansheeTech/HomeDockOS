import{j as Se,B as Ie,r as S,d as y,v as $e,n as Ae,w as Ce,y as p,A as c,z as i,F as v,I as De,E as $,H as r,u as o,M as h,W as Te,R as A,U as Z,G as u,K as Me,ak as Ee,C as z,X as Re,Z as Be,N as Fe,D as He}from"./hdos_CwgWk8eLTjpwBAvlmNRuC.js";import{a as Y}from"./hdos_C-gUdRjisEVUw9SLex2md.js";import{k as je,u as Le,a as Oe,z as Ue,N as Ne,g as Ve,b as T,L as M,O as Ze,C as ze,D as E,H as ee,I as te,J as ae,K as C,B as Qe,P as We,Q as oe,R as Ge,S as Ke}from"./hdos_D9kVJQ7cHtySixDiiDAnh.js";import{_ as Xe}from"./hdos_DB9nk7o4Li83Mnm0jQoEI.js";import{d as se}from"./hdos_itWSuQ2oYLgMGq-Z_V6WL.js";import{d as qe}from"./hdos_D4VENToS-RM0shQaDqhsL.js";import{d as Je}from"./hdos_C5l3yA4rfWsQeonAlErEl.js";import{e as ne}from"./hdos_C8i7KrBOeUla4Xcj1qGUL.js";import{d as Pe}from"./hdos_DzD_9-ae9bJuHOkfQ9Haz.js";import{j as Q}from"./hdos_DFB9E9TvlsPR65iN3QDdj.js";import"./hdos_Dz3aTMQqM4LnOlKzV3COc.js";import"./hdos_CE1G-McAXm7G2-tH-xmrF.js";import"./hdos_DCQvziD-0BGtLQC-jPv6N.js";import"./hdos_CJoaCRc7PMIr83ndc1bSY.js";import"./hdos_CKiXEHO1wWmBHvui6HE9C.js";import"./hdos_eBG4X8UAzk7PFFQ8iD72q.js";const W={width:24,height:24,body:'<path fill="currentColor" d="M12 13a5 5 0 0 1-5-5h2a3 3 0 0 0 3 3a3 3 0 0 0 3-3h2a5 5 0 0 1-5 5m0-10a3 3 0 0 1 3 3H9a3 3 0 0 1 3-3m7 3h-2a5 5 0 0 0-5-5a5 5 0 0 0-5 5H5c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2Z"/>'},Ye={class:"flex flex-col h-full overflow-hidden"},et={class:"relative flex items-center gap-3"},tt=["onClick"],at={class:"max-[480px]:hidden"},ot={class:"relative flex-1 overflow-y-auto"},st={key:0,class:"flex flex-col items-center justify-center px-8 py-16 text-center"},nt={key:1,class:"flex flex-col items-center justify-center px-8 py-16 text-center"},lt={key:2,class:"px-6 md:px-4 py-4"},rt={class:"flex flex-col gap-2"},it=["onClick","onMouseenter"],ct={class:"flex-1 min-w-0"},pt={key:0},ut={class:"flex-shrink-0"},dt=["onClick","title"],mt={class:"space-y-2.5 max-w-sm"},ft={class:"flex items-center gap-2"},Et=Se({__name:"AppExplorer",setup(xt){const R=je(),B=Le(),F=Oe(),le=Ue(),{isMobile:re}=Ne(),{themeClasses:n}=Ie(),m=S(""),d=S("all"),f=S(0),G=S(null),D=S([]),K=S(!0),H=Ve(),ie=y(()=>{const e=(t,a)=>d.value===t?t==="all"&&!m.value.trim()?a:g.value.length:a;return[{id:"all",label:"All",icon:Je,count:e("all",U.value)},{id:"apps",label:"Apps",icon:T,count:e("apps",j.value.length+L.value.length)},{id:"files",label:"Files",icon:M,count:e("files",D.value.length)},{id:"available",label:"Available",icon:W,count:e("available",O.value.length)}]}),j=y(()=>Ze()),L=y(()=>R.mainDockerApps.filter(e=>e.status==="running")),O=y(()=>B.apps.filter(e=>!e.is_installed)),U=y(()=>j.value.length+L.value.length+D.value.length+O.value.length);async function X(){try{const e=await Y.get("/api/get_files",{headers:{"X-HomeDock-CSRF-Token":H.value}});D.value=e.data.files||[]}catch(e){console.error("Failed to fetch DropZone files:",e)}}async function ce(){try{K.value=!0,await B.loadApps(H.value)}catch(e){console.error("Failed to load available apps:",e)}finally{K.value=!1}}function N(e,t){if(!e||!t)return 0;const a=e.toLowerCase(),s=t.toLowerCase();if(a===s)return 100;if(a.startsWith(s))return 95;const l=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(`\\b${l}\\b`,"i").test(a))return 90;if(a.includes(s))return 85;const b=a.split(/[\s-_]+/);for(const _ of b){if(_.startsWith(s))return 80;if(_.includes(s))return 75}let w=0,k=0,I=0;for(;w<a.length&&k<s.length;)a[w]===s[k]&&(I++,k++),w++;if(k===s.length){const _=I/s.length,_e=1-(w-I)/a.length;return Math.floor(60*_*_e)}if(I>0){const _=I/s.length*40;return Math.floor(_)}return 0}const pe=y(()=>{const e=[];return j.value.forEach(t=>{e.push({id:`system-${t.id}`,type:"system",name:t.name,description:t.description,icon:t.icon,category:"System Apps",score:0,action:()=>R.openSystemApp(t.id)})}),L.value.forEach(t=>{e.push({id:`docker-${t.id}`,type:"docker",name:t.display_name||t.name,description:t.image,image_path:t.image_path,category:"Installed Apps",score:0,action:()=>R.openDockerApp(t)})}),D.value.forEach(t=>{e.push({id:`file-${t.name}`,type:"file",name:t.name,description:"Encrypted file",icon:ue(t.name),category:"Files",size:t.size,modified:t.modified,score:0,action:()=>ye(t.name)})}),O.value.forEach(t=>{e.push({id:`available-${t.name}`,type:"available",name:t.display_name||t.name,description:t.category,image_path:t.picture_path||`docker-icons/${t.name}.jpg`,category:"Available in Store",score:0,action:()=>ge(t.name)})}),e}),g=y(()=>{const e=m.value.trim(),t=e.length>0;if(d.value==="all"&&!t)return[];let a=[...pe.value];if(d.value!=="all"){const l={apps:["system","docker"],files:["file"],available:["available"]}[d.value]||[];a=a.filter(x=>l.includes(x.type))}return t?a=a.map(l=>{const x=N(l.name,e),b=l.description?N(l.description,e):0,w=N(l.category,e),k=Math.max(x,b*.8,w*.5);return{...l,score:k}}).filter(l=>l.score>=60).sort((l,x)=>x.score-l.score):a=a.sort((s,l)=>s.type==="system"&&l.type==="system"?0:s.type==="system"?-1:l.type==="system"?1:s.name.localeCompare(l.name)),a}),q=y(()=>{const e={};g.value.forEach(a=>{e[a.category]||(e[a.category]=[]),e[a.category].push(a)});const t={"System Apps":T,"Installed Apps":T,Files:M,"Available in Store":W};return Object.keys(e).map(a=>({category:a,title:a,icon:t[a]||ze,items:e[a]}))});function J(e,t){let a=0;for(let s=0;s<e;s++)a+=q.value[s].items.length;return a+t}function ue(e){const t=e.split(".").pop()?.toLowerCase();return{png:C,jpg:C,jpeg:C,gif:C,webp:C,mp4:ae,mkv:ae,mp3:te,wav:te,zip:ee,rar:ee,js:E,ts:E,py:E,vue:E}[t||""]||M}function de(e){return e>=1e9?(e/1e9).toFixed(2)+" GB":e>=1e6?(e/1e6).toFixed(2)+" MB":e>=1e3?(e/1e3).toFixed(2)+" KB":e+" B"}function me(e){if(!e)return"";const t=new Date,a=typeof e=="number"?new Date(e*1e3):new Date(e),s=Math.floor((t.getTime()-a.getTime())/1e3);return s<60?"Just now":s<3600?`${Math.floor(s/60)}m ago`:s<86400?`${Math.floor(s/3600)}h ago`:s<2592e3?`${Math.floor(s/86400)}d ago`:`${Math.floor(s/2592e3)}mo ago`}function fe(e){return{system:"System",docker:"Running",file:"File",available:"Available"}[e]||e}function xe(e){return{system:n.value.explorerBadgeSystem,docker:n.value.explorerBadgeDocker,file:n.value.explorerBadgeFile,available:n.value.explorerBadgeAvailable}[e]||""}function ve(e){return{system:ne,docker:Ke,file:Ge,available:Pe}[e]||ne}function he(e){return{system:"Open",docker:"Open",file:"Download",available:"View in Store"}[e]||"Open"}function V(e){e.action()}async function ye(e){try{const t=await Y.get(`/api/download_file?file=${encodeURIComponent(e)}`,{headers:{"X-HomeDock-CSRF-Token":H.value},responseType:"blob"}),a=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=a,s.setAttribute("download",e),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(a),Q.success(`Downloading ${e}`)}catch{Q.error("Failed to download file")}}function ge(e){const t=B.apps.find(s=>s.name===e);if(!t){Q.error(`App ${e} not found`);return}const a=F.windows.find(s=>s.appId==="installconfig"&&s.data?.app?.name===t.name);if(a){F.focusWindow(a.id),a.isMinimized&&(a.isMinimized=!1);return}F.openWindow("installconfig",{title:`Install ${t.display_name||t.name}`,data:{app:t},allowMultiple:!0})}function be(){return{all:"No items available",apps:"No apps found",files:"No files in Drop Zone",available:"All apps are already installed"}[d.value]||"No items found"}function we(){return{all:"Start by installing apps or uploading files",apps:"Install apps from the App Store to get started",files:"Upload files to Drop Zone to see them here",available:"Great! All available apps are installed"}[d.value]||""}function P(){m.value="",f.value=0}function ke(e){const t=g.value.length-1;switch(e.key){case"ArrowDown":e.preventDefault(),f.value=Math.min(f.value+1,t);break;case"ArrowUp":e.preventDefault(),f.value=Math.max(f.value-1,0);break;case"Enter":e.preventDefault(),g.value[f.value]&&V(g.value[f.value]);break;case"Escape":e.preventDefault(),P();break}}return $e(async()=>{await Promise.all([ce(),X()]),re.value||Ae(()=>{G.value?.focus()})}),Ce(()=>le.currentlyUploading,(e,t)=>{t&&!e&&setTimeout(()=>{X()},500)}),(e,t)=>(c(),p("div",Ye,[i("div",{class:r(["px-6 md:px-4 py-5 border-b",o(n).explorerHeaderBorder])},[i("div",et,[v(o(h),{icon:o(se),class:r([o(n).explorerSearchIcon,"absolute left-4 w-5 h-5 pointer-events-none"])},null,8,["icon","class"]),De(i("input",{ref_key:"searchInputRef",ref:G,"onUpdate:modelValue":t[0]||(t[0]=a=>m.value=a),type:"text",placeholder:"Search apps, files, and more...",class:r(["flex-1 py-3 pr-4 pl-12 rounded-lg border text-sm outline-none transition-all duration-200",[o(n).explorerSearchInput,o(n).explorerSearchInputText,o(n).explorerSearchInputFocusRing]]),onKeydown:ke},null,34),[[Te,m.value]]),m.value?(c(),p("button",{key:0,onClick:P,class:r(["absolute right-2 p-2 border-none bg-transparent cursor-pointer rounded transition-all duration-150",[o(n).explorerClearButton,o(n).explorerClearButtonHover]])},[v(o(h),{icon:o(Qe),class:"w-4 h-4"},null,8,["icon"])],2)):$("",!0)])],2),i("div",{class:r(["flex gap-2 px-6 md:px-4 py-4 border-b overflow-x-auto [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",o(n).explorerHeaderBorder])},[(c(!0),p(A,null,Z(ie.value,a=>(c(),p("button",{key:a.id,onClick:s=>d.value=a.id,class:r(["flex items-center gap-2 md:gap-1.5 px-4 md:px-3 py-2 rounded-lg border-none text-sm md:text-[0.8125rem] font-medium cursor-pointer transition-all duration-150 whitespace-nowrap max-[480px]:min-w-12 max-[480px]:px-2",d.value===a.id?o(n).explorerTabActive:[o(n).explorerTabInactive,o(n).explorerTabHover]])},[v(o(h),{icon:a.icon,class:"w-4 h-4 md:w-4 md:h-4"},null,8,["icon"]),i("span",at,u(a.label),1),a.count>0?(c(),p("span",{key:0,class:r(["text-xs md:text-[0.6875rem] px-2 md:px-1.5 py-0.5 md:py-0 rounded-full font-semibold",d.value===a.id?o(n).explorerTabCountActive:o(n).explorerTabCountInactive])},u(a.count),3)):$("",!0)],10,tt))),128))],2),i("div",ot,[!m.value.trim()&&d.value==="all"?(c(),p("div",st,[v(Me,{icons:[o(se),o(T),o(M),o(W)],iconSize:64,interval:2e3,containerClass:"mb-4",class:r(o(n).explorerEmptyIcon)},null,8,["icons","class"]),i("p",{class:r([o(n).explorerEmptyText,"text-base font-medium mb-2 text-balance"])},"Start typing to search across HomeDock OS",2),i("div",{class:r(["mt-8 text-left max-w-md",o(n).explorerQuickTips])},[...t[1]||(t[1]=[Ee('<p class="text-sm font-semibold mb-2">Quick tips:</p><ul class="list-none p-0 text-[0.8125rem] leading-relaxed"><li class="before:content-[&#39;•&#39;] before:mr-2 before:opacity-50">Search for apps, files, or available software</li><li class="before:content-[&#39;•&#39;] before:mr-2 before:opacity-50">Use filters to narrow down results</li><li class="before:content-[&#39;•&#39;] before:mr-2 before:opacity-50">Select a category above to browse items</li></ul>',2)])],2)])):g.value.length===0?(c(),p("div",nt,[v(o(h),{icon:o(qe),class:r([o(n).explorerEmptyIcon,"w-16 h-16 mb-4"])},null,8,["icon","class"]),m.value?(c(),p(A,{key:0},[i("p",{class:r([o(n).explorerEmptyText,"text-base font-medium mb-2"])},'No results found for "'+u(m.value)+'"',3),i("p",{class:r([o(n).explorerEmptySubtext,"text-sm"])},"Try different keywords or check your spelling",2)],64)):(c(),p(A,{key:1},[i("p",{class:r([o(n).explorerEmptyText,"text-base font-medium mb-2"])},u(be()),3),i("p",{class:r([o(n).explorerEmptySubtext,"text-sm"])},u(we()),3)],64))])):(c(),p("div",lt,[(c(!0),p(A,null,Z(q.value,(a,s)=>(c(),p("div",{key:a.category,class:"mb-8 last:mb-0"},[i("h3",{class:r(["flex items-center gap-2 text-xs font-semibold uppercase tracking-wider mb-3",o(n).explorerGroupHeader])},[v(o(h),{icon:a.icon,class:"w-4 h-4"},null,8,["icon"]),i("span",null,u(a.title),1),i("span",{class:r(["opacity-50 font-normal",o(n).explorerGroupCount])},"("+u(a.items.length)+")",3)],2),i("div",rt,[(c(!0),p(A,null,Z(a.items,(l,x)=>(c(),p("div",{key:l.id,onClick:b=>V(l),onMouseenter:b=>f.value=J(s,x),class:r(["flex items-center gap-4 px-3 py-3 rounded-lg cursor-pointer transition-all duration-150",[o(n).explorerResultItem,o(n).explorerResultItemHover,f.value===J(s,x)?o(n).explorerResultItemSelected:""]])},[i("div",{class:r(["flex-shrink-0 w-12 h-12 md:w-10 md:h-10 flex items-center justify-center rounded-lg overflow-hidden",l.type==="docker"?"bg-transparent p-0":""])},[l.image_path?(c(),z(Re,{key:0,src:l.image_path,alt:"",class:"w-full h-full object-cover",draggable:"false"},null,8,["src"])):l.icon?(c(),z(o(h),{key:1,icon:l.icon,class:r([o(n).explorerItemIcon,"w-8 h-8"])},null,8,["icon","class"])):(c(),z(o(h),{key:2,icon:o(We),class:r([o(n).explorerItemIcon,"w-8 h-8"])},null,8,["icon","class"]))],2),i("div",ct,[i("div",{class:r(["text-sm font-medium overflow-hidden text-ellipsis whitespace-nowrap",o(n).explorerItemName])},u(l.name),3),l.description?(c(),p("div",{key:0,class:r(["text-xs mt-0.5 overflow-hidden text-ellipsis whitespace-nowrap",o(n).explorerItemDescription])},u(l.description),3)):$("",!0),l.size?(c(),p("div",{key:1,class:r(["text-xs mt-0.5",o(n).explorerItemMeta])},[Be(u(de(l.size))+" ",1),l.modified?(c(),p("span",pt," • "+u(me(l.modified)),1)):$("",!0)],2)):$("",!0)]),i("div",{class:r(["flex-shrink-0 px-2 py-1 rounded text-[0.625rem] font-semibold uppercase",xe(l.type)])},u(fe(l.type)),3),i("div",ut,[i("button",{onClick:Fe(b=>V(l),["stop"]),class:r(["p-2 rounded-md border-none cursor-pointer transition-all duration-150",[o(n).explorerActionButton,o(n).explorerActionButtonHover]]),title:he(l.type)},[v(o(h),{icon:ve(l.type),class:"w-4 h-4"},null,8,["icon"])],10,dt)])],42,it))),128))])]))),128))]))]),v(Xe,{icon:o(oe),message:"Explorer",info:`${U.value} ${U.value===1?"item":"items"} available`,showHelp:!0},{help:He(()=>[i("div",mt,[i("div",ft,[v(o(h),{icon:o(oe),class:r(["w-5 h-5",o(n).statusBarIcon])},null,8,["icon","class"]),i("h4",{class:r(["text-base font-semibold",o(n).statusBarText])},"Explorer",2)]),i("div",{class:r(["text-[10px] md:text-xs space-y-2 leading-relaxed",o(n).statusBarInfo])},[...t[2]||(t[2]=[i("p",null,"Search across all available content in HomeDock OS including system applications, installed applications, available software from the App Store, and encrypted files stored in Drop Zone. Use filters to narrow results by category or search by name to quickly find what you need.",-1)])],2)])]),_:1},8,["icon","info"])]))}});export{Et as default};
